!function(){"use strict";var e="undefined"==typeof window?global:window;if("function"!=typeof e.require){var t={},n={},o={},s={}.hasOwnProperty,r="components/",a=function(e,t){var n=0;t&&(0===t.indexOf(r)&&(n=r.length),t.indexOf("/",n)>0&&(t=t.substring(n,t.indexOf("/",n))));var s=o[e+"/index.js"]||o[t+"/deps/"+e+"/index.js"];return s?r+s.substring(0,s.length-".js".length):e},i=/^\.\.?(\/|$)/,l=function(e,t){for(var n,o=[],s=(i.test(t)?e+"/"+t:t).split("/"),r=0,a=s.length;a>r;r++)n=s[r],".."===n?o.pop():"."!==n&&""!==n&&o.push(n);return o.join("/")},c=function(e){return e.split("/").slice(0,-1).join("/")},u=function(t){return function(n){var o=l(c(t),n);return e.require(o,t)}},p=function(e,t){var o={id:e,exports:{}};return n[e]=o,t(o.exports,u(e),o),o.exports},d=function(e,o){var r=l(e,".");if(null==o&&(o="/"),r=a(e,o),s.call(n,r))return n[r].exports;if(s.call(t,r))return p(r,t[r]);var i=l(r,"./index");if(s.call(n,i))return n[i].exports;if(s.call(t,i))return p(i,t[i]);throw new Error('Cannot find module "'+e+'" from "'+o+'"')};d.alias=function(e,t){o[t]=e},d.register=d.define=function(e,n){if("object"==typeof e)for(var o in e)s.call(e,o)&&(t[o]=e[o]);else t[e]=n},d.list=function(){var e=[];for(var n in t)s.call(t,n)&&e.push(n);return e},d.brunch=!0,d._cache=n,e.require=d}}(),require.register("actions/account_action_creator",function(e,n,o){var s,r,a,i,l,c,u,p;u=n("../utils/xhr_utils"),i=n("../app_dispatcher"),a=n("../constants/app_constants").ActionTypes,r=n("../stores/account_store"),l=null,c=n("./message_action_creator"),p=function(){return null==l&&(l=n("../actions/layout_action_creator")),l},o.exports=s={create:function(e,t){return i.handleViewAction({type:a.ADD_ACCOUNT_REQUEST,value:{inputValues:e}}),u.createAccount(e,function(e,t){var n;return null!=e||null==t?i.handleViewAction({type:a.ADD_ACCOUNT_FAILURE,value:{error:e}}):null==t?i.handleViewAction({type:a.ADD_ACCOUNT_FAILURE,value:{error:"no account returned from create"}}):(i.handleViewAction({type:a.ADD_ACCOUNT_SUCCESS,value:{account:t}}),n="account/"+t.id+"/config/mailboxes",window.router.navigate(n,{trigger:!0}))})},edit:function(e,t,n){var o;return o=r.getByID(t).mergeDeep(e),i.handleViewAction({type:a.EDIT_ACCOUNT_REQUEST,value:{inputValues:e,newAccount:o}}),u.editAccount(o,function(e,t){return null!=e?i.handleViewAction({type:a.EDIT_ACCOUNT_FAILURE,value:{error:e}}):(i.handleViewAction({type:a.EDIT_ACCOUNT_SUCCESS,value:{rawAccount:t}}),"function"==typeof n?n():void 0)})},check:function(e,t,n){var o,s;return null!=t?(o=r.getByID(t),s=o.mergeDeep(e).toJS()):s=e,i.handleViewAction({type:a.CHECK_ACCOUNT_REQUEST,value:{inputValues:e,newAccount:s}}),u.checkAccount(s,function(e,t){return null!=e?i.handleViewAction({type:a.CHECK_ACCOUNT_FAILURE,value:{error:e}}):i.handleViewAction({type:a.CHECK_ACCOUNT_SUCCESS,value:{rawAccount:t}}),"function"==typeof n?n(e,t):void 0})},remove:function(e){return i.handleViewAction({type:a.REMOVE_ACCOUNT,value:e}),u.removeAccount(e,function(e){}),p().notify(t("account removed"),{autoclose:!0}),window.router.navigate("",{trigger:!0})},ensureSelected:function(e){return function(e,t){return r.selectedIsDifferentThan(e,t)?s.selectAccount(e,t):void 0}}(this),selectDefaultIfNoneSelected:function(e){return function(){var e,t;return t=r.getSelected(),e=r.getDefault(),null==t&&e?s.selectAccount(e.get("id")):void 0}}(this),selectAccount:function(e,t){var n,o,s;return n=r.selectedIsDifferentThan(e,t),i.handleViewAction({type:a.SELECT_ACCOUNT,value:{accountID:e,mailboxID:t}}),o=r.getSelected(),s=null!=o?o.get("supportRFC4551"):void 0,null!=t&&n&&s?c.refreshMailbox(t):void 0},selectAccountForMessage:function(e){return function(e){var t;return t=r.getSelected(),null==t&&(null!=e?e.accountID:void 0)?s.selectAccount(e.accountID):void 0}}(this),discover:function(e,t){return u.accountDiscover(e,t)},mailboxCreate:function(e,n){return u.mailboxCreate(e,function(e,o){var s;return null==e?(i.handleViewAction({type:a.MAILBOX_CREATE,value:o}),p().alertSuccess(t("mailbox create ok"))):(s=""+t("mailbox create ko")+" "+(e.message||e),p().alertError(s)),"function"==typeof n?n(e):void 0})},mailboxUpdate:function(e,n){return u.mailboxUpdate(e,function(e,o){var s;return null==e?(i.handleViewAction({type:a.MAILBOX_UPDATE,value:o}),p().alertSuccess(t("mailbox update ok"))):(s=""+t("mailbox update ko")+" "+(e.message||e),p().alertError(s({autoclose:!0}))),"function"==typeof n?n(e):void 0})},mailboxDelete:function(e,t){return u.mailboxDelete(e,function(e,n){return null==e&&i.handleViewAction({type:a.MAILBOX_DELETE,value:n}),null!=t?t(e):void 0})},mailboxExpunge:function(e){var n,o;return n=e.accountID,o=e.mailboxID,i.handleViewAction({type:a.MAILBOX_EXPUNGE,value:o}),u.mailboxExpunge(e,function(e,s){var a;return null==e?p().notify(t("mailbox expunge ok"),{autoclose:!0}):(p().alertError(""+t("mailbox expunge ko")+" "+(e.message||e)),r.selectedIsDifferentThan(n,o)?void 0:(a=MessageStore.getQueryParams(),a.accountID=n,a.mailboxID=o,p().showMessageList({parameters:a})))})}}}),require.register("actions/contact_action_creator",function(e,n,o){var s,r,a,i,l;a=n("../app_dispatcher"),s=n("../constants/app_constants").ActionTypes,r=n("../utils/activity_utils"),l=n("../actions/layout_action_creator"),o.exports=i={searchContact:function(e){var t,n;return n={name:"search",data:{type:"contact",query:e}},t=new r(n),t.onsuccess=function(){return a.handleViewAction({type:s.RECEIVE_RAW_CONTACT_RESULTS,value:this.result})},t.onerror=function(){return console.log("KO",this.error,this.name)}},searchContactLocal:function(e){return a.handleViewAction({type:s.CONTACT_LOCAL_SEARCH,value:e})},createContact:function(e,n){var o,i;return i={name:"create",data:{type:"contact",contact:e}},o=new r(i),o.onsuccess=function(o,r){var i;return a.handleViewAction({type:s.RECEIVE_RAW_CONTACT_RESULTS,value:this.result}),i=t("contact create success",{contact:e.name||e.address}),l.notify(i,{autoclose:!0}),"function"==typeof n?n():void 0},o.onerror=function(){var e;return console.log(this.name),e=t("contact create error",{error:this.name}),l.alertError(e,{autoclose:!0}),"function"==typeof n?n():void 0}}}}),require.register("actions/layout_action_creator",function(e,t,n){var o,s,r,a,i,l,c,u,p,d,m,h,g,f;h=t("../utils/xhr_utils"),m=t("../utils/socketio_utils"),c=t("../stores/layout_store"),s=t("../stores/account_store"),d=t("../stores/message_store"),i=t("../app_dispatcher"),f=t("../constants/app_constants"),r=f.ActionTypes,a=f.AlertLevel,p=f.MessageFlags,o=t("./account_action_creator"),u=t("./message_action_creator"),g=0,n.exports=l={setDisposition:function(e){return i.handleViewAction({type:r.SET_DISPOSITION,value:e})},toggleListMode:function(){return i.handleViewAction({type:r.TOGGLE_LIST_MODE})},increasePreviewPanel:function(e){return null==e&&(e=1),i.handleViewAction({type:r.RESIZE_PREVIEW_PANE,value:Math.abs(e)})},decreasePreviewPanel:function(e){return null==e&&(e=1),i.handleViewAction({type:r.RESIZE_PREVIEW_PANE,value:-1*Math.abs(e)})},resetPreviewPanel:function(){return i.handleViewAction({type:r.RESIZE_PREVIEW_PANE,value:null})},toggleFullscreen:function(){var e;return e=c.isPreviewFullscreen()?r.MINIMIZE_PREVIEW_PANE:r.MAXIMIZE_PREVIEW_PANE,i.handleViewAction({type:e})},minimizePreview:function(){return i.handleViewAction({type:r.MINIMIZE_PREVIEW_PANE})},refresh:function(){return i.handleViewAction({type:r.REFRESH,value:null})},alert:function(e){return l.notify(e,{level:a.INFO,autoclose:!0})},alertSuccess:function(e){return l.notify(e,{level:a.SUCCESS,autoclose:!0})},alertWarning:function(e){return l.notify(e,{level:a.WARNING,autoclose:!0})},alertError:function(e){return l.notify(e,{level:a.ERROR,autoclose:!0})},notify:function(e,t){var n;if(null==e||""===e.toString().trim())throw new Error("Empty notification");return n={id:"taskid-"+g++,finished:!0,message:e.toString()},null!=t&&(n.autoclose=t.autoclose,n.errors=t.errors,n.finished=t.finished,n.actions=t.actions,n.level=t.level),i.handleViewAction({type:r.RECEIVE_TASK_UPDATE,value:n})},clearToasts:function(){return i.handleViewAction({type:r.CLEAR_TOASTS,value:null})},getDefaultRoute:function(){return 0===s.getAll().length?"account.new":"account.mailbox.messages"},showMessageList:function(e){var t,n,s,a,l,c,p;return c=e.parameters,t=c.accountID,l=c.mailboxID,a=c.filter,p=c.sort,s=c.before,n=c.after,o.ensureSelected(t,l),i.handleViewAction({type:r.QUERY_PARAMETER_CHANGED,value:c}),u.fetchMoreOfCurrentQuery()},showSearchResult:function(e){var t,n,s;return s=e.parameters,t=s.accountID,n=s.search,"all"!==t?o.ensureSelected(t):o.selectAccount(null),i.handleViewAction({type:r.SEARCH_PARAMETER_CHANGED,value:{accountID:t,search:n}}),"-"!==n?u.fetchSearchResults(t,n):void 0},showMessage:function(e,t){var n;return n=d.getByID(e.parameters.messageID),null!=n?o.selectAccountForMessage(n):h.fetchMessage(messageID,function(e,t){return null!=e?l.alertError(e):(u.receiveRawMessage(t),o.selectAccountForMessage(t))})},showConversation:function(e,t){var n,s,r,a;return a=e.parameters.messageID,n=e.parameters.conversationID,r=d.getByID(a),null!=r&&o.selectAccountForMessage(r),s=d.getConversationsLength().get(n),null==s||s>1?u.fetchConversation(n):void 0},showComposeNewMessage:function(e,t){return o.selectDefaultIfNoneSelected()},showComposeMessage:function(e,t){var n,s;return o.selectDefaultIfNoneSelected(),s=e.parameters.messageID,n=d.getByID(s),null==n?h.fetchMessage(s,function(e,t){return null!=e?l.alertError(e):(u.receiveRawMessage(t),o.selectAccountForMessage(t))}):void 0},showCreateAccount:function(e,t){return o.selectAccount(null)},showConfigAccount:function(e,t){return o.selectAccount(e.parameters.accountID)},showSettings:function(e,t){},toastsShow:function(){return i.handleViewAction({type:r.TOASTS_SHOW})},toastsHide:function(){return i.handleViewAction({type:r.TOASTS_HIDE})},intentAvailability:function(e){return i.handleViewAction({type:r.INTENT_AVAILABLE,value:e})},drawerShow:function(){return i.handleViewAction({type:r.DRAWER_SHOW})},drawerHide:function(){return i.handleViewAction({type:r.DRAWER_HIDE})},drawerToggle:function(){return i.handleViewAction({type:r.DRAWER_TOGGLE})},displayModal:function(e){return null==e.closeModal&&(e.closeModal=function(){return l.hideModal()}),i.handleViewAction({type:r.DISPLAY_MODAL,value:e})},hideModal:function(){return i.handleViewAction({type:r.HIDE_MODAL})}}}),require.register("actions/message_action_creator",function(e,t,n){var o,s,r,a,i,l,c,u,p,d,m,h;r=t("../app_dispatcher"),a=t("../constants/app_constants"),s=a.ActionTypes,c=a.MessageFlags,i=a.FlagsConstants,d=t("../utils/xhr_utils"),o=t("../stores/account_store"),u=t("../stores/message_store"),p=t("../stores/search_store"),m=1,n.exports=l={receiveRawMessages:function(e){return r.handleViewAction({type:s.RECEIVE_RAW_MESSAGES,value:e})},receiveRawMessage:function(e){return r.handleViewAction({type:s.RECEIVE_RAW_MESSAGE,value:e})},send:function(e,t){return d.messageSend(e,function(e,n){return null==e&&null!=n&&r.handleViewAction({type:s.MESSAGE_SEND,value:n}),"function"==typeof t?t(e,n):void 0})},setCurrent:function(e,t){return null!=e&&"string"!=typeof e&&(e=e.get("id")),r.handleViewAction({type:s.MESSAGE_CURRENT,value:{messageID:e,conv:t}})},fetchMoreOfCurrentQuery:function(){var e,t,n;return(n=u.getNextUrl())?(e=o.getSelectedMailbox().get("id"),r.handleViewAction({type:s.MESSAGE_FETCH_REQUEST,value:{mailboxID:e}}),t=Date.now(),d.fetchMessagesByFolder(n,function(n,o){return null!=n?r.handleViewAction({type:s.MESSAGE_FETCH_FAILURE,value:{mailboxID:e}}):(o.messages.forEach(function(e){return e.updated=t}),r.handleViewAction({type:s.MESSAGE_FETCH_SUCCESS,value:{mailboxID:e,fetchResult:o}}))})):void 0},fetchSearchResults:function(e,t){var n;return"-"===t?null:(n=p.getNextSearchUrl())?(r.handleViewAction({type:s.SEARCH_REQUEST,value:{search:t}}),d.search(n,function(e,t){return null!=e?r.handleViewAction({type:s.SEARCH_FAILURE,value:{error:e}}):r.handleViewAction({type:s.SEARCH_SUCCESS,value:{searchResults:t}})})):void 0},fetchConversation:function(e){return r.handleViewAction({type:s.CONVERSATION_FETCH_REQUEST,value:{conversationID:e}}),d.fetchConversation(e,function(e,t){return e?r.handleViewAction({type:s.CONVERSATION_FETCH_FAILURE,value:{error:e}}):r.handleViewAction({type:s.CONVERSATION_FETCH_SUCCESS,value:{updated:t}})})},recover:function(e,t){return r.handleViewAction({type:s.MESSAGE_RECOVER_REQUEST,value:{ref:t}}),d.batchFetch(e,function(e,n){return e?r.handleViewAction({type:s.MESSAGE_RECOVER_FAILURE,value:{ref:t}}):r.handleViewAction({type:s.MESSAGE_RECOVER_SUCCESS,value:{ref:t}})})},refreshMailbox:function(e){return o.isMailboxRefreshing(e)?void 0:(r.handleViewAction({type:s.REFRESH_REQUEST,value:{mailboxID:e}}),d.refreshMailbox(e,function(t,n){return null!=t?r.handleViewAction({type:s.REFRESH_FAILURE,value:{mailboxID:e,error:t}}):r.handleViewAction({type:s.REFRESH_SUCCESS,value:{mailboxID:e,updated:n}})}))},"delete":function(e,t){var n,o;return n=m++,r.handleViewAction({type:s.MESSAGE_TRASH_REQUEST,value:{target:e,ref:n}}),o=Date.now(),d.batchDelete(e,function(t){return function(a,i){var l,c,u;if(a)return r.handleViewAction({type:s.MESSAGE_TRASH_FAILURE,value:{target:e,ref:n,error:a}}),t.recover(e,n);for(c=0,u=i.length;u>c;c++)l=i[c],l.updated=o;return r.handleViewAction({type:s.MESSAGE_TRASH_SUCCESS,value:{target:e,ref:n,updated:i}})}}(this))},move:function(e,t,n,o){var a,i;return a=m++,r.handleViewAction({type:s.MESSAGE_MOVE_REQUEST,value:{target:e,ref:a,from:t,to:n}}),i=Date.now(),d.batchMove(e,t,n,function(t){return function(n,l){var c,u,p;if(n)r.handleViewAction({type:s.MESSAGE_MOVE_FAILURE,value:{target:e,ref:a,error:n}}),t.recover(e,a);else{for(u=0,p=l.length;p>u;u++)c=l[u],c.updated=i;r.handleViewAction({type:s.MESSAGE_MOVE_SUCCESS,value:{target:e,ref:a,updated:l}})}return"function"==typeof o?o(n,l):void 0}}(this))},mark:function(e,t,n){var o,a,l,c;switch(l=m++,t){case i.SEEN:a="batchAddFlag",o=i.SEEN;break;case i.FLAGGED:a="batchAddFlag",o=i.FLAGGED;break;case i.UNSEEN:a="batchRemoveFlag",o=i.SEEN;break;case i.NOFLAG:a="batchRemoveFlag",o=i.FLAGGED;break;default:throw new Error("Wrong usage : unrecognized FlagsConstants")}return r.handleViewAction({type:s.MESSAGE_FLAGS_REQUEST,value:{target:e,ref:l,op:a,flag:o,flagAction:t}}),c=Date.now(),d[a](e,o,function(i){return function(u,p){var d,m,h;if(u)r.handleViewAction({type:s.MESSAGE_FLAGS_FAILURE,value:{target:e,ref:l,error:u,op:a,flag:o,flagAction:t}}),i.recover(e,l);else{for(m=0,h=p.length;h>m;m++)d=p[m],d.updated=c;r.handleViewAction({type:s.MESSAGE_FLAGS_SUCCESS,value:{target:e,ref:l,updated:p,op:a,flag:o,flagAction:t}})}return"function"==typeof n?n(u,p):void 0}}(this))},undo:function(e){var t,n,o,a,i,c,p,d,m,g;return i=u.getUndoableRequest(e),o=i.messages,g=i.type,n=i.from,d=i.to,p=i.target,m=i.trashBoxID,c=[],a="move"===g?d:m,t={},o.forEach(function(e){var n,o,s,r;return o=function(){var t,o;t=e.get("mailboxIDs"),o=[];for(n in t)r=t[n],o.push(n);return o}(),s=o.sort().join(","),null==t[s]&&(t[s]={to:o,from:a,messageIDs:[]}),t[s].messageIDs.push(e.get("id"))}),r.handleViewAction({type:s.MESSAGE_UNDO_START,value:{ref:e}}),h(t,function(e,t,o){var s;return d=e.to,n=e.from,s=e.messageIDs,p={messageIDs:s,silent:!0},l.move(p,n,d,o)},function(t){return t?(r.handleViewAction({type:s.MESSAGE_UNDO_FAILURE,value:{ref:e}}),this.recover(p,e)):r.handleViewAction({type:s.MESSAGE_UNDO_SUCCESS,value:{ref:e}})})}},h=function(e,t,n){var o,s,r;return s=Object.keys(e),o=0,(r=function(){var a;return a=s[o],t(e[a],a,function(e){return e?n(e):++o===s.length?n(null):r()})})()}}),require.register("actions/settings_action_creator",function(e,n,o){var s,r,a,i,l,c;c=n("../utils/xhr_utils"),r=n("../app_dispatcher"),s=n("../constants/app_constants").ActionTypes,l=n("../stores/settings_store"),a=n("./layout_action_creator"),o.exports=i={edit:function(e){return c.changeSettings(e,function(e,n){return e?a.alertError(t("settings save error")+e):r.handleViewAction({type:s.SETTINGS_UPDATED,value:n})})}}}),require.register("app_dispatcher",function(e,t,n){var o,s,r,a={}.hasOwnProperty,i=function(e,t){function n(){this.constructor=e}for(var o in t)a.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};s=t("./libs/flux/dispatcher/dispatcher"),r=t("./constants/app_constants").PayloadSources,o=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return i(t,e),t.prototype.handleViewAction=function(e){var t;return window.cozyMails.logAction(e),t={source:r.VIEW_ACTION,action:e},this.dispatch(t),window.cozyMails.customEvent(r.VIEW_ACTION,e)},t.prototype.handleServerAction=function(e){var t;return window.cozyMails.logAction(e),t={source:r.SERVER_ACTION,action:e},this.dispatch(t),window.cozyMails.customEvent(r.SERVER_ACTION,e)},t}(s),n.exports=new o}),require.register("components/account_config",function(e,n,o){var s,r,a,i,l,c,u,p,d,m,h,g,f,v,b,y,_,E;c=n("../stores/account_store"),s=n("../actions/account_action_creator"),p=n("../actions/layout_action_creator"),h=n("../mixins/router_mixin"),f=n("../mixins/store_watch_mixin"),g=n("../mixins/should_update_mixin"),E=n("./basic_components"),u=E.Container,y=E.Title,b=E.Tabs,l=n("./account_config_delete"),a=n("./account_config_main"),r=n("./account_config_mailboxes"),i=n("./account_config_signature"),_=React.DOM.div,m=["label","name","login","password","imapServer","imapPort","smtpServer","smtpPort","smtpMethod"],d=m,v=["account","mailboxes","signature"],o.exports=React.createClass({displayName:"AccountConfig",_lastDiscovered:"",mixins:[h,g.UnderscoreEqualitySlow,f([c])],getStateFromStores:function(){var e,t,n;return n={},n.serverErrors=c.getErrors(),n.selectedAccount=c.getSelected(),n.isWaiting=c.isWaiting(),n.isChecking=c.isChecking(),n.mailboxes=c.getSelectedMailboxes(!0),n.favoriteMailboxes=c.getSelectedFavorites(),n.submitted=null!=c.getSelected(),this.state?(this.state.selectedAccount!==n.selectedAccount&&(t=this.state.editedAccount.merge(n.selectedAccount),n.editedAccount=t),this.state.serverErrors!==n.serverErrors&&(n.errors=n.serverErrors)):(e=c.getSelected(),null==e&&(e=c.makeEmptyAccount()),n.isWaiting=!1,n.errors=Immutable.Map(),n.editedAccount=e),n},isOauth:function(){var e;return null!=(null!=(e=this.state.selectedAccount)?e.get("oauthProvider"):void 0)},isNew:function(){return null==this.state.selectedAccount},getCurrentTab:function(){var e,t;return t=this.state.editedAccount.get("mailboxes"),e=0===(null!=t?t.length:void 0)?"mailboxes":"account",this.props.tab||e},onTabChangesDoSubmit:function(e){return this.onTabChanges(e,function(e){return function(){return e.onSubmit()}}(this))},onTabChanges:function(e,t){var n,o;return null==t&&(t=function(){}),n={editedAccount:this.state.editedAccount.merge(e),errors:Immutable.Map()},this.state.submitted&&(o=this.getLocalValidationErrors(n.editedAccount),n.errors=Immutable.Map(o)),this.setState(n,t)},render:function(){var e,n;return e=this.getCurrentTab(),u({id:"mailbox-config"},y({text:t(this.isNew()?"account new":"account edit")}),this.state.editedAccount.get("id")?b({tabs:v.map(function(n){return function(o){return{"class":e===o?"active":"",text:t("account tab "+o),url:n.buildUrl({direction:"first",action:"account.config",parameters:[n.state.editedAccount.get("id"),o]})}}}(this))}):void 0,function(){switch(e){case"signature":return i({account:this.state.editedAccount,editedAccount:this.state.editedAccount,requestChange:this.onTabChanges,onSubmit:this.onSubmit,errors:this.state.errors});case"mailboxes":return r({editedAccount:this.state.editedAccount,requestChange:this.onTabChangesDoSubmit,nomailboxesError:this.state.errors,onSubmit:this.onSubmit,errors:this.state.errors});default:return a({editedAccount:this.state.editedAccount,requestChange:this.onTabChanges,isWaiting:this.state.isWaiting,checking:this.state.isChecking,onSubmit:this.onSubmit,errors:this.state.errors})}}.call(this),(null!=(n=this.state.editedAccount)?n.get("id"):void 0)?l({editedAccount:this.state.editedAccount}):void 0)},getLocalValidationErrors:function(e){var n,o,s,r,a;for(o={},s=this.isNew()?m:d,r=0,a=s.length;a>r;r++)n=s[r],e.get(n)||(o[n]=t("validate must not be empty"));return o},onSubmit:function(e,n){var o,r,a,i;return null!=e&&e.preventDefault(),r=this.getLocalValidationErrors(this.state.editedAccount),a=null!=(i=this.state.editedAccount)?i.get("id"):void 0,o=this.state.editedAccount.toJS(),r.length>0?(p.alertError(t("account errors")),this.setState({submitted:!0,errors:r})):n===!0?s.check(o,a):a?s.edit(o,a):s.create(o)}})}),require.register("components/account_config_delete",function(e,n,o){var s,r,a,i,l,c,u,p;u=React.DOM.div,s=n("../actions/account_action_creator"),c=n("../actions/layout_action_creator"),p=n("./basic_components"),a=p.FieldSet,l=p.FormButtons,i=p.FormButton,o.exports=r=React.createClass({displayName:"AccountConfigDelete",getInitialState:function(){var e;return e={},e.deleting=!1,e},render:function(){return a({text:t("account danger zone")},l(null,i({className:"btn-remove","default":!0,danger:!0,onClick:this.onRemove,spinner:this.state.deleting,icon:"trash",text:t("account remove")})))},onRemove:function(e){var n;return null!=e&&e.preventDefault(),n=this.props.editedAccount.get("label"),c.displayModal({title:t("app confirm delete"),subtitle:t("account remove confirm",{label:n}),closeLabel:t("app cancel"),actionLabel:t("app confirm"),action:function(e){return function(){return c.hideModal(),e.setState({deleting:!0}),s.remove(e.props.editedAccount.get("id"))}}(this)})}})}),require.register("components/account_config_input",function(e,n,o){var s,r,a,i,l,c,u,p,d,m,h;m=React.DOM,c=m.div,p=m.label,u=m.input,d=m.textarea,h=n("./basic_components"),a=h.ErrorLine,r=h.Dropdown,l=React.addons.classSet,i=n("../mixins/router_mixin"),o.exports=s=React.createClass({displayName:"AccountInput",mixins:[i,React.addons.LinkedStateMixin],propTypes:{name:React.PropTypes.string.isRequired,error:React.PropTypes.string,className:React.PropTypes.string,onClick:React.PropTypes.func,onInput:React.PropTypes.func,onBlur:React.PropTypes.func,type:React.PropTypes.oneOf(["checkbox","textarea","email","text","password"]),valueLink:React.PropTypes.shape({value:React.PropTypes.any,requestChange:React.PropTypes.func.isRequired}),options:function(e){return"dropdown"===e.type?React.PropTypes.object.isRequired.apply(this,arguments):void 0}},getDefaultProps:function(){return{type:"text"}},render:function(){var e,n,o;return e=this.props.name,o=this.props.type||"text",n=this.buildPlaceHolder(o,e),c({key:"account-input-"+e,className:this.buildMainClasses(e)},p({htmlFor:"mailbox-"+e,className:"col-sm-2 col-sm-offset-2 control-label"},t("account "+e)),c({className:"col-sm-3"},"checkbox"===o?u({id:"mailbox-"+e,name:"mailbox-"+e,checkedLink:this.props.valueLink,type:o,onClick:this.props.onClick}):"textarea"===o?d({id:"mailbox-"+e,name:"mailbox-"+e,valueLink:this.props.valueLink,className:"form-control",placeholder:n,onBlur:this.props.onBlur,onInput:this.props.onInput}):"dropdown"===o?r({id:"mailbox-"+e,name:"mailbox-"+e,valueLink:this.props.valueLink,options:this.props.options,allowUndefined:this.props.allowUndefined}):u({id:"mailbox-"+e,name:"mailbox-"+e,valueLink:this.props.valueLink,type:o,className:"form-control",placeholder:n,onBlur:this.props.onBlur,onInput:this.props.onInput})),this.props.error?a({text:this.props.error}):void 0)},buildMainClasses:function(e){var t;return t="form-group account-item-"+e+" ",this.props.error&&(t=""+t+" has-error "),this.props.className&&(t=""+t+" "+this.props.className+" "),t},buildPlaceHolder:function(e,n){var o;return o=null,("text"===e||"email"===e||"signature"===n)&&(o=t("account "+n+" short")),o}})}),require.register("components/account_config_item",function(e,n,o){var s,r,a,i,l,c,u,p,d,m,h;h=React.DOM,d=h.li,m=h.span,u=h.i,p=h.input,c=React.addons.classSet,l=n("./basic_components").Spinner,s=n("../actions/account_action_creator"),r=n("../actions/layout_action_creator"),i=n("../mixins/router_mixin"),o.exports=a=React.createClass({displayName:"MailboxItem",mixins:[i,React.addons.LinkedStateMixin],propTypes:{mailbox:React.PropTypes.object},getInitialState:function(){return{edited:!1,favorite:this.props.favorite,deleting:!1}},render:function(){var e,n,o,s,r,a,i,h,g;return h=this.buildIndentation(),g=this.buildFavoriteValues(),n=g.favoriteClass,o=g.favoriteTitle,a=this.props.mailbox.get("nbTotal")||0,i=this.props.mailbox.get("nbUnread")||0,r=this.props.mailbox.get("nbRecent")||0,s=this.props.mailbox.get("id"),e=c({row:!0,box:!0,"box-item":!0,edited:this.state.edited}),this.state.edited?d({className:e,key:s},m({className:"col-xs-1 box-action save",onClick:this.updateMailbox,title:t("mailbox title edit save")},u({className:"fa fa-check"})),m({className:"col-xs-1 box-action cancel",onClick:this.undoMailbox,title:t("mailbox title edit cancel")},u({className:"fa fa-undo"})),p({className:"col-xs-6 box-label",ref:"label",defaultValue:this.props.mailbox.get("label"),type:"text",onKeyDown:this.onKeyDown})):d({className:e,key:s},m({className:"col-xs-1 box-action edit",onClick:this.editMailbox,title:t("mailbox title edit")},u({className:"fa fa-pencil"})),this.state.deleting?m({className:"col-xs-1 box-action delete"},l()):m({className:"col-xs-1 box-action delete",onClick:this.deleteMailbox,title:t("mailbox title delete")},u({className:"fa fa-trash-o"})),m({className:"col-xs-6 box-label",onClick:this.editMailbox},""+h+this.props.mailbox.get("label")),m({className:"col-xs-1 box-action favorite",title:o,onClick:this.toggleFavorite},u({className:n})),m({className:"col-xs-1 text-center box-count box-total"},a),m({className:"col-xs-1 text-center box-count box-unread"},i),m({className:"col-xs-1 text-center box-count box-new"},r))},buildIndentation:function(){return new Array(this.props.mailbox.get("depth")+1).join("    ")},buildFavoriteValues:function(){var e,n;return this.state.favorite?(e="fa fa-eye mailbox-visi-yes",n=t("mailbox title favorite")):(e="fa fa-eye-slash mailbox-visi-no",n=t("mailbox title not favorite")),{favoriteClass:e,favoriteTitle:n}},onKeyDown:function(e){switch(e.key){case"Enter":return this.updateMailbox()}},editMailbox:function(e){return e.preventDefault(),this.setState({edited:!0})},undoMailbox:function(e){return e.preventDefault(),this.setState({edited:!1})},updateMailbox:function(e){var t;return null!=e&&e.preventDefault(),t={label:this.refs.label.getDOMNode().value.trim(),mailboxID:this.props.mailbox.get("id"),accountID:this.props.accountID},s.mailboxUpdate(t,function(e){return function(t){return t?void 0:e.setState({edited:!1})}}(this))},toggleFavorite:function(e){var t,n;return t={favorite:!this.state.favorite,mailboxID:this.props.mailbox.get("id"),accountID:this.props.accountID},n=this.state.favorite,this.setState({favorite:!this.state.favorite}),s.mailboxUpdate(t,function(e){return e?this.setState({favorite:n}):void 0})},deleteMailbox:function(e){var n;return null!=e&&e.preventDefault(),n={title:t("app confirm delete"),subtitle:t("account confirm delbox"),closeLabel:t("app cancel"),actionLabel:t("app confirm"),action:function(e){return function(){var n;return r.hideModal(),e.setState({deleting:!0}),n={mailboxID:e.props.mailbox.get("id"),accountID:e.props.accountID},s.mailboxDelete(n,function(n){var o;return null!=n?(o=""+t("mailbox delete ko")+" "+n,r.alertError(o)):r.notify(t("mailbox delete ok"),{autoclose:!0}),e.isMounted()?e.setState({deleting:!1}):void 0})}}(this)},r.displayModal(n)}})}),require.register("components/account_config_mailboxes",function(e,n,o){var s,r,a,i,l,c,u,p,d,m,h,g,f,v,b,y,_,E,S,C,A,D,T,x=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};D=React.DOM,f=D.div,b=D.h4,A=D.ul,S=D.li,C=D.span,v=D.form,y=D.i,_=D.input,E=D.label,g=React.addons.classSet,s=n("../actions/account_action_creator"),l=n("../actions/layout_action_creator"),p=n("../mixins/router_mixin"),d=n("../mixins/should_update_mixin"),c=n("./account_config_item"),u=n("./mailbox_picker"),T=n("./basic_components"),m=T.SubTitle,i=T.Form,a=n("./account_config_delete"),h=n("../libs/cached_transform"),o.exports=r=React.createClass({displayName:"AccountConfigMailboxes",mixins:[p,React.addons.LinkedStateMixin,d.UnderscoreEqualitySlow],propTypes:{editedAccount:React.PropTypes.instanceOf(Immutable.Map).isRequired,requestChange:React.PropTypes.func.isRequired,errors:React.PropTypes.instanceOf(Immutable.Map).isRequired,onSubmit:React.PropTypes.func.isRequired},getInitialState:function(){return{newMailboxName:"",newMailboxParent:null}},makeLinkState:function(e){var t;return t=this.props.editedAccount.get(e),h(this,"__cacheLS",t,function(n){return function(){return{value:t,requestChange:function(t){var o;return o={},o[e]=t,n.props.requestChange(o)}}}}(this))},render:function(){return i({className:"form-horizontal"},m({className:"config-title"},t("account special mailboxes")),this.renderMailboxChoice("draft"),this.renderMailboxChoice("sent"),this.renderMailboxChoice("trash"),m({className:"config-title"},t("account mailboxes")),A({className:"folder-list list-unstyled boxes container"},this.props.editedAccount.get("mailboxes").length?this.renderTableHeader():void 0,this.props.editedAccount.get("mailboxes").map(function(e){return function(t,n){return c({key:n,accountID:e.props.editedAccount.get("id"),favorite:x.call(e.props.editedAccount.get("favorites"),n)>=0,mailbox:t})}}(this)).toJS(),this.renderTableFooter()))},renderError:function(){var e;return this.props.error&&"AccountConfigError"===this.props.error.name?(e=t("config error "+this.props.error.field),f({className:"alert alert-warning"},e)):this.props.error?f({className:"alert alert-warning"},this.props.error.message):0!==Object.keys(this.props.errors).length?f({className:"alert alert-warning"},t("account errors")):void 0},renderTableHeader:function(){return S({className:"row box title",key:"title"},C({className:"col-xs-1"},""),C({className:"col-xs-1"},""),C({className:"col-xs-6"},""),C({className:"col-xs-1"},""),C({className:"col-xs-1 text-center"},t("mailbox title total")),C({className:"col-xs-1 text-center"},t("mailbox title unread")),C({className:"col-xs-1 text-center"},t("mailbox title new")))},renderTableFooter:function(){return S({className:"row box new",key:"new"},C({className:"col-xs-1 box-action add",onClick:this.addMailboxClicked,title:t("mailbox title add")},y({className:"fa fa-plus"})),C({className:"col-xs-1 box-action cancel",onClick:this.resetMailboxClicked,title:t("mailbox title add cancel")},y({className:"fa fa-undo"})),f({className:"col-xs-6"},_({id:"newmailbox",type:"text",className:"form-control",placeholder:t("account newmailbox placeholder"),valueLink:this.linkState("newMailboxName"),onKeyDown:this.onNewMailboxKeyDown})),E({className:"col-xs-2 text-center control-label"},t("account newmailbox parent")),f({className:"col-xs-2 text-center"},u({allowUndefined:!0,valueLink:this.linkState("newMailboxParent"),mailboxes:this.props.editedAccount.get("mailboxes")})))},renderMailboxChoice:function(e){var n,o,s;return s=""+e+"Mailbox",o=t("account "+e+" mailbox"),n="form-group "+e+" ",this.props.editedAccount.get(s)||(n+="has-error"),f({className:n},E({className:"col-sm-2 col-sm-offset-2 control-label"},o),f({className:"col-sm-3"},u({allowUndefined:!1,valueLink:this.makeLinkState(s),mailboxes:this.props.editedAccount.get("mailboxes")})))},onNewMailboxKeyDown:function(e){return"Enter"===e.key?(e.preventDefault(),this.setState({newMailboxName:e.target.value},function(e){return function(){return e.addMailboxClicked()}}(this))):void 0},addMailboxClicked:function(e){var t;return null!=e&&e.preventDefault(),t={label:this.state.newMailboxName,accountID:this.props.editedAccount.get("id"),parentID:this.state.newMailboxParent},s.mailboxCreate(t,function(e){return function(t){return t?void 0:e.setState({newMailboxName:""})}}(this))},resetMailboxClicked:function(e){return e.preventDefault(),this.refs.newmailbox.getDOMNode().value="",this.setState({newMailboxParent:null})}});
}),require.register("components/account_config_main",function(e,n,o){var s,r,a,i,l,c,u,p,d,m,h,g,f,v,b,y,E,S,C,A,D,T,x,R,M,I,w;w=React.DOM,y=w.div,R=w.p,S=w.form,D=w.label,A=w.input,f=w.button,I=w.ul,x=w.li,h=w.a,M=w.span,C=w.i,E=w.fieldset,T=w.legend,v=React.addons.classSet,i=n("./account_config_input"),a=n("./account_config_delete"),s=n("../actions/account_action_creator"),d=n("../mixins/router_mixin"),g=n("./basic_components"),b=n("../utils/discovery_to_fields"),c=g.Form,l=g.FieldSet,p=g.FormButtons,u=g.FormButton,m={NONE:t("account smtpMethod NONE"),"CRAM-MD5":t("account smtpMethod CRAM-MD5"),LOGIN:t("account smtpMethod LOGIN"),PLAIN:t("account smtpMethod PLAIN")},o.exports=r=React.createClass({displayName:"AccountConfigMain",mixins:[d],propTypes:{editedAccount:React.PropTypes.instanceOf(Immutable.Map).isRequired,requestChange:React.PropTypes.func.isRequired,isWaiting:React.PropTypes.bool.isRequired},shouldComponentUpdate:function(e,t){var n,o;return o=_.isEqual(t,this.state),n=_.isEqual(e,this.props),!(o&&n)},getInitialState:function(){var e,t,n;return e=null!=(n=this.props.editedAccount.get("login"))?n.split("@")[1]:void 0,this.props.editedAccount.get("id")&&e&&(this._lastDiscovered=e),t={imapAdvanced:!1,smtpAdvanced:!1,displayGMAILSecurity:!1}},makeLinkState:function(e){var t,n;return t=(null!=this.__cacheLS?this.__cacheLS:this.__cacheLS={})[e],n=this.props.editedAccount.get(e)||"",(null!=t?t.value:void 0)===n?t:this.__cacheLS[e]={value:n,requestChange:function(t){return function(n){return t.props.requestChange(t.makeChanges(e,n))}}(this)}},makeChanges:function(e,t){var n;switch(n={},n[e]=t,e){case"imapPort":n.imapSSL="993"===t,n.imapTLS=!1;break;case"smtpPort":n.smtpSSL="465"===t,n.smtpTLS="587"===t;break;case"imapSSL":this.state.imapManualPort||(n.imapPort=t?"993":"143");break;case"smtpSSL":this.state.smtpManualPort||(n.smtpPort=t?"465":"25");break;case"smtpTLS":this.state.smtpManualPort||(n.smtpPort=t?"587":"25");break;case"login":this.doDiscovery(null!=t?t.split("@")[1]:void 0)}return n},componentWillReceiveProps:function(e){var t,n;return n=function(t,n){return null==n&&(n=""),e.errors.get(t)&&e.editedAccount.get(t)!==n},t={},n("imapLogin")&&(t.imapAdvanced=!0),n("smtpLogin")&&(t.smtpAdvanced=!0),n("smtpPassword")&&(t.smtpAdvanced=!0),n("smtpMethod","PLAIN")&&(t.smtpAdvanced=!0),t.smtpAdvanced||t.imapAdvanced?this.setState(t):void 0},buildButtonLabel:function(){var e;return e=this.props.isWaiting?"saving":this.props.editedAccount.get("id")?"save":"add",t("account "+e)},buildInput:function(e,t){var n;return null==t&&(t={}),null==t.name&&(t.name=e),t.key="account-config-field-"+e,null==t.valueLink&&(t.valueLink=this.makeLinkState(e)),null==t.error&&(t.error=null!=(n=this.props.errors)?n.get(e):void 0),i(t)},render:function(){var e,n,o;return e=v({"form-horizontal":!0,"form-account":!0,waiting:this.props.isWaiting}),n=null!=(null!=(o=this.props.editedAccount)?o.get("oauthProvider"):void 0),c({className:e},n?R(null,t("account oauth")):void 0,l({text:t("account identifiers")},this.buildInput("label"),this.buildInput("name"),this.buildInput("login"),n?void 0:this.buildInput("password",{type:"password"})),this.buildInput("accountType",{className:"hidden"}),this.state.displayGMAILSecurity?this._renderGMAILSecurity():void 0,n?void 0:this._renderReceivingServer(),n?void 0:this._renderSendingServer(),this._renderButtons())},_renderReceivingServer:function(){var e;return e=this.state.imapAdvanced?"hide":"show",l({text:t("account receiving server")},this.buildInput("imapServer"),this.buildInput("imapPort"),this.buildInput("imapSSL",{type:"checkbox"}),this.buildInput("imapTLS",{type:"checkbox"}),y({className:"form-group advanced-imap-toggle"},h({className:"col-sm-3 col-sm-offset-2 control-label clickable",onClick:this.toggleIMAPAdvanced},t("account imap "+e+" advanced"))),this.state.imapAdvanced?this.buildInput("imapLogin"):void 0)},_renderSendingServer:function(){var e;return e=this.state.smtpAdvanced?"hide":"show",l({text:t("account sending server")},this.buildInput("smtpServer"),this.buildInput("smtpPort"),this.buildInput("smtpSSL",{type:"checkbox"}),this.buildInput("smtpTLS",{type:"checkbox"}),y({className:"form-group advanced-smtp-toggle"},h({className:"col-sm-3 col-sm-offset-2 control-label clickable",onClick:this.toggleSMTPAdvanced},t("account smtp "+e+" advanced"))),this.state.smtpAdvanced?this.buildInput("smtpMethod",{type:"dropdown",options:m,allowUndefined:!0}):void 0,this.state.smtpAdvanced?this.buildInput("smtpLogin"):void 0,this.state.smtpAdvanced?this.buildInput("smtpPassword",{type:"password"}):void 0)},_renderGMAILSecurity:function(){var e;return e="https://www.google.com/settings/security/lesssecureapps",l({text:t("gmail security tile")},R(null,t("gmail security body",{login:this.state.login.value})),R(null,h({target:"_blank",href:e},t("gmail security link"))))},_renderButtons:function(){return 0===this.props.errors.length?l({text:t("account actions")},p(null,u({"class":"action-save",contrast:!0,icon:"save",spinner:this.props.isWaiting,onClick:this.onSubmit,text:this.buildButtonLabel()}),u({"class":"action-check",spinner:this.props.checking,onClick:this.onCheck,icon:"ellipsis-h",text:t("account check")}))):void 0},onSubmit:function(e){return this.props.onSubmit(e,!1)},onCheck:function(e){return this.props.onSubmit(e,!0)},toggleSMTPAdvanced:function(){return this.setState({smtpAdvanced:!this.state.smtpAdvanced})},toggleIMAPAdvanced:function(){return this.setState({imapAdvanced:!this.state.imapAdvanced})},doDiscovery:function(e){return null!=e&&e.length>3&&e!==this._lastDiscovered?this.discoverTimeout?this.nextDiscover=e:this.discoverTimeout=setTimeout(function(t){return function(){return t.doDiscoveryNow(e)}}(this),2e3):void 0},doDiscoveryNow:function(e){return s.discover(e,function(e){return function(t,n){var o,s;return t||(o=b(n),s="imap.googlemail.com"===o.imapServer,e.setState({displayGMAILSecurity:s}),e.props.requestChange(o)),e.nextDiscover?(e.doDiscoveryNow(e.nextDiscover),e.nextDiscover=null):e.discoverTimeout=null}}(this))}})}),require.register("components/account_config_signature",function(e,n,o){var s,r,a,i,l,c,u,p,d,m,h,g,f,v,b,y,_,E,S,C,A,D;A=React.DOM,g=A.div,v=A.h4,C=A.ul,E=A.li,S=A.span,f=A.form,b=A.i,y=A.input,_=A.label,h=React.addons.classSet,s=n("../actions/account_action_creator"),u=n("../actions/layout_action_creator"),p=n("../mixins/router_mixin"),r=n("./account_config_input"),d=n("../mixins/should_update_mixin"),m=n("../libs/cached_transform"),D=n("./basic_components"),i=D.Form,a=D.FieldSet,c=D.FormButtons,l=D.FormButton,o.exports=React.createClass({displayName:"AccountConfigSignature",mixins:[React.addons.LinkedStateMixin,d.UnderscoreEqualitySlow],propTypes:{editedAccount:React.PropTypes.instanceOf(Immutable.Map).isRequired,requestChange:React.PropTypes.func.isRequired,errors:React.PropTypes.instanceOf(Immutable.Map).isRequired,onSubmit:React.PropTypes.func.isRequired,saving:React.PropTypes.bool.isRequired},makeLinkState:function(e){var t;return t=this.props.editedAccount.get(e),m(this,"__cacheLS",t,function(n){return function(){return{value:t,requestChange:function(t){var o;return o={},o[e]=t,n.props.requestChange(o)}}}}(this))},render:function(){return i({className:"form-horizontal form-account account-signature-form"},a({text:t("account signature")},r({type:"textarea",name:"signature",valueLink:this.makeLinkState("signature"),errors:this.props.errors})),a({text:t("account actions")},c(null,l({className:"signature-save",spinner:this.props.saving,icon:"save",onClick:this.props.onSubmit,text:t("account signature save")}))))}})}),require.register("components/account_picker",function(e,t,n){var o,s,r,a,i,l,c,u,p,d;d=React.DOM,a=d.div,p=d.ul,l=d.li,c=d.p,u=d.span,s=d.a,r=d.button,i=d.input,o=t("../mixins/router_mixin"),n.exports=React.createClass({displayName:"AccountPicker",shouldComponentUpdate:function(e,t){return!_.isEqual(t,this.state)||!_.isEqual(e,this.props)},render:function(){var e;return e=this.props.accounts,1===Object.keys(e).length?this.renderNoChoice():this.renderPicker()},onChange:function(e){var t;return t=e.target.dataset.value,this.props.valueLink.requestChange(t)},renderLabel:function(e){var t;return"string"==typeof e?e:(t=e.get("name")||e.get("label"),""+t+" <"+e.get("login")+">")},renderNoChoice:function(){var e;return e=this.props.accounts.get(this.props.valueLink.value),c({className:"form-control-static align-item"},this.renderLabel(e))},renderPicker:function(){var e;return e=this.props.accounts.get(this.props.valueLink.value),a({className:"account-picker align-item"},u({className:"compose-from dropdown-toggle","data-toggle":"dropdown"},u({ref:"account","data-value":this.props.valueLink.value},this.renderLabel(e)),u({className:"caret"})),p({className:"dropdown-menu",role:"menu"},this.props.accounts.filter(function(e){return function(t,n){return n!==e.props.valueLink.value}}(this)).map(function(e){return function(t,n){return e.renderAccount(n,t)}}(this)).toJS()))},renderAccount:function(e,t){return l({role:"presentation",key:e},s({role:"menuitem",onClick:this.onChange,"data-value":e},this.renderLabel(t)))}})}),require.register("components/alert",function(e,n,o){var s,r,a,i,l,c,u;u=React.DOM,i=u.div,a=u.button,l=u.span,c=u.strong,s=n("../constants/app_constants").AlertLevel,r=n("../actions/layout_action_creator"),o.exports=React.createClass({displayName:"Alert",render:function(){var e,n;return e=this.props.alert,null!=e.level&&(n={},n[s.SUCCESS]="alert-success",n[s.INFO]="alert-info",n[s.WARNING]="alert-warning",n[s.ERROR]="alert-danger"),i({className:"row row-alert"},null!=e.level?i({ref:"alert",className:"alert "+n[e.level]+" alert-dismissible",role:"alert"},a({type:"button",className:"close",onClick:this.hide},l({"aria-hidden":"true"},"×"),l({className:"sr-only"},t("app alert close"))),c(null,e.message)):void 0)},hide:function(){return r.alertHide()},autohide:function(){},componentDidMount:function(){return this.autohide()},componentDidUpdate:function(){return this.autohide()}})}),require.register("components/application",function(e,n,o){var s,r,a,i,l,c,u,p,d,m,h,g,f,v,b,y,_,E,S,C,A,D,T,x,R,M,I,w,N,k;k=React.DOM,A=k.div,I=k.section,R=k.main,M=k.p,w=k.span,S=k.a,T=k.i,N=k.strong,D=k.form,x=k.input,C=k.button,r=n("./alert"),c=n("./menu"),m=n("./modal"),h=n("./panel"),y=n("./toast_container"),E=n("./tooltips-manager"),g=n("../mixins/router_mixin"),v=n("../mixins/store_watch_mixin"),_=n("../mixins/tooltip_refresher_mixin"),s=n("../stores/account_store"),d=n("../stores/message_store"),l=n("../stores/layout_store"),f=n("../stores/search_store"),b=[s,d,l,f],i=n("../actions/layout_action_creator"),u=n("../actions/message_action_creator"),p=n("../constants/app_constants").MessageFilter,o.exports=a=React.createClass({displayName:"Application",mixins:[v(b),g,_],render:function(){var e,n,o,s,r,a,i;return s=this.props.router.current,null==s?A(null,t("app loading")):(e=l.getDisposition(),o=l.getListModeCompact(),n=l.isPreviewFullscreen(),i=l.getPreviewSize(),a=this.state.modal,r=["layout","layout-"+e,o?"layout-compact":void 0,n?"layout-preview-fullscreen":void 0,"layout-preview-"+i].join(" "),A({className:r},A({className:"app"},c({ref:"menu",layout:this.props.router.current}),R({className:null!=s.secondPanel?null:"full"},A({className:"panels"},this.getPanel(s.firstPanel,"firstPanel"),null!=s.secondPanel?this.getPanel(s.secondPanel,"secondPanel"):I({key:"placeholder","aria-expanded":!1})))),null!=a?m(a):void 0,y(),E({key:"tooltips"})))},getPanel:function(e,t){return h({ref:t,action:e.action,accountID:e.parameters.accountID,mailboxID:e.parameters.mailboxID,messageID:e.parameters.messageID,tab:e.parameters.tab,useIntents:this.state.useIntents,selectedMailboxID:this.state.selectedMailboxID})},getStateFromStores:function(){var e,t,n,o;return t=s.getSelectedOrDefault(),e=null!=(o=this.props.router.current)?o.firstPanel:void 0,n="account.mailbox.messages"===(null!=e?e.action:void 0)?e.parameters.mailboxID:null,{selectedAccount:t,currentSearch:f.getCurrentSearch(),modal:l.getModal(),useIntents:l.intentAvailable(),selectedMailboxID:n}},componentWillMount:function(){return this.onRoute=function(e){return function(t){var n,o,s,r;return n=t.firstPanel,r=t.secondPanel,null!=n&&e.checkAccount(n.action),null!=r&&e.checkAccount(r.action),null!=r&&null!=r.parameters.messageID?(o=null!=r.parameters.conversationID,s=r.parameters.messageID,u.setCurrent(s,o)):"compose"!==n&&u.setCurrent(null),e.forceUpdate()}}(this),this.props.router.on("fluxRoute",this.onRoute)},checkAccount:function(e){var n,o,s;return n=this.state.selectedAccount,s=null==(null!=n?n.get("draftMailbox"):void 0)||null==(null!=n?n.get("sentMailbox"):void 0)||null==(null!=n?n.get("trashMailbox"):void 0),o="account.mailbox.messages"===e||"message"===e||"conversation"===e||"compose"===e||"edit"===e,null!=n&&s&&o?(this.redirect({direction:"first",action:"account.config",parameters:[n.get("id"),"mailboxes"],fullWidth:!0}),i.alertError(t("account no special mailboxes"))):void 0},componentWillUnmount:function(){return this.props.router.off("fluxRoute",this.onRoute)}})}),require.register("components/attachement_preview",function(e,n,o){var s,r,a,i,l,c,u;u=React.DOM,c=u.li,l=u.img,a=u.a,i=u.i,s=n("../utils/message_utils"),r=n("../constants/app_constants").Tooltips,o.exports=React.createClass({displayName:"AttachmentPreview",icons:{archive:"fa-file-archive-o",audio:"fa-file-audio-o",code:"fa-file-code-o",image:"fa-file-image-o",pdf:"fa-file-pdf-o",word:"fa-file-word-o",presentation:"fa-file-powerpoint-o",spreadsheet:"fa-file-excel-o",text:"fa-file-text-o",video:"fa-file-video-o",word:"fa-file-word-o"},render:function(){return this.props.previewLink?c({key:this.props.key},a({className:"file-details",target:"_blank",href:this.props.file.url,"aria-describedby":r.OPEN_ATTACHMENT,"data-tooltip-direction":"top"},this.props.preview?l({height:48,src:this.props.file.url}):void 0,this.renderIcon(),this.props.file.generatedFileName,this.displayFilesize(this.props.file.length)),a({className:"file-actions",href:""+this.props.file.url+"?download=1","aria-describedby":r.DOWNLOAD_ATTACHMENT,"data-tooltip-direction":"top"},i({className:"fa fa-download"}))):c({key:this.props.key},this.renderIcon(),a({href:""+this.props.file.url+"?download=1","aria-describedby":r.DOWNLOAD_ATTACHMENT,"data-tooltip-direction":"left"},""+this.props.file.generatedFileName+"\n("+this.displayFilesize(this.props.file.length)+")"))},renderIcon:function(){var e;return e=s.getAttachmentType(this.props.file.contentType),i({className:"mime "+e+" fa "+(this.icons[e]||"fa-file-o")})},displayFilesize:function(e){return 1024>e?""+e+" "+t("length bytes"):1048576>e?""+(0|e/1024)+" "+t("length kbytes"):""+(0|e/1048576)+" "+t("length mbytes")}})}),require.register("components/basic_components",function(e,t,n){var o,s,r,a,i,l,c,u,p,d,m,h,g,f,v,b,y,_,E,S,C,A,D,T,x,R,M,I,w,N,k,L,O,P,U,F;F=React.DOM,D=F.div,O=F.section,R=F.h3,M=F.h4,U=F.ul,L=F.li,S=F.a,I=F.i,C=F.button,P=F.span,T=F.fieldset,k=F.legend,N=F.label,w=F.img,x=F.form,A=React.addons.classSet,v=t("../libs/prop_types"),s=React.createClass({render:function(){return O({id:this.props.id,key:this.props.key,className:"panel"},this.props.children)}}),E=React.createClass({render:function(){return R({refs:this.props.ref,className:"title"},this.props.text)}}),y=React.createClass({render:function(){return M({className:"subtitle "+this.props.className},this.props.children)}}),_=React.createClass({render:function(){var e,t,n;return U({className:"nav nav-tabs",role:"tablist"},function(){var o,s,r;o=this.props.tabs,r=[];for(e in o)t=o[e],n=(null!=(s=t["class"])?s.indexOf("active"):void 0)>=0?null:t.url,r.push(L({key:"tab-li-"+e,className:t["class"]},S({href:n,key:"tab-"+e},t.text)));return r}.call(this))}}),i=React.createClass({render:function(){return D({className:"col-sm-5 col-sm-offset-2 control-label"},this.props.text)}}),c=React.createClass({render:function(){return x({id:this.props.id,className:this.props.className,method:"POST"},this.props.children)}}),l=React.createClass({render:function(){return T(null,k(null,this.props.text),this.props.children)}}),u=React.createClass({render:function(){var e;return e="btn ",e+=this.props.contrast?"btn-cozy-contrast ":this.props["default"]?"btn-cozy-default ":"btn-cozy ",this.props.danger&&(e+="btn-danger "),null!=this.props.className&&(e+=this.props.className),C({className:e,onClick:this.props.onClick},this.props.spinner?P(null,b({white:!0})):P({className:"fa fa-"+this.props.icon}),P(null,this.props.text))}}),p=React.createClass({render:function(){return D({className:"col-sm-offset-4"},this.props.children)}}),g=React.createClass({onClick:function(){return this.props.onClick(this.props.onClickValue)},render:function(){var e,t;return t={role:"presentation"},this.props.key&&(t.key=this.props.key),this.props.liClassName&&(t.className=this.props.liClassName),e={role:"menuitemu",onClick:this.onClick},this.props.className&&(e.className=this.props.className),this.props.href&&(e.href=this.props.href),this.props.target&&(e.target=this.props.href),L(t,S(e,this.props.children))}}),h=React.createClass({render:function(){var e;return e={role:"presentation",className:"dropdown-header"},this.props.key&&(e.key=this.props.key),L(e,this.props.children)}}),m=React.createClass({render:function(){var e;return e={role:"presentation",className:"divider"},this.props.key&&(e.key=this.props.key),L(e)}}),r=React.createClass({getDefaultProps:function(){return{className:"",btnClassName:"",allowUndefined:!1}},propTypes:{valueLink:v.valueLink(v.string).isRequired,allowUndefined:React.PropTypes.bool.isRequired,options:React.PropTypes.object.isRequired,className:React.PropTypes.string,id:React.PropTypes.string,btnClassName:React.PropTypes.string,defaultLabel:React.PropTypes.string,undefinedValue:React.PropTypes.string},render:function(){var e,t,n,o,s,r;return r=this.props.valueLink||{value:this.props.value,requestChange:this.props.onChange},t="dropdown "+this.props.className,e="dropdown-toggle "+this.props.btnClassName,o=this.props.options[r.value],D({className:t,id:this.props.id},C({className:e,"data-toggle":"dropdown"},o||this.props.defaultLabel,P({className:"caret"},"")),U({className:"dropdown-menu",role:"menu"},this.props.allowUndefined&&null!=o?a({key:null,value:this.props.undefinedValue,requestChange:r.requestChange}):void 0,function(){var e,t;e=this.props.options,t=[];for(n in e)s=e[n],n!==r.value?t.push(a({key:n,value:s,requestChange:r.requestChange})):t.push(void 0);return t}.call(this)))}}),a=React.createClass({onClick:function(){return this.props.requestChange(this.props.key)},render:function(){return L({role:"presentation",key:this.props.key,onClick:this.onClick},S({role:"menuitem"},this.props.value))}}),o=React.createClass({render:function(){var e,t,n,o,s;return t=0,(null!=(o=this.props.contact.name)?o.length:void 0)>0&&this.props.contact.address?(e=this.props.contact.address.replace(/\W/g,""),n=P(null,P({className:"highlight"},this.props.contact.name),P({className:"contact-address",key:e},I({className:"fa fa-angle-left"}),this.props.contact.address,I({className:"fa fa-angle-right"})))):n=(null!=(s=this.props.contact.name)?s.length:void 0)>0?P({key:"label-"+t++},this.props.contact.name):P(null,this.props.contact.address),n}}),b=React.createClass({displayName:"Spinner",protoTypes:{white:React.PropTypes.bool},render:function(){var e;return e=this.props.white?"-white":"",w({src:"images/spinner"+e+".svg",alt:"spinner",className:"button-spinner"})}}),f=React.createClass({displayName:"Progress",propTypes:{value:React.PropTypes.number.isRequired,max:React.PropTypes.number.isRequired},render:function(){return D({className:"progress"},D({className:A({"progress-bar":!0,actived:this.props.value>0}),style:{width:0},role:"progressbar","aria-valuenow":this.props.value,"aria-valuemin":"0","aria-valuemax":this.props.max}))}}),d=React.createClass({displayName:"Icon",propTypes:{type:React.PropTypes.string.isRequired},render:function(){var e;return e=""+(this.props.className||"")+" fa fa-"+this.props.type,I({className:e,onClick:this.props.onClick})}}),n.exports={AddressLabel:o,Container:s,Dropdown:r,ErrorLine:i,Form:c,FieldSet:l,FormButton:u,FormButtons:p,Icon:d,MenuItem:g,MenuHeader:h,MenuDivider:m,Progress:f,Spinner:b,SubTitle:y,Title:E,Tabs:_}}),require.register("components/compose",function(e,n,o){var s,r,a,i,l,c,u,p,d,m,h,g,f,v,b,y,E,S,C,A,D,T,x,R,M,I,w,N,k,L;N=React.DOM,E=N.div,R=N.section,C=N.h3,b=N.a,A=N.i,I=N.textarea,S=N.form,T=N.label,k=React.DOM,M=k.span,w=k.ul,x=k.li,D=k.input,y=React.addons.classSet,l=n("./compose_editor"),c=n("./compose_toolbox"),u=n("./file_picker"),d=n("./mails_input"),s=n("./account_picker"),r=n("../stores/account_store"),h=n("../stores/message_store"),L=n("../constants/app_constants"),i=L.ComposeActions,v=L.Tooltips,g=n("../utils/message_utils"),p=n("../actions/layout_action_creator"),m=n("../actions/message_action_creator"),f=n("../mixins/router_mixin"),o.exports=a=React.createClass({displayName:"Compose",mixins:[f,React.addons.LinkedStateMixin],propTypes:{selectedAccountID:React.PropTypes.string.isRequired,selectedAccountLogin:React.PropTypes.string.isRequired,layout:React.PropTypes.string,accounts:React.PropTypes.object.isRequired,message:React.PropTypes.object,action:React.PropTypes.string,callback:React.PropTypes.func,onCancel:React.PropTypes.func,settings:React.PropTypes.object.isRequired,useIntents:React.PropTypes.bool.isRequired},getDefaultProps:function(){return{layout:"full"}},shouldComponentUpdate:function(e,t){return!_.isEqual(t,this.state)||!_.isEqual(e,this.props)},render:function(){var e,n,o,r,a,i,p;if(this.props.accounts)return a=this.buildClosePanelUrl(this.props.layout),r="compose-label",o="compose-input",n=this.state.ccShown?" shown ":"",e=this.state.bccShown?" shown ":"",i=Array.isArray(this.state.to)&&this.state.to.length>0&&""!==this.state.subject,R({className:y({compose:!0,panel:"full"===this.props.layout}),"aria-expanded":!0},S({className:"form-compose",method:"POST"},E({className:"form-group account"},T({htmlFor:"compose-from",className:r},t("compose from")),s({accounts:this.props.accounts,valueLink:this.linkState("accountID")})),E({className:"clearfix"},null),E({className:o},E({className:"btn-toolbar compose-toggle",role:"toolbar"},E(null),b({className:"compose-toggle-cc",onClick:this.onToggleCc},t("compose toggle cc")),b({className:"compose-toggle-bcc",onClick:this.onToggleBcc},t("compose toggle bcc")))),d({id:"compose-to",valueLink:this.linkState("to"),label:t("compose to"),ref:"to"}),d({id:"compose-cc",className:"compose-cc"+n,valueLink:this.linkState("cc"),label:t("compose cc"),placeholder:t("compose cc help"),ref:"cc"}),d({id:"compose-bcc",className:"compose-bcc"+e,valueLink:this.linkState("bcc"),label:t("compose bcc"),placeholder:t("compose bcc help"),ref:"bcc"}),E({className:"form-group"},E({className:o},D({id:"compose-subject",name:"compose-subject",ref:"subject",valueLink:this.linkState("subject"),type:"text",className:"form-control compose-subject",placeholder:t("compose subject help")}))),E({className:"compose-content"},l({id:"compose-editor",messageID:null!=(p=this.props.message)?p.get("id"):void 0,html:this.linkState("html"),text:this.linkState("text"),accounts:this.props.accounts,accountID:this.state.accountID,settings:this.props.settings,onSend:this.onSend,composeInHTML:this.state.composeInHTML,focus:i,ref:"editor",getPicker:this.getPicker,useIntents:this.props.useIntents})),E({className:"attachements"},u({className:"",editable:!0,valueLink:this.linkState("attachments"),ref:"attachments"})),c({saving:this.state.saving,sending:this.state.sending,onSend:this.onSend,onDelete:this.onDelete,onDraft:this.onDraft,onCancel:this.onCancel,canDelete:null!=this.props.message}),E({className:"clearfix"},null)))},finalRedirect:function(){return null!=this.props.inReplyTo?this.redirect(h.getMessageHash(this.props.inReplyTo)):this.redirect(this.buildUrl({direction:"first",action:"default",fullWidth:!0}))},onCancel:function(e){return e.preventDefault(),null!=this.props.onCancel?this.props.onCancel():this.finalRedirect()},_initCompose:function(){var e;return this._saveInterval&&window.clearInterval(this._saveInterval),this._saveInterval=window.setInterval(this._autosave,3e4),this._autosave(),this.getDOMNode().scrollIntoView(),Array.isArray(this.state.to)&&0!==this.state.to.length?null!=this.props.inReplyTo&&null!=(e=document.getElementById("compose-editor"))?e.focus():void 0:setTimeout(function(){var e;return null!=(e=document.getElementById("compose-to"))?e.focus():void 0},10)},componentDidMount:function(){return this._initCompose()},componentDidUpdate:function(){switch(this.state.focus){case"cc":return setTimeout(function(){return document.getElementById("compose-cc").focus()},0),this.setState({focus:""});case"bcc":return setTimeout(function(){return document.getElementById("compose-bcc").focus()},0),this.setState({focus:""})}},componentWillUnmount:function(){var e,n,o,s,r,a;return this._saveInterval&&window.clearInterval(this._saveInterval),e=function(e){return function(){return window.setTimeout(function(){var t;return p.hideModal(),t=e.state.id,m["delete"]({messageID:t,silent:r,isDraft:!0,inReplyTo:e.props.inReplyTo})},5)}}(this),n=function(e){return function(){var n;return null!=e.state.originalConversationID?(n={id:e.state.id,accountID:e.state.accountID,mailboxIDs:e.state.mailboxIDs,from:e.state.from,to:e.state.to,cc:e.state.cc,bcc:e.state.bcc,subject:e.state.subject,isDraft:!0,attachments:e.state.attachments,inReplyTo:e.state.inReplyTo,references:e.state.references,text:e.state.text,html:e.state.html,conversationID:e.state.originalConversationID},m.send(n,function(e,n){var o,s;return null!=e||null==n?(s=""+t("message action draft ko")+" "+e,p.alertError(s)):(s=""+t("message action draft ok"),p.notify(s,{autoclose:!0}),null!=n.conversationID?(o=n.conversationID,m.fetchConversation(o)):void 0)})):void 0}}(this),!this.state.isDeleted&&this.state.isDraft&&null!=this.state.id?(this.state.composeInHTML?(o=g.cleanReplyText(this.state.html).replace(/\s/gim,""),s=g.cleanReplyText(this.state.initHtml).replace(/\s/gim,""),a=o!==s):a=this.state.text!==this.state.initText,r=this.state.isNew&&!a,r?e():setTimeout(function(){var o;return o={title:t("app confirm delete"),subtitle:t("compose confirm keep draft"),closeModal:function(){return n(),p.hideModal()},closeLabel:t("compose confirm draft keep"),actionLabel:t("compose confirm draft delete"),action:e},p.displayModal(o)},0)):void 0},getInitialState:function(){var e,t,n,o,s,r;if(n=this.props.message){o={composeInHTML:this.props.settings.get("composeInHTML"),isNew:!1},null==n.get("html")&&n.get("text")&&(o.conposeInHTML=!1),r=n.toJS();for(t in r)s=r[t],o[t]=s;o.attachments=n.get("attachments")}else e=this.props.accounts.get(this.props.selectedAccountID),o=g.makeReplyMessage(e.get("login"),this.props.inReplyTo,this.props.action,this.props.settings.get("composeInHTML"),e.get("signature")),o.isNew=!0,null==o.accountID&&(o.accountID=this.props.selectedAccountID),o.originalConversationID=o.conversationID;return o.isDraft=!0,o.sending=!1,o.saving=!1,o.ccShown=Array.isArray(o.cc)&&o.cc.length>0,o.bccShown=Array.isArray(o.bcc)&&o.bcc.length>0,o.initHtml=o.html,o.initText=o.text,o},componentWillReceiveProps:function(e){return e.message!==this.props.message?(this.props.message=e.message,this.setState(this.getInitialState())):void 0},onDraft:function(e){return e.preventDefault(),this._doSend(!0)},onSend:function(e){return null!=e&&e.preventDefault(),this._doSend(!1)},_doSend:function(e){var n,o,s,r;return n=this.props.accounts.get(this.state.accountID),o={name:n.get("name")||void 0,address:n.get("login")},s={id:this.state.id,accountID:this.state.accountID,mailboxIDs:this.state.mailboxIDs,from:[o],to:this.state.to,cc:this.state.cc,bcc:this.state.bcc,subject:this.state.subject,isDraft:e,attachments:this.state.attachments,inReplyTo:this.state.inReplyTo,references:this.state.references},e||(s.conversationID=this.state.originalConversationID),r=!0,e||(0===this.state.to.length&&0===this.state.cc.length&&0===this.state.bcc.length?(r=!1,p.alertError(t("compose error no dest")),setTimeout(function(){return document.getElementById("compose-to").focus()},0)):""===this.state.subject&&(r=!1,p.alertError(t("compose error no subject")),setTimeout(function(e){return function(){return e.refs.subject.getDOMNode().focus()}}(this),0))),r?(this.state.composeInHTML?(s.html=this._cleanHTML(this.state.html),s.text=g.cleanReplyText(s.html),s.html=g.wrapReplyHtml(s.html)):s.text=this.state.text.trim(),!e&&this._saveInterval&&window.clearInterval(this._saveInterval),e?this.setState({saving:!0}):this.setState({sending:!0,isDraft:!1}),m.send(s,function(n){return function(o,s){var r,a,i,l,c,u,d,h,g;null==o&&null==n.state.id&&null!=s&&m.setCurrent(s.id),c=_.clone(n.state),e?c.saving=!1:(c.isDraft=!1,c.sending=!1);for(a in s)u=s[a],"attachments"!==a&&"html"!==a&&"text"!==a&&(c[a]=u);for(g=Object.keys(n.state),d=0,h=g.length;h>d;d++)a=g[d],"saving"!==a&&(c[a]=n.state[a]);return n.isMounted()&&n.setState(c),e?i=t("message action draft ko"):(i=t("message action sent ko"),l=t("message action sent ok")),null!=o||null==s?p.alertError(""+i+" "+o):(e||p.notify(l,{autoclose:!0}),null==n.state.id&&m.setCurrent(s.id),e?void 0:(null!=s.conversationID&&(r=s.conversationID,m.fetchConversation(r)),n.finalRedirect()))}}(this))):void 0},_autosave:function(){return this.props.settings.get("autosaveDraft")?this._doSend(!0):void 0},_cleanHTML:function(e){var t,n,o,s,r,a,i;if(r=new DOMParser,t=r.parseFromString(e,"text/html"),t||(t=document.implementation.createHTMLDocument(""),t.documentElement.innerHTML=e),t){for(o=function(e){return e.setAttribute("src","cid:"+e.dataset.src)},s=t.querySelectorAll("IMG[data-src]"),a=0,i=s.length;i>a;a++)n=s[a],o(n);return t.documentElement.innerHTML}return console.error("Unable to parse HTML content of message"),e},onDelete:function(e){var n,o,s,r,a;return e.preventDefault(),a=this.props.message.get("subject"),null!=a&&""!==a?(r={subject:this.props.message.get("subject")},n=t("mail confirm delete",r)):n=t("mail confirm delete nosubject"),o=function(e){return function(){var t;return p.hideModal(),t=e.props.message.get("id"),e.setState({isDeleted:!0},function(){return m["delete"]({messageID:t},function(t){var n;return null==t?e.props.callback?e.props.callback():(n=[e.props.selectedAccountID,e.props.selectedMailboxID],e.redirect({direction:"first",action:"account.mailbox.messages",parameters:n,fullWidth:!0})):void 0})})}}(this),s={title:t("mail confirm delete title"),subtitle:n,closeLabel:t("mail confirm delete cancel"),actionLabel:t("mail confirm delete delete"),action:o},p.displayModal(s)},onToggleCc:function(e){var t,n,o,s,r;for(n=function(e){return e.classList.toggle("shown")},r=this.getDOMNode().querySelectorAll(".compose-cc"),o=0,s=r.length;s>o;o++)e=r[o],n(e);return t=this.state.ccShown?"":"cc",this.setState({ccShown:!this.state.ccShown,focus:t})},onToggleBcc:function(e){var t,n,o,s,r;for(n=function(e){return e.classList.toggle("shown")},r=this.getDOMNode().querySelectorAll(".compose-bcc"),o=0,s=r.length;s>o;o++)e=r[o],n(e);return t=this.state.bccShown?"":"bcc",this.setState({bccShown:!this.state.bccShown,focus:t})},getPicker:function(){return this.refs.attachments}})}),require.register("components/compose_editor",function(e,t,n){var o,s,r,a,i,l;l=React.DOM,a=l.div,r=l.button,i=l.textarea,s=t("../utils/file_utils"),n.exports=o=React.createClass({displayName:"ComposeEditor",mixins:[React.addons.LinkedStateMixin],getInitialState:function(){return{html:this.props.html,text:this.props.text,target:!1}},componentWillReceiveProps:function(e){return e.messageID!==this.props.messageID?this.setState({html:e.html,text:e.text}):void 0},shouldComponentUpdate:function(e,t){return!_.isEqual(t,this.state)||!_.isEqual(e,this.props)},onHTMLChange:function(e){return this.props.html.requestChange(this.refs.html.getDOMNode().innerHTML)},onTextChange:function(e){
return this.props.text.requestChange(this.refs.content.getDOMNode().value)},render:function(){var e,t;return e=this.props.settings.get("composeOnTop")?"folded":"",t=this.state.target?"target":"",a(null,this.props.useIntents?a({className:"btn-group editor-actions"},r({className:"btn btn-default",onClick:this.choosePhoto},span({className:"fa fa-image","aria-describedby":Tooltips.COMPOSE_IMAGE,"data-tooltip-direction":"top"}))):void 0,this.props.composeInHTML?a({className:"form-control rt-editor "+e+" "+t,ref:"html",contentEditable:!0,onKeyDown:this.onKeyDown,onInput:this.onHTMLChange,onDragOver:this.allowDrop,onDragEnter:this.onDragEnter,onDragLeave:this.onDragLeave,onDrop:this.handleFiles,onBlur:this.onHTMLChange,dangerouslySetInnerHTML:{__html:this.state.html.value}}):i({className:"editor "+t,ref:"content",onKeyDown:this.onKeyDown,onChange:this.onTextChange,onBlur:this.onTextChange,defaultValue:this.state.text.value,onDragOver:this.allowDrop,onDragEnter:this.onDragEnter,onDragLeave:this.onDragLeave,onDrop:this.handleFiles}))},_initCompose:function(){var e,t,n,o,s,r;if(this.props.composeInHTML){if(this.setCursorPosition(),t=document.queryCommandEnabled("insertBrOnReturn"),jQuery(".rt-editor").on("keypress",function(e){var n;if(13===e.keyCode)return n=function(){var e,n,o,s,r,a,i,l,c;for(s=function(e){var t;if(t=document.documentElement.matches||document.documentElement.matchesSelector||document.documentElement.webkitMatchesSelector||document.documentElement.mozMatchesSelector||document.documentElement.oMatchesSelector||document.documentElement.msMatchesSelector,null!=t)return t.call(e,".rt-editor blockquote, .rt-editor blockquote *");for(;null!=e&&"BLOCKQUOTE"!==e.tagName;)e=e.parentNode;return"BLOCKQUOTE"===e.tagName},l=document.getSelection().anchorNode,null!=l.lastChild&&(l=l.lastChild,null!=l.previousElementSibling&&(l=l.previousElementSibling)),c=l;c&&!(c instanceof Element);)c=c.parentNode;if(null!=l&&s(c)){for(e=t?"\r\n<br>\r\n<br class='cozyInsertedBr'>\r\n":"\r\n<div></div><div><br class='cozyInsertedBr'></div>\r\n",document.execCommand("insertHTML",!1,e),r=document.querySelector(".cozyInsertedBr"),t&&(r=r.previousElementSibling),o=function(e){var t;for(t=e.tagName;null!=e.parentNode&&"true"!==e.contentEditable;)e=e.parentNode,t=""+e.tagName+" > "+t;return t},i=window.getSelection(),a=document.createRange(),a.selectNode(r),i.removeAllRanges(),i.addRange(a),n=o(r).split(">").length;n>0;)document.execCommand("outdent",!1,null),n--;r=document.querySelector(".cozyInsertedBr"),null!=r&&r.parentNode.removeChild(r),document.execCommand("removeFormat",!1,null)}},setTimeout(n,50)}),!document.querySelector(".rt-editor blockquote")||document.querySelector(".rt-editor .originalToggle"))return jQuery(".rt-editor .originalToggle").on("click",function(){return jQuery(".rt-editor").toggleClass("folded")});try{return n=jQuery(".rt-editor blockquote").eq(0).prev(),n.text(n.text().replace("…","")),n.append('<span class="originalToggle">…</>'),n.on("click",function(){return jQuery(".rt-editor").toggleClass("folded")})}catch(a){return e=a,console.error(e)}}else if(this.props.focus)return o=this.refs.content.getDOMNode(),this.props.settings.get("composeOnTop")||(r=o.getBoundingClientRect(),o.scrollTop=o.scrollHeight-r.height,"number"==typeof o.selectionStart?(o.selectionStart=o.value.length,o.selectionEnd=o.value.length):"undefined"!=typeof o.createTextRange&&(setTimeout(function(){return o.focus()},0),s=o.createTextRange(),s.collapse(!1),s.select())),setTimeout(function(){return o.focus()},0)},setCursorPosition:function(){var e,t,n,o,s,r;return this.props.focus&&(t=null!=(r=this.refs.html)?r.getDOMNode():void 0,null!=t&&(document.querySelector(".rt-editor").focus(),!this.props.settings.get("composeOnTop")&&(e=this.props.accounts[this.props.accountID],s=document.getElementById("signature"),null!=e.signature&&e.signature.length>0&&null!=s?(t=s,t.innerHTML="<p><br /></p>\n"+t.innerHTML,t=t.firstChild):(t.innerHTML+="<p><br /></p><p><br /></p>",t=t.lastChild),null!=t)))?(t.scrollIntoView(!1),t.innerHTML="<br >",o=window.getSelection(),n=document.createRange(),n.selectNodeContents(t),o.removeAllRanges(),o.addRange(n),document.execCommand("delete",!1,null),t.focus()):void 0},componentDidMount:function(){return this._initCompose()},componentDidUpdate:function(e,t){return e.messageID!==this.props.messageID&&this._initCompose(),e.accountID!==this.props.accountID?this._updateSignature():void 0},_updateSignature:function(){var e,t,n,o,s;return n=this.props.accounts[this.props.accountID].signature,null!=this.refs.html?(s=document.getElementById("signature"),null!=n&&n.length>0?(o=n.replace(/\n/g,"<br>"),null!=s?s.innerHTML="-- \n<br>"+o+"</p>":this.refs.html.getDOMNode().innerHTML+='<p><br></p><p id="signature">-- \n<br>'+o+"</p>"):null!=s&&s.parentNode.removeChild(s),this.onHTMLChange()):null!=this.refs.content?(e=this.refs.content.getDOMNode(),t=this.props.accounts[oldProps.accountID].signature,null!=n&&n.length>0?t&&t.length>0?e.textContent=e.textContent.replace(t,n):e.textContent+="\n\n-- \n"+n:t&&t.length>0&&(t="-- \n"+n,e.textContent=e.textContent.replace(t,"")),this.onTextChange()):void 0},onKeyDown:function(e){return e.ctrlKey&&"Enter"===e.key?this.props.onSend():void 0},allowDrop:function(e){return e.preventDefault()},onDragEnter:function(e){return this.state.target?void 0:this.setState({target:!0})},onDragLeave:function(e){return this.state.target?this.setState({target:!1}):void 0},handleFiles:function(e){var t,n,o,r,a,i,l;if(e.preventDefault(),n=e.target.files||e.dataTransfer.files,this.props.getPicker().addFiles(n),this.props.composeInHTML)for(i=0,l=n.length;l>i;i++)t=n[i],"image"===t.type.split("/")[0]&&(o="editor-img-"+new Date,r="<img data-src='"+t.name+"' id='"+o+"'>",document.activeElement.classList.contains("rt-editor")?document.execCommand("insertHTML",!1,r):(a=document.getElementById("signature"),null!=a?a.previousElementSibling.innerHTML+=r:document.querySelector(".rt-editor").innerHTML+=r),s.fileToDataURI(t,function(e){return function(t){return r=document.getElementById(o),r?(r.removeAttribute("id"),r.src=t,e.onHTMLChange()):void 0}}(this)));return this.setState({target:!1})},choosePhoto:function(e){var t,n;return e.preventDefault(),t={type:"pickObject",params:{objectType:"singlePhoto",isCropped:!1}},n=3e4,window.intentManager.send("nameSpace",t,n).then(this.choosePhoto_answer,function(e){return console.error("response in error : ",e)})},choosePhoto_answer:function(e){var t,n,o,r,a,i,l;return t=e.data,t.newPhotoChosen&&(o=s.dataURItoBlob(t.dataUrl),n=new Blob([o.blob,{type:o.mime}]),n.name=t.name,i=this.props.getPicker(),i.addFiles([n]),this.props.composeInHTML)?(document.activeElement.classList.contains("rt-editor")?document.execCommand("insertHTML",!1,'<img src="'+t.dataUrl+'" data-src="'+t.name+'">'):(a=document.createElement("img"),a.src=t.dataUrl,a.dataset.src=t.name,l=document.getElementById("signature"),null!=l?l.parentNode.insertBefore(a,l):(r=document.querySelector(".rt-editor"),null!=r&&r.appendChild(a))),this.onHTMLChange()):void 0}})}),require.register("components/compose_toolbox",function(e,n,o){var s,r,a,i,l,c;c=React.DOM,i=c.div,a=c.button,l=c.span,r=n("./basic_components").Spinner,o.exports=s=React.createClass({displayName:"ComposeToolbox",render:function(){var e;return e=this.props.sending?t("compose action sending"):t("compose action send"),i({className:"composeToolbox"},i({className:"btn-toolbar",role:"toolbar"},i({className:""},a({className:"btn btn-cozy btn-send",type:"button",disable:this.props.sending?!0:null,onClick:this.props.onSend},this.props.sending?l(null,r({white:!0})):l({className:"fa fa-send"}),l(null,e)),a({className:"btn btn-cozy btn-save",disable:this.props.saving?!0:null,type:"button",onClick:this.props.onDraft},this.props.saving?l(null,r({white:!0})):l({className:"fa fa-save"}),l(null,t("compose action draft"))),this.props.canDelete?a({className:"btn btn-cozy-non-default btn-delete",type:"button",onClick:this.props.onDelete},l({className:"fa fa-trash-o"}),l(null,t("compose action delete"))):void 0,a({onClick:this.props.onCancel,className:"btn btn-cozy-non-default btn-cancel"},t("app cancel")))))}})}),require.register("components/contact_label",function(e,n,o){var s,r,a,i,l,c,u,p,d,m,h,g,f,v,b,y,E,S;S=React.DOM,b=S.section,h=S.header,E=S.ul,f=S.li,y=S.span,g=S.i,v=S.p,m=S.h3,p=S.a,d=S.button,u=n("../constants/app_constants").Tooltips,c=n("../utils/message_utils"),i=n("../stores/contact_store"),r=n("../actions/contact_action_creator"),l=n("../actions/layout_action_creator"),s=n("./basic_components").AddressLabel,o.exports=a=React.createClass({shouldComponentUpdate:function(e,t){var n;return n=!_.isEqual(e,this.props)},render:function(){var e,t;return null!=this.props.contact?(t=i.getByAddress(this.props.contact.address),null!=t?(e=t.get("id"),y({ref:"contact",onClick:function(e){return e.stopPropagation()}},s({contact:this.props.contact}),p({className:"show-contact",target:"_blank",href:"/#apps/contacts/contact/"+e},d({className:"fa fa-user","aria-describedby":u.SHOW_CONTACT,"data-tooltip-direction":"top"})))):y({ref:"contact",className:"participant"},s({contact:this.props.contact}),y({className:"add-contact",onClick:function(e){return function(t){return t.stopPropagation(),e.addContact()}}(this)},d({className:"fa fa-user-plus","aria-describedby":u.ADD_CONTACT,"data-tooltip-direction":"top"})))):y()},componentDidMount:function(){},componentDidUpdate:function(){},addContact:function(){var e,n;return n={contact:c.displayAddress(this.props.contact)},e={title:t("message contact creation title"),subtitle:t("message contact creation",n),closeLabel:t("app cancel"),actionLabel:t("app confirm"),action:function(e){return function(){return r.createContact(e.props.contact,function(){return e.forceUpdate()}),l.hideModal()}}(this)},l.displayModal(e)}})}),require.register("components/conversation",function(e,n,o){var s,r,a,i,l,c,u,p,d,m,h,g,f,v,b,y,E,S,C,A,D,T,x,R,M=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};R=React.DOM,A=R.section,y=R.header,T=R.ul,S=R.li,D=R.span,E=R.i,C=R.p,b=R.h3,g=R.a,f=R.button,i=n("./message"),h=n("./toolbar_conversation"),v=React.addons.classSet,l=n("../constants/app_constants").MessageFlags,u=n("../mixins/router_mixin"),m=n("../mixins/store_watch_mixin"),d=n("../mixins/should_update_mixin"),r=n("../actions/layout_action_creator"),p=n("../stores/settings_store"),s=n("../stores/account_store"),c=n("../stores/message_store"),a=n("../stores/layout_store"),x=1,o.exports=React.createClass({displayName:"Conversation",mixins:[u,m([p,s,c,a]),d.UnderscoreEqualitySlow],propTypes:{messageID:React.PropTypes.string},getStateFromStores:function(){var e,t,n,o,r,i,u,d,m,h,g,f,v,b,y,_;return r=c.getByID(this.props.messageID),h=null!=(f=s.getSelectedMailbox())?f.get("id"):void 0,m=s.getSelectedOrDefault(),null!=r&&(t=null!=r?r.get("conversationID"):void 0,g=null!=m?m.get("trashMailbox"):void 0,e=c.getConversation(t,g),d=c.getPreviousMessage(),i=c.getNextMessage(),o=c.getConversationsLength().get(t),null==h&&(h=Object.keys(r.get("mailboxIDs"))[0])),n=s.hasConversationEnabled(h),n&&(n=p.get("displayConversation")),u={accounts:s.getAll(),mailboxes:s.getAllMailboxes(),selectedAccount:s.getSelectedOrDefault(),selectedMailboxID:h,settings:p.get(),useIntents:a.intentAvailable(),conversationID:t,conversation:e,conversationLength:o,prevMessage:d,nextMessage:i,displayConversations:n},(null!=(v=this.state)?v.compact:void 0)!==!1&&(u.compact=!0),(null!=(b=u.conversation)?b.length:void 0)!==(null!=(y=this.state)&&null!=(_=y.conversation)?_.length:void 0)&&(u.expanded=[],null!=e&&e.forEach(function(t,n){var o,s,r;return r=l.SEEN,s=M.call(t.get("flags"),r)<0,o=n===e.length-1,0===u.expanded.length&&(s||o)?u.expanded.push(n):void 0}),u.compact=!0),u},renderToolbar:function(){var e,t,n,o;return h({nextMessageID:null!=(e=this.state.nextMessage)?e.get("id"):void 0,nextConversationID:null!=(t=this.state.nextMessage)?t.get("conversationID"):void 0,prevMessageID:null!=(n=this.state.prevMessage)?n.get("id"):void 0,prevConversationID:null!=(o=this.state.prevMessage)?o.get("conversationID"):void 0,settings:this.state.settings})},renderMessage:function(e,t){var n;return n=function(t){return function(){var n;return n=t.state.expanded.slice(0),M.call(n,e)>=0?n=n.filter(function(t){return e!==t}):n.push(e),t.setState({expanded:n})}}(this),i({ref:"message",accounts:this.state.accounts,active:t,inConversation:this.state.conversation.length>1,key:e.toString(),mailboxes:this.state.mailboxes,message:this.state.conversation.get(e),selectedAccountID:this.state.selectedAccount.get("id"),selectedAccountLogin:this.state.selectedAccount.get("login"),selectedMailboxID:this.state.selectedMailboxID,settings:this.state.settings,displayConversations:this.state.displayConversation,useIntents:this.state.useIntents,toggleActive:n})},renderGroup:function(e,n){var o,s,r;return e.length>3&&this.state.compact?(s=[],o=e[0],r=e[e.length-1],s.push(this.renderMessage(o,!1)),s.push(f({className:"more",onClick:function(e){return function(){return e.setState({compact:!1})}}(this)},E({className:"fa fa-refresh"}),t("load more messages",e.length-2))),s.push(this.renderMessage(r,!1))):s=function(){var t,o,s;for(s=[],t=0,o=e.length;o>t;t++)n=e[t],s.push(this.renderMessage(n,!1));return s}.call(this),s},render:function(){var e,n,o,s,a;return this.state.conversation?(s=this.state.conversation.get(0),a=[],o=this.state.conversation.length-1,this.state.conversation.forEach(function(e){return function(t,n){var o;return M.call(e.state.expanded,n)>=0?a.push(n):(o=a[a.length-1],_.isArray(o)||a.push(o=[]),o.push(n))}}(this)),A({ref:"conversation",className:"conversation panel","aria-expanded":!0},y(null,b({className:"conversation-title","data-message-id":s.get("id"),"data-conversation-id":s.get("conversationID")},s.get("subject")),this.renderToolbar(),g({className:"clickable btn btn-default fa fa-close",href:this.buildClosePanelUrl("second"),onClick:r.minimizePreview})),function(){var t,o,s;for(s=[],n=t=0,o=a.length;o>t;n=++t)e=a[n],_.isArray(e)?s.push(this.renderGroup(e,n)):s.push(this.renderMessage(e,!0));return s}.call(this))):A({key:"conversation",className:"conversation panel","aria-expanded":!0},C(null,t("app loading")))}})}),require.register("components/date_range_picker",function(e,n,o){var s,r,a,i,l,c,u,p,d,m,h,g;g=React.DOM,l=g.div,h=g.ul,p=g.li,m=g.span,c=g.i,a=g.button,u=g.input,r=n("../constants/app_constants").Tooltips,d="DD/MM/YYYY",i="%d/%m/%Y",o.exports=s=React.createClass({displayName:"DateRangePicker",propTypes:{active:React.PropTypes.bool,onDateFilter:React.PropTypes.func.isRequired},getInitialState:function(){return{isActive:this.props.active,label:t("daterangepicker placeholder"),startDate:"",endDate:""}},shouldComponentUpdate:function(e,t){var n;return n=!_.isEqual(t,this.state)||!_.isEqual(e,this.props)},componentWillReceiveProps:function(e){return this.state.isActive&&!e.active?this.setState({isActive:!1,startDate:"",endDate:""}):e.active&&!this.props.active?this.setState({isActive:!0}):void 0},onStartChange:function(e){var t,n;return n=null!=e.target?e.target.value:""+e.dd+"/"+e.mm+"/"+e.yyyy,t=!!n&&!!this.state.endDate,this.setState({isActive:t,startDate:n},this.filterize)},onEndChange:function(e){var t,n;return n=e.target?e.target.value:""+e.dd+"/"+e.mm+"/"+e.yyyy,t=!!this.state.startDate&&!!n,this.setState({isActive:t,endDate:n},this.filterize)},filterize:function(){var e,t,n,o,s,r,a;if(!(!this.state.startDate^!this.state.endDate))return o=this.state.startDate?(r=this.state.startDate.split("/"),e=r[0],n=r[1],s=r[2],r,""+s+"-"+n+"-"+e+"T00:00:00.000Z"):void 0,t=this.state.endDate?(a=this.state.endDate.split("/"),e=a[0],n=a[1],s=a[2],a,""+s+"-"+n+"-"+e+"T23:59:59.999Z"):void 0,this.props.onDateFilter(o,t)},reset:function(){return this.setState({isActive:!1,startDate:"",endDate:""},this.filterize)},presetYesterday:function(){return this.setState({isActive:!0,startDate:moment().subtract(1,"day").format(d),endDate:moment().subtract(1,"day").format(d)},this.filterize)},presetLastWeek:function(){return this.setState({isActive:!0,startDate:moment().subtract(1,"week").format(d),endDate:moment().format(d)},this.filterize)},presetLastMonth:function(){return this.setState({isActive:!0,startDate:moment().subtract(1,"month").format(d),endDate:moment().format(d)},this.filterize)},render:function(){return l({className:"dropdown date-range-picker","aria-describedby":r.FILTER_DATE_RANGE,"data-tooltip-direction":"bottom"},a({className:"dropdown-toggle",role:"menuitem","data-toggle":"dropdown","aria-selected":this.state.isActive},c({className:"fa fa-calendar"}),m({className:"btn-label"},""+this.state.label),m({className:"caret"})),l({className:"dropdown-menu"},h({className:"presets list-unstyled"},p({role:"presentation"},a({role:"menuitem",onClick:this.presetYesterday},t("daterangepicker presets yesterday"))),p({role:"presentation"},a({role:"menuitem",onClick:this.presetLastWeek},t("daterangepicker presets last week"))),p({role:"presentation"},a({role:"menuitem",onClick:this.presetLastMonth},t("daterangepicker presets last month"))),p({role:"presentation"},a({role:"menuitem",onClick:this.reset},t("daterangepicker clear")))),l({className:"date-pickers"},u({ref:"date-range-picker-start",id:"date-range-picker-start",type:"text",name:"date-range-picker-start",value:this.state.startDate,onChange:this.onStartChange}),u({ref:"date-range-picker-end",id:"date-range-picker-end",type:"text",name:"date-range-picker-end",value:this.state.endDate,onChange:this.onEndChange}))))},initDatepicker:function(){var e;return e={staticPos:!0,fillGrid:!0,hideInput:!0},datePickerController.createDatePicker(_.extend({},e,{formElements:{"date-range-picker-start":i},callbackFunctions:{datereturned:[this.onStartChange]}})),datePickerController.createDatePicker(_.extend({},e,{formElements:{"date-range-picker-end":i},callbackFunctions:{datereturned:[this.onEndChange]}}))},componentDidMount:function(){return this.initDatepicker()},componentDidUpdate:function(){return datePickerController.setDateFromInput("date-range-picker-start"),datePickerController.setDateFromInput("date-range-picker-end")}})}),require.register("components/file_picker",function(e,n,o){var s,r,a,i,l,c,u,p,d,m,h,g,f;f=React.DOM,c=f.div,u=f.form,d=f.input,g=f.ul,m=f.li,h=f.span,p=f.i,l=f.a,i=n("../utils/message_utils"),a=React.PropTypes.shape({fileName:React.PropTypes.string,length:React.PropTypes.number,contentType:React.PropTypes.string,generatedFileName:React.PropTypes.string,contentDisposition:React.PropTypes.string,contentId:React.PropTypes.string,transferEncoding:React.PropTypes.string,rawFileObject:React.PropTypes.object,url:React.PropTypes.string}),r=React.createClass({displayName:"FilePicker",propTypes:{editable:React.PropTypes.bool,display:React.PropTypes.func,value:React.PropTypes.instanceOf(Immutable.Vector),valueLink:React.PropTypes.shape({value:React.PropTypes.instanceOf(Immutable.Vector),requestChange:React.PropTypes.func}),messageID:React.PropTypes.string},getDefaultProps:function(){return{editable:!1,valueLink:{value:Immutable.Vector.empty(),requestChange:function(){}}}},getInitialState:function(){return{files:this.props.value||this.props.valueLink.value,target:!1}},componentWillReceiveProps:function(e){return this.setState({files:e.value||e.valueLink.value})},addFiles:function(e){var t;return e=function(){var n,o,s;for(s=[],n=0,o=e.length;o>n;n++)t=e[n],s.push(this._fromDOM(t));return s}.call(this),e=this.state.files.concat(e).toVector(),this.props.valueLink.requestChange(e)},deleteFile:function(e){var t;return t=this.state.files.filter(function(t){return t.get("generatedFileName")!==e.generatedFileName}).toVector(),this.props.valueLink.requestChange(t)},displayFile:function(e){return e.url?window.open(e.url):e.rawFileObject?window.open(URL.createObjectURL(e.rawFileObject)):console.log("broken file : ",e)},render:function(){var e,n;return e="file-picker",this.props.className&&(e+=" "+this.props.className),n="dropzone",this.state.target&&(n+=" target"),c({className:e},g({className:"files list-unstyled"},this.state.files.toJS().map(function(e){return function(t){return s({key:t.generatedFileName,file:t,editable:e.props.editable,"delete":function(){return e.deleteFile(t)},display:function(){return e.displayFile(t)},messageID:e.props.messageID})}}(this))),this.props.editable?c({className:"dropzone-wrapper"},h({className:"file-wrapper"},d({type:"file",multiple:"multiple",ref:"file",onChange:this.handleFiles})),c({className:n},p({className:"fa fa-paperclip"}),h(null,t("picker drop here"))),c({className:"dropzone dropzone-mask",onDragOver:this.allowDrop,onDragEnter:this.onDragEnter,onDragLeave:this.onDragLeave,onDrop:this.handleFiles,onClick:this.onOpenFile})):void 0)},onOpenFile:function(e){return e.preventDefault(),jQuery(this.refs.file.getDOMNode()).trigger("click")},allowDrop:function(e){return e.preventDefault()},onDragEnter:function(e){return this.state.target?void 0:this.setState({target:!0})},onDragLeave:function(e){return this.state.target?this.setState({target:!1}):void 0},handleFiles:function(e){var t;return e.preventDefault(),t=e.target.files||e.dataTransfer.files,this.addFiles(t),this.setState({target:!1})},_fromDOM:function(e){var t,n,o;return n=this.state.files.filter(function(t){return t.get("fileName")===e.name}).count(),o=e.name,n>0&&(t=e.name.indexOf("."),o=o.substring(0,t)+"-"+(n+1)+o.substring(t)),Immutable.Map({fileName:e.name,length:e.size,contentType:e.type,rawFileObject:e,generatedFileName:o,contentDisposition:null,contentId:e.name,transferEncoding:null,content:null,url:null})}}),o.exports=r,s=React.createClass({displayName:"FileItem",propTypes:{file:React.PropTypes.shape({fileName:React.PropTypes.string,contentType:React.PropTypes.string,length:React.PropTypes.number}).isRequired,editable:React.PropTypes.bool,display:React.PropTypes.func,"delete":React.PropTypes.func,messageID:React.PropTypes.string},getDefaultProps:function(){return{editable:!1}},getInitialState:function(){return{}},render:function(){var e,t,n,o;return e=this.props.file,null!=e.url||e.rawFileObject||(window.cozyMails.log(new Error("Wrong file "+JSON.stringify(e))),e.url="message/"+this.props.messageID+"/attachments/"+e.generatedFileName),o=i.getAttachmentType(e.contentType),n={archive:"fa-file-archive-o",audio:"fa-file-audio-o",code:"fa-file-code-o",image:"fa-file-image-o",pdf:"fa-file-pdf-o",word:"fa-file-word-o",presentation:"fa-file-powerpoint-o",spreadsheet:"fa-file-excel-o",text:"fa-file-text-o",video:"fa-file-video-o",word:"fa-file-word-o"},t=n[o]||"fa-file-o",m({className:"file-item",key:this.props.key},p({className:"mime "+o+" fa "+t}),l({className:"file-name",target:"_blank",onClick:this.doDisplay,href:e.url,"data-file-url":e.url,"data-file-name":e.generatedFileName,"data-file-type":e.contentType},e.generatedFileName),h({className:"file-size"},"("+(e.length/1e3).toFixed(1)+"Ko)"),h({className:"file-actions"},l({className:"fa fa-download",href:""+e.url+"?download=1"}),this.props.editable?p({className:"fa fa-times delete",onClick:this.doDelete}):void 0))},doDisplay:function(e){return e.preventDefault(),e.stopPropagation(),this.props.display()},doDelete:function(e){return e.preventDefault(),e.stopPropagation(),this.props["delete"]()}})}),require.register("components/mailbox_picker",function(e,n,o){var s,r,a,i,l,c,u,p,d,m,h,g;g=React.DOM,p=g.div,h=g.ul,d=g.li,m=g.span,l=g.a,c=g.button,s=n("./basic_components").Dropdown,r=n("../libs/prop_types"),a=n("../mixins/router_mixin"),u=n("../libs/cached_transform"),i=n("../mixins/should_update_mixin"),o.exports=React.createClass({displayName:"MailboxPicker",mixins:[a,i.UnderscoreEqualitySlow],propTypes:{allowUndefined:React.PropTypes.bool,mailboxes:r.immutableMapStringTo(r.Mailbox),valueLink:r.valueLink(r.string).isRequired},getDefaultOptions:function(){return{allowUndefined:!0}},makeOptions:function(){return u(this,"mailboxesOptions",this.props.mailboxes,function(e){return function(){return e.props.mailboxes.map(function(e){var t;return t=new Array(e.get("depth")+1).join("--"),""+t+e.get("label")}).toJS()}}(this))},render:function(){var e;return(null!=(e=this.props.mailboxes)?e.length:void 0)?s({valueLink:this.props.valueLink,className:"btn-group btn-group-sm pull-left",btnClassName:"btn",options:this.makeOptions(),defaultLabel:t("mailbox pick one"),undefinedLabel:t("mailbox pick null"),allowUndefined:this.props.allowUndefined,undefinedValue:null}):p(null)}})}),require.register("components/mails_input",function(e,n,o){var s,r,a,i,l,c,u,p,d,m,h,g,f,v,b,y;y=React.DOM,p=y.div,h=y.label,v=y.textarea,f=y.span,b=y.ul,g=y.li,c=y.a,m=y.img,d=y.i,l=n("../utils/message_utils"),r=n("../stores/contact_store"),s=n("../actions/contact_action_creator"),a=n("../actions/layout_action_creator"),u=React.addons.classSet,o.exports=i=React.createClass({displayName:"MailsInput",getStateFromStores:function(){return{contacts:r.getResults()}},componentWillMount:function(){return this.setState({contacts:null,open:!1})},getInitialState:function(){var e;return e=this.getStateFromStores(),e.known=this.props.valueLink.value,e.unknown="",e.selected=0,e.open=!1,e},componentWillReceiveProps:function(e){return this.setState({known:e.valueLink.value})},componentDidMount:function(){return r.on("change",this._setStateFromStores)},componentWillUnmount:function(){return r.removeListener("change",this._setStateFromStores)},_setStateFromStores:function(){return this.setState(this.getStateFromStores())},shouldComponentUpdate:function(e,t){return!_.isEqual(t,this.state)||!_.isEqual(e,this.props)},render:function(){var e,t,n,o,s,r,a,i,m,g,y,E;return y=function(e){return function(t,n){var o,s,r,a;return a=function(){var n;return n=e.state.known.filter(function(e){return e.address!==t.address}),e.props.valueLink.requestChange(n)},r=function(n){var o;return n.stopPropagation(),null!=t?(o={name:t.name,address:t.address},n.dataTransfer.setData("address",JSON.stringify(o)),n.dataTransfer.effectAllowed="all",n.dataTransfer.setData(e.props.id,!0)):void 0},s=function(e){return"move"===e.dataTransfer.dropEffect?a():void 0},o=null!=t.name&&""!==t.name.trim()?t.name:t.address,f({className:"address-tag",draggable:!0,onDragStart:r,onDragEnd:s,key:""+e.props.id+"-"+t.address+"-"+n,title:t.address},o,c({className:"clickable",onClick:a},d({className:"fa fa-times"})))}}(this),s=this.state.known.map(y),i=function(e){return function(){return e.refs.contactInput.getDOMNode().focus()}}(this),a=function(e){return function(t){var n,o;return o=t.target.value.split(","),2===o.length?(n=_.clone(e.state.known),n.push(l.parseAddress(o[0])),e.props.valueLink.requestChange(n),e.setState({unknown:o[1].trim()})):e.setState({unknown:t.target.value})}}(this),m=function(e){return function(t){var n;return n=e.refs.contactInput.getDOMNode(),n.cols=n.value.length+2,n.style.height=n.scrollHeight+"px"}}(this),n=""+(this.props.className||"")+" form-group mail-input "+this.props.id,t="compose-label control-label",r=u({"contact-form":!0,open:this.state.open&&(null!=(E=this.state.contacts)?E.length:void 0)>0}),o=0,e=function(e){return function(t){var n;return t.preventDefault(),n=Array.prototype.slice.call(t.dataTransfer.types),-1===n.indexOf(e.props.id)?t.dataTransfer.dropEffect="move":t.dataTransfer.dropEffect="none"}}(this),g=s.length>0?"":this.props.placeholder,p({className:n,onClick:i,onDrop:this.onDrop,onDragEnter:e,onDragLeave:e,onDragOver:e},h({htmlFor:this.props.id,className:t},this.props.label),s,p({className:"contact-group dropdown "+r},v({id:this.props.id,name:this.props.id,className:"form-control compose-input",onKeyDown:this.onKeyDown,onBlur:this.onBlur,onDrop:this.onDrop,onDragEnter:e,onDragLeave:e,onDragOver:e,ref:"contactInput",rows:1,value:this.state.unknown,onChange:a,onInput:m,placeholder:g,autoComplete:"off",spellCheck:"off"}),null!=this.state.contacts?b({className:"dropdown-menu contact-list"},this.state.contacts.map(function(e){return function(t,n){var s;return s=o===e.state.selected,o++,e.renderContact(t,s)}}(this)).toJS()):void 0))},renderContact:function(e,t){var n,o,s;return s=function(t){return function(){return t.onContact(e)}}(this),n=e.get("avatar"),o=u({selected:t}),g({className:o,onClick:s},c(null,null!=n?m({className:"avatar",src:n}):d({className:"avatar fa fa-user"}),""+e.get("fn")+" <"+e.get("address")+">"))},onQuery:function(e){var t,n;return n=this.refs.contactInput.getDOMNode().value.split(",").pop().replace(/^\s*/,""),null!=e&&"string"==typeof e?(n+=e,t=!1):null!=e&&"object"==typeof e&&(t=!0),n.length>2||t&&!this.state.open?(s.searchContactLocal(n),this.setState({open:!0}),!0):(this.state.open&&this.setState({contacts:null,open:!1}),!1)},onKeyDown:function(e){var t,n,o,s,r,a;switch(n=null!=(r=this.state.contacts)?r.count():void 0,s=this.state.selected,e.key){case"Enter":return(13===e.keyCode||13===e.which)&&this.addContactFromInput(),(null!=(a=this.state.contacts)?a.count():void 0)>0?(t=this.state.contacts.slice(s).first(),this.onContact(t)):this.onQuery(),e.preventDefault(),!1;case"ArrowUp":return this.setState({selected:0===s?n-1:s-1});case"ArrowDown":return this.setState({selected:s===n-1?0:s+1});case"Backspace":if(o=this.refs.contactInput.getDOMNode(),o.value=o.value.trim(),o.value.length<2)return this.setState({open:!1});break;case"Escape":return this.setState({contacts:null,open:!1});default:if(null!=e.key||1===e.key.toString().length)return this.onQuery(String.fromCharCode(e.which)),!0}},onBlur:function(){return setTimeout(function(e){return function(){return e.addContactFromInput(!0)}}(this),100)},addContactFromInput:function(e){var n,o,s,r,i,c;if(null==e&&(e=!1),this.state.selected=0,this.isMounted()){if(r={},r.open=!1,i=this.refs.contactInput.getDOMNode().value,""===i.trim())return this.setState(r);if(n=l.parseAddress(i),n.isValid)return this.state.known.push(n),r.known=this.state.known,r.unknown="",this.props.valueLink.requestChange(r.known),this.setState(r);if(o=0===(null!=(c=this.state.contacts)?c.length:void 0),!e&&o)return s=t("compose wrong email format",{address:n.address}),a.alertError(s)}},onContact:function(e){var t,n;return t={name:e.get("fn"),address:e.get("address")},n=_.clone(this.state.known),n.push(t),this.props.valueLink.requestChange(n),this.setState({unknown:"",contacts:null,open:!1}),setTimeout(function(e){return function(){var t;return t=e.refs.contactInput.getDOMNode().focus()}}(this),200)},onDrop:function(e){var t,n,o,s,r;return e.preventDefault(),e.stopPropagation(),r=JSON.parse(e.dataTransfer.getData("address")),s=r.name,t=r.address,n=this.state.known.some(function(e){return e.name===s&&e.address===t}),null==t||n?e.dataTransfer.dropEffect="none":(t={name:s,address:t},o=_.clone(this.state.known),o.push(t),this.props.valueLink.requestChange(o),this.setState({unknown:"",contacts:null,open:!1}),e.dataTransfer.dropEffect="move")}})}),require.register("components/menu",function(e,n,o){var s,r,a,i,l,c,u,p,d,m,h,g,f,v,b,y,E,S,C,A,D,T,x,R,M,I,w,N,k=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};w=React.DOM,A=w.div,y=w.aside,x=w.nav,I=w.ul,T=w.li,R=w.span,b=w.a,D=w.i,E=w.button,S=React.addons.classSet,m=n("../mixins/router_mixin"),f=n("../mixins/store_watch_mixin"),s=n("../actions/account_action_creator"),a=n("../actions/layout_action_creator"),u=n("../actions/message_action_creator"),r=n("../stores/account_store"),i=n("../stores/layout_store"),d=n("../stores/refreshes_store"),h=n("../stores/search_store"),p=n("../utils/message_utils"),C=n("../utils/colorhash"),c=n("./menu_mailbox_item"),N=n("../constants/app_constants"),g=N.SpecialBoxIcons,v=N.Tooltips,M=["inboxMailbox","draftMailbox","sentMailbox","trashMailbox","junkMailbox","allMailbox"],o.exports=l=React.createClass({displayName:"Menu",mixins:[m,f([r,i,d,h])],shouldComponentUpdate:function(e,t){return!_.isEqual(t,this.state)||!_.isEqual(e,this.props)},getStateFromStores:function(){return{onlyFavorites:!this.state||this.state.onlyFavorites===!0,
isDrawerExpanded:i.isDrawerExpanded(),refreshes:d.getRefreshing(),accounts:r.getAll(),selectedAccount:r.getSelectedOrDefault(),mailboxes:r.getSelectedMailboxes(!0),favorites:r.getSelectedFavorites(!0),search:h.getCurrentSearch()}},selectedFirstSort:function(e,t){var n,o;return(null!=(n=this.state.selectedAccount)?n.get("id"):void 0)===e.get("id")?-1:(null!=(o=this.state.selectedAccount)?o.get("id"):void 0)===t.get("id")?1:0},_toggleFavorites:function(){return this.setState({onlyFavorites:!this.state.onlyFavorites})},displayErrors:function(e){var n,o;return n=e.get("errors"),o={title:t("modal please contribute"),subtitle:t("modal please report"),allowCopy:!0,closeLabel:t("app alert close"),content:React.DOM.pre({style:{"max-height":"300px","word-wrap":"normal"}},n.join("\n\n"))},a.displayModal(o)},render:function(){return y({role:"menubar","aria-expanded":this.state.isDrawerExpanded},this.state.accounts.length?this.renderComposeButton():void 0,x({className:"mainmenu"},this.state.search&&!this.state.selectedAccount?A({className:"active"},A({className:"account-title"},b({role:"menuitem",className:"account active"},D({className:"fa fa-search"}),A({className:"account-details"},R({},this.state.search))))):void 0,this.state.accounts.length?this.state.accounts.sort(this.selectedFirstSort).map(this.getAccountRender).toJS():void 0),x({className:"submenu"},this.renderNewMailboxButton(),E({role:"menuitem",className:"btn fa fa-question-circle help","aria-describedby":v.HELP_SHORTCUTS,"data-tooltip-direction":"top",onClick:function(){return Mousetrap.trigger("?")}}),E({role:"menuitem",className:S({btn:!0,fa:!0,"drawer-toggle":!0,"fa-caret-right":!this.state.isDrawerExpanded,"fa-caret-left":this.state.isDrawerExpanded}),onClick:a.drawerToggle})))},renderComposeButton:function(){var e;return e=this.buildUrl({direction:"first",action:"compose",parameters:null,fullWidth:!0}),b({href:e,className:"compose-action btn btn-cozy"},D({className:"fa fa-pencil"}),R({className:"item-label"}," "+t("menu compose")))},renderNewMailboxButton:function(){var e,n,o,s;return o=this.state.accounts.length?this.buildUrl({direction:"first",action:"account.mailbox.messages",parameters:[null!=(s=this.state.selectedAccount)?s.get("id"):void 0],fullWidth:!0}):this.buildUrl({direction:"first",action:"account.new",fullWidth:!0}),"account.new"===this.props.layout.firstPanel.action?(e="active",n=o):(e="",n=this.buildUrl({direction:"first",action:"account.new",fullWidth:!0})),b({href:n,role:"menuitem",className:"btn new-account-action "+e},D({className:"fa fa-plus"}),R({className:"item-label"},t("menu account new")))},getAccountRender:function(e,n){var o,s,a,i,l,u,p,d,m,h,g,f,y,_,E;return d=e===this.state.selectedAccount,a=e.get("id"),h=e.get("totalUnread"),u=r.getDefaultMailbox(a),f=this.state.refreshes,E=null!=u?this.buildUrl({direction:"first",action:"account.mailbox.messages",parameters:[a,null!=u?u.get("id"):void 0],fullWidth:!0}):this.buildUrl({direction:"first",action:"account.config",parameters:[a,"account"],fullWidth:!0}),o=S({active:d}),this.state.onlyFavorites?(m=this.state.favorites,p="fa-ellipsis-h",_=t("menu favorites off")):(m=this.state.mailboxes,p="fa-ellipsis-h",_=t("menu favorites on")),i=this.state.mailboxes.length===this.state.favorites.length,l=this.buildUrl({direction:"first",action:"account.config",parameters:[a,"account"],fullWidth:!0}),y=M.map(function(t){return e.get(t)}),s=C(e.get("label")),A({className:o,key:n},A({className:"account-title"},b({href:E,role:"menuitem",className:"account "+o,"data-toggle":"tooltip","data-delay":"10000","data-placement":"right"},D({className:"avatar",style:{"background-color":s}},e.get("label")[0]),A({className:"account-details"},R({"data-account-id":n,className:"item-label display-label"},e.get("label")),R({"data-account-id":n,className:"item-label display-login"},e.get("login"))),(g=f.get(a))&&g.get("errors").length?R({className:"refresh-error"},D({className:"fa warning",onClick:this.displayErrors},g)):void 0),d?b({href:l,className:"mailbox-config"},D({className:"fa fa-cog","aria-describedby":v.ACCOUNT_PARAMETERS,"data-tooltip-direction":"right"})):void 0,h>0&&!g?R({className:"badge"},h):void 0),d?I({role:"group",className:"list-unstyled mailbox-list"},null!=m?m.filter(function(e){var t;return t=e.get("id"),k.call(y,t)>=0}).map(function(t){return function(n,o){return c({account:e,mailbox:n,key:o,selectedMailboxID:t.state.selectedMailboxID,refreshes:f,displayErrors:t.displayErrors})}}(this)).toJS():void 0,null!=m?m.filter(function(e){var t;return t=e.get("id"),k.call(y,t)<0}).map(function(t){return function(n,o){return c({account:e,mailbox:n,key:o,selectedMailboxID:t.state.selectedMailboxID,refreshes:f,displayErrors:t.displayErrors})}}(this)).toJS():void 0,i?void 0:T({className:"toggle-favorites"},b({role:"menuitem",tabIndex:0,onClick:this._toggleFavorites,key:"toggle"},D({className:"fa "+p}),R({className:"item-label"},_)))):void 0)}})}),require.register("components/menu_mailbox_item",function(e,n,o){var s,r,a,i,l,c,u,p,d,m,h,g,f,v,b,y,E,S;E=React.DOM,h=E.div,p=E.aside,v=E.nav,y=E.ul,f=E.li,b=E.span,u=E.a,g=E.i,d=E.button,m=React.addons.classSet,i=n("../mixins/router_mixin"),a=n("../actions/message_action_creator"),s=n("../actions/layout_action_creator"),S=n("../constants/app_constants"),l=S.SpecialBoxIcons,c=S.Tooltips,o.exports=r=React.createClass({displayName:"MenuMailboxItem",mixins:[i],shouldComponentUpdate:function(e,t){return!_.isEqual(t,this.state)||!_.isEqual(e,this.props)},getInitialState:function(){return{target:!1}},onClickMailbox:function(){return this.props.mailbox.get("id")===this.props.selectedMailboxID&&this.props.account.get("supportRFC4551")?a.refreshMailbox(this.props.selectedMailboxID):void 0},render:function(){var e,n,o,s,r,a,i,p,h,v,y,_,E,S;a=this.props.mailbox.get("id"),p=this.buildUrl({direction:"first",action:"account.mailbox.messages",parameters:[this.props.account.get("id"),a]}),v=this.props.mailbox.get("nbTotal")||0,y=this.props.mailbox.get("nbUnread")||0,h=this.props.mailbox.get("nbRecent")||0,S=t("menu mailbox total",v),y>0&&(S+=" "+t("menu mailbox unread",y)),h>0&&(S+=" "+t("menu mailbox new",h)),i="fa-folder-o",E=!1;for(e in l)r=l[e],this.props.account.get(e)===a&&(i=r,E=e);return o=m({active:a===this.props.selectedMailboxID,target:this.state.target}),n=m({target:this.state.target,special:E,news:h>0}),E&&(n+=" "+E),_=this.props.refreshes.get(a),s=this.props.displayErrors.bind(null,_),f({className:o},u({href:p,onClick:this.onClickMailbox,className:""+n+" lv-"+this.props.mailbox.get("depth"),role:"menuitem","data-mailbox-id":a,onDragEnter:this.onDragEnter,onDragLeave:this.onDragLeave,onDragOver:this.onDragOver,onDrop:function(e){return function(t){return e.onDrop(t,a)}}(this),title:S,"data-toggle":"tooltip","data-placement":"right",key:this.props.key},g({className:"fa "+i}),b({className:"item-label"},""+this.props.mailbox.get("label")),(null!=_?_.get("errors").length:void 0)?b({className:"refresh-error",onClick:s},g({className:"fa fa-warning"},null)):void 0),this.props.account.get("trashMailbox")===a?d({"aria-describedby":c.EXPUNGE_MAILBOX,"data-tooltip-direction":"right",onClick:this.expungeMailbox},b({className:"fa fa-recycle"})):void 0,!_&&y&&y>0?b({className:"badge"},y):void 0)},onDragEnter:function(e){return this.state.target?void 0:this.setState({target:!0})},onDragLeave:function(e){return this.state.target?this.setState({target:!1}):void 0},onDragOver:function(e){return e.preventDefault()},onDrop:function(e,t){var n,o,s,r,i;return o=e.dataTransfer.getData("text"),i=JSON.parse(o),r=i.messageID,s=i.mailboxID,n=i.conversationID,this.setState({target:!1}),a.move({messageID:r,conversationID:n},s,t)},expungeMailbox:function(e){return e.preventDefault(),s.displayModal({title:t("app confirm delete"),subtitle:t("account confirm delbox"),closeLabel:t("app cancel"),actionLabel:t("app confirm"),action:function(e){return function(){return s.hideModal(),AccountActionCreator.mailboxExpunge({accountID:e.props.account.get("id"),mailboxID:e.props.mailbox.get("id")})}}(this)})}})}),require.register("components/message-content",function(e,n,o){var s,r,a,i,l,c,u,p,d,m,h,g,f,v,b;b=React.DOM,l=b.div,a=b.article,u=b.header,c=b.footer,v=b.ul,m=b.li,f=b.span,p=b.i,h=b.p,r=b.a,i=b.button,g=b.pre,d=b.iframe,o.exports=s=React.createClass({displayName:"MessageContent",shouldComponentUpdate:function(e,t){return!_.isEqual(t,this.state)||!_.isEqual(e,this.props)},render:function(){return this.props.messageDisplayHTML&&this.props.html?l(null,this.props.imagesWarning?l({className:"imagesWarning alert alert-warning content-action",ref:"imagesWarning"},p({className:"fa fa-shield"}),t("message images warning"),i({className:"btn btn-xs btn-warning",type:"button",ref:"imagesDisplay",onClick:this.props.displayImages},t("message images display"))):void 0,d({"data-message-id":this.props.messageID,name:"frame-"+this.props.messageID,className:"content",ref:"content",allowTransparency:!0,frameBorder:0})):l({className:"row"},l({className:"preview",ref:"content"},h({dangerouslySetInnerHTML:{__html:this.props.rich}})))},_initFrame:function(e){var t,n,o,s,r,a,i;return r=document.querySelector("#panels > .panel:nth-of-type(2)"),null==r||this.props.composing||(r.scrollTop=0),this.props.messageDisplayHTML&&this.refs.content?(o=this.refs.content.getDOMNode(),n=o.contentDocument||(null!=(i=o.contentWindow)?i.document:void 0),t=!1,a=0,s=function(e){return function(r){var i,l,c;return a=0,n=o.contentDocument||(null!=(l=o.contentWindow)?l.document:void 0),null==n?e.props.displayHTML(!1):(n.documentElement.innerHTML=e.props.html,window.cozyMails.customEvent("MESSAGE_LOADED",e.props.messageID),i=function(e){var r,i;return r=n.documentElement.scrollHeight,60>r?o.style.height="60px":o.style.height=""+(r+60)+"px",a++,t&&a>10?(n.body.removeEventListener("load",s),null!=(i=o.contentWindow)?i.removeEventListener("resize"):void 0):void 0},i(),setTimeout(i,1e3),n.body.onload=i,t?(o.contentWindow.onresize=i,window.onresize=i,null!=(c=o.contentWindow)?c.addEventListener("resize",i,!0):void 0):void 0)}}(this),"mount"===e&&"complete"!==n.readyState?o.addEventListener("load",s):s()):window.cozyMails.customEvent("MESSAGE_LOADED",this.props.messageID)},componentDidMount:function(){return this._initFrame("mount")},componentDidUpdate:function(){return this._initFrame("update")}})}),require.register("components/message-list-body",function(e,t,n){var o,s,r,a;a=React.DOM.ul,s=t("./message-list-item"),o=t("../utils/dom_utils"),n.exports=r=React.createClass({displayName:"MessageListBody",getInitialState:function(){var e;return e={messageID:null}},shouldComponentUpdate:function(e,t){var n,o;return o=Object.keys(e).filter(function(t){return function(n){return"function"!=typeof e[n]&&!_.isEqual(e[n],t.props[n])}}(this)),n=!_.isEqual(t,this.state)||o.length>0},_isActive:function(e,t){return this.props.messageID===e||this.props.displayConversations&&null!=t&&this.props.conversationID===t},render:function(){return a({className:"list-unstyled",ref:"messageList"},this.props.messages.map(function(e){return function(t,n){var o,r,a;return r=t.get("id"),o=t.get("conversationID"),s({message:t,accountID:e.props.accountID,mailboxID:e.props.mailboxID,accounts:e.props.accounts,mailboxes:e.props.mailboxes,conversationLengths:null!=(a=e.props.conversationLengths)?a.get(o):void 0,key:n,isActive:e._isActive(r,o),edited:e.props.edited,settings:e.props.settings,selected:null!=e.props.selected[r],login:e.props.login,displayConversations:e.props.displayConversations,isTrash:e.props.isTrash,ref:"messageItem",onSelect:function(t){return e.props.onSelect(r,t)}})}}(this)).toJS())},componentDidMount:function(){return this._onMount()},componentDidUpdate:function(){return this._onMount()},_onMount:function(){var e,t,n,s,r,a,i;return this.state.messageID!==this.props.messageID?(n=null!=(s=this.refs.messageList)&&null!=(r=s.getDOMNode())?r.parentNode:void 0,e=document.querySelector("[data-message-id='"+this.props.messageID+"']"),null==e||o.isVisible(e)||(t=null!=n?n.scrollTop:void 0,e.scrollIntoView(!1),t!==(null!=(a=this.refs.scrollable)&&null!=(i=a.getDOMNode())?i.scrollTop:void 0)&&null!=n&&(n.scrollTop+=e.getBoundingClientRect().height/2)),this.setState({messageID:this.props.messageID})):void 0}})}),require.register("components/message-list-item",function(e,t,n){var o,s,r,a,i,l,c,u,p,d,m,h,g,f,v,b,y,E,S,C,A,D,T,x=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1},R=[].slice;D=React.DOM,g=D.div,S=D.section,E=D.p,A=D.ul,y=D.li,p=D.a,C=D.span,f=D.i,d=D.button,b=D.input,v=D.img,T=t("../constants/app_constants"),a=T.MessageFlags,s=T.MailboxFlags,o=t("./basic_components").Icon,u=t("../mixins/router_mixin"),m=React.addons.classSet,l=t("../utils/message_utils"),h=t("../utils/colorhash"),c=t("./participant"),r=t("../actions/message_action_creator"),n.exports=i=React.createClass({displayName:"MessagesItem",mixins:[u],shouldComponentUpdate:function(e,t){var n,o;return o=Object.keys(e).filter(function(t){return function(n){return"function"!=typeof e[n]&&!_.isEqual(e[n],t.props[n])}}(this)),n=!_.isEqual(t,this.state)||o.length>0},render:function(){var e,t,n,s,r,i,c,u,d,b,_,E;return u=this.props.message,i=u.get("flags"),n=m({message:!0,unseen:(b=a.SEEN,x.call(i,b)<0),active:this.props.isActive,edited:this.props.edited}),s="compact"===this.props.settings.get("listStyle"),r=l.formatDate(u.get("createdAt"),s),e=l.getAvatar(u),d=this.props.edited?C:p,y({className:n,key:this.props.key,"data-message-id":u.get("id"),"data-conversation-id":u.get("conversationID"),draggable:!this.props.edited,onClick:this.onMessageClick,onDragStart:this.onDragStart},d({href:this.getUrl(),className:"wrapper","data-message-id":u.get("id"),onClick:this.onMessageClick,onDoubleClick:this.onMessageDblClick,ref:"target"},g({className:"markers-wrapper"},o({className:"select",onClick:this.onSelect,type:this.props.selected?"check-square-o":"square-o"}),(_=a.SEEN,x.call(i,_)<0?o({type:"circle"}):void 0),(E=a.FLAGGED,x.call(i,E)>=0?o({type:"star"}):void 0)),g({className:"avatar-wrapper select-target"},null!=e?v({className:"avatar",src:e}):(c=u.get("from")[0],t=""+(null!=c?c.name:void 0)+" <"+(null!=c?c.address:void 0)+">",f({className:"avatar placeholder",style:{"background-color":h(t)}},(null!=c?c.name:void 0)?null!=c?c.name[0]:void 0:null!=c?c.address[0]:void 0))),g({className:"metas-wrapper"},g({className:"metas"},g({className:"participants ellipsable"},this.getParticipants(u)),g({className:"subject ellipsable"},this.highlightSearch(u.get("subject"))),g.apply(null,[{className:"mailboxes"}].concat(R.call(this.getMailboxTags(u)))),g({className:"date"},r),g({className:"extras"},u.get("hasAttachments")?f({className:"attachments fa fa-paperclip"}):void 0,this.props.displayConversations&&this.props.conversationLengths>1?C({className:"conversation-length"},""+this.props.conversationLengths):void 0),g({className:"preview ellipsable"},this.highlightSearch(l.getPreview(u)))))))},highlightSearch:function(e,t){return null==t&&(t=null),E.apply(null,[t].concat(R.call(l.highlightSearch(e))))},getMailboxTags:function(){var e,t;return e=this.props.message.get("accountID"),t=this.props.accounts.get(e).get("label"),Object.keys(this.props.message.get("mailboxIDs")).filter(function(e){return function(t){var n,o;return n=e.props.mailboxes.get(t),n?e.props.mailboxID&&(o=s.ALL,x.call(n.get("attribs"),o)>=0)?!1:e.props.mailboxID===t?!1:!0:!1}}(this)).map(function(e){return function(n){var o,s;return o=e.props.mailboxes.get(n),s=o.get("label"),e.props.accountID||(s=""+t+":"+s),C({className:"mailbox-tag"},s)}}(this))},onSelect:function(e){return this.props.onSelect(!this.props.selected),e.preventDefault(),e.stopPropagation()},getUrl:function(){var e,t,n,o;return n={messageID:this.props.message.get("id")},o=a.DRAFT,x.call(this.props.message.get("flags"),o)>=0&&!this.props.isTrash?e="edit":(t=this.props.message.get("conversationID"),null!=t&&this.props.displayConversations?(e="conversation",n.conversationID=t):e="message"),this.buildUrl({direction:"second",action:e,parameters:n})},onMessageClick:function(e){var t,n;return n=this.refs.target.getDOMNode(),this.props.edited&&e.target.classList.contains("select-target")?(this.props.onSelect(!this.props.selected),e.preventDefault(),e.stopPropagation()):e.target.classList.contains("wrapper")?(e.preventDefault(),e.stopPropagation()):"checkbox"!==e.target.getAttribute("type")&&(e.preventDefault(),e.stopPropagation(),r.setCurrent(n.dataset.messageId,!0),this.props.settings.get("displayPreview"))?(t="#"+n.getAttribute("href").split("#")[1],this.redirect(t)):void 0},onMessageDblClick:function(e){var t;return this.props.edited?void 0:(t=e.currentTarget.href.split("#")[1],window.router.navigate(t,{trigger:!0}))},onDragStart:function(e){var t;return e.stopPropagation(),t={mailboxID:this.props.mailboxID},this.props.displayConversations?t.conversationID=e.currentTarget.dataset.conversationId:t.messageID=e.currentTarget.dataset.messageId,e.dataTransfer.setData("text",JSON.stringify(t)),e.dataTransfer.effectAllowed="move",e.dataTransfer.dropEffect="move"},getParticipants:function(e){var t,n,o;return t=e.get("from"),o=e.get("to").concat(e.get("cc")).filter(function(e){return function(n){var o;return n.address!==e.props.login&&n.address!==(null!=(o=t[0])?o.address:void 0)}}(this)),n=o.length>0?", ":" ",E(null,c({participants:t,onAdd:this.addAddress,ref:"from",tooltip:!1}),C(null,n),c({participants:o,onAdd:this.addAddress,ref:"to",tooltip:!1}))},addAddress:function(e){return ContactActionCreator.createContact(e)}})}),require.register("components/message-list",function(e,n,o){var s,r,a,i,l,c,u,p,d,m,h,g,f,v,b,y,E,S,C,A,D,T,x,R,M,I,w,N,k,L,O,P,U,F;P=React.DOM,x=P.div,k=P.section,N=P.p,O=P.ul,w=P.li,C=P.a,L=P.span,R=P.i,A=P.button,I=P.input,M=P.img,U=n("../constants/app_constants"),c=U.MessageFlags,S=U.Tooltips,g=n("../mixins/router_mixin"),E=n("../mixins/tooltip_refresher_mixin"),b=n("../mixins/store_watch_mixin"),i=n("../stores/layout_store"),D=React.addons.classSet,r=n("../utils/dom_utils"),d=n("../utils/message_utils"),f=n("../utils/socketio_utils"),T=n("../utils/colorhash"),s=n("../actions/contact_action_creator"),a=n("../actions/layout_action_creator"),l=n("../actions/message_action_creator"),m=n("./participant"),F=n("./basic_components"),v=F.Spinner,h=F.Progress,y=n("./toolbar_messageslist"),p=n("./message-list-body"),o.exports=u=React.createClass({displayName:"MessageList",mixins:[g,E,b([i])],shouldComponentUpdate:function(e,t){var n;return n=!_.isEqual(t,this.state)||!_.isEqual(e,this.props)},getInitialState:function(){return{edited:!1,selected:{},allSelected:!1}},getStateFromStores:function(){return{fullscreen:i.isPreviewFullscreen()}},componentWillReceiveProps:function(e){var t,n,o;o=_.clone(this.state.selected);for(t in o)n=o[t],e.messages.get(t)||delete o[t];return this.setState({selected:o}),0===Object.keys(o).length?this.setState({allSelected:!1,edited:!1}):void 0},render:function(){return k({key:"messages-list-"+this.props.mailboxID,ref:"list","data-mailbox-id":this.props.mailboxID,className:"messages-list panel","aria-expanded":!this.state.fullscreen},y({settings:this.props.settings,accountID:this.props.accountID,mailboxID:this.props.mailboxID,mailboxes:this.props.mailboxes,messages:this.props.messages,edited:this.state.edited,selected:this.state.selected,allSelected:this.state.allSelected,displayConversations:this.props.displayConversations,toggleEdited:this.toggleEdited,toggleAll:this.toggleAll,afterAction:this.afterMessageAction,queryParams:this.props.queryParams,noFilters:this.props.noFilters}),h({value:this.props.refresh,max:1}),0===this.props.messages.count()?this.props.fetching?N({className:"listFetching list-loading"},t("list fetching")):N({className:"listEmpty",ref:"listEmpty"},this.props.emptyListMessage):x({className:"main-content",ref:"scrollable"},p({messages:this.props.messages,settings:this.props.settings,accountID:this.props.accountID,mailboxID:this.props.mailboxID,messageID:this.props.messageID,conversationID:this.props.conversationID,conversationLengths:this.props.conversationLengths,accounts:this.props.accounts,mailboxes:this.props.mailboxes,login:this.props.login,edited:this.state.edited,selected:this.state.selected,allSelected:this.state.allSelected,displayConversations:this.props.displayConversations,isTrash:this.props.isTrash,ref:"listBody",onSelect:this.onMessageSelectionChange}),this.renderFooter()))},renderFooter:function(){return this.props.canLoadMore?N({className:"text-center list-footer"},this.props.fetching?v():C({className:"more-messages",onClick:this.props.loadMoreMessage,ref:"nextPage"},t("list next page"))):N({ref:"listEnd"},t("list end"))},toggleEdited:function(){return this.state.edited?this.setState({allSelected:!1,edited:!1,selected:{}}):this.setState({edited:!0})},toggleAll:function(){var e;return Object.keys(this.state.selected).length>0?this.setState({allSelected:!1,edited:!1,selected:{}}):(e={},this.props.messages.map(function(t,n){return e[n]=!0}).toJS(),this.setState({allSelected:!0,edited:!0,selected:e}))},onMessageSelectionChange:function(e,t){var n,o;return o=_.clone(this.state.selected),t?o[e]=t:delete o[e],n=Object.keys(o).length>0?{edited:!0,selected:o}:{allSelected:!1,edited:!1,selected:{}},this.setState(n)},afterMessageAction:function(){return setTimeout(function(e){return function(){var t;return t=e.refs.nextPage||e.refs.listEnd||e.refs.listEmpty,null!=t&&r.isVisible(t.getDOMNode())?e.props.loadMoreMessage():void 0}}(this),100)},_loadNext:function(){var e,t;return e=null!=(t=this.refs.listBody)?t.getDOMNode().lastElementChild:void 0,null!=this.refs.nextPage&&null!=e&&r.isVisible(e)?this.props.loadMoreMessage():void 0},_handleRealtimeGrowth:function(){var e;return"-"===this.props.pageAfter||null==this.refs.listEnd||r.isVisible(this.refs.listEnd.getDOMNode())?void 0:(e=this.props.messages.last().get("date"),f.changeRealtimeScope(this.props.mailboxID,e))},_initScroll:function(){var e;if(null!=this.refs.nextPage)return null!=this.refs.scrollable?(e=this.refs.scrollable.getDOMNode(),setTimeout(function(t){return function(){return e.removeEventListener("scroll",t._loadNext),e.addEventListener("scroll",t._loadNext),t._loadNext(),null==t._checkNextInterval?t._checkNextInterval=window.setInterval(t._loadNext,1e4):void 0}}(this),0)):void 0},componentDidMount:function(){return this._initScroll()},componentDidUpdate:function(){return this._initScroll(),this._handleRealtimeGrowth()},componentWillUnmount:function(){var e;return null!=this.refs.scrollable&&(e=this.refs.scrollable.getDOMNode(),e.removeEventListener("scroll",this._loadNext),null!=this._checkNextInterval)?window.clearInterval(this._checkNextInterval):void 0}})}),require.register("components/message",function(e,n,o){var s,r,a,i,l,c,u,p,d,m,h,g,f,v,b,y,_,E,S,C,A,D,T,x,R,M,I;I=React.DOM,_=I.div,v=I.article,S=I.header,E=I.footer,M=I.ul,D=I.li,R=I.span,C=I.i,T=I.p,f=I.a,b=I.button,x=I.pre,A=I.iframe,u=n("./message_header"),c=n("./message_footer"),h=n("./toolbar_message"),i=n("./message-content"),l=n("../constants/app_constants").MessageFlags,r=n("../actions/layout_action_creator"),a=n("../actions/message_action_creator"),s=n("../actions/contact_action_creator"),d=n("../mixins/router_mixin"),m=n("../mixins/should_update_mixin"),g=n("../mixins/tooltip_refresher_mixin"),y=React.addons.classSet,p=/:\/\//,o.exports=React.createClass({displayName:"Message",mixins:[d,g,m.UnderscoreEqualitySlow],propTypes:{accounts:React.PropTypes.object.isRequired,active:React.PropTypes.bool,inConversation:React.PropTypes.bool,displayConversations:React.PropTypes.bool,key:React.PropTypes.string.isRequired,mailboxes:React.PropTypes.object.isRequired,message:React.PropTypes.object.isRequired,selectedAccountID:React.PropTypes.string.isRequired,selectedAccountLogin:React.PropTypes.string.isRequired,selectedMailboxID:React.PropTypes.string.isRequired,settings:React.PropTypes.object.isRequired,useIntents:React.PropTypes.bool.isRequired,toggleActive:React.PropTypes.func.isRequired},getInitialState:function(){return{composeAction:"",headers:!1,messageDisplayHTML:this.props.settings.get("messageDisplayHTML"),messageDisplayImages:this.props.settings.get("messageDisplayImages"),currentMessageID:null,prepared:{}}},_prepareMessage:function(e){var n,o,s,r,a,i,c,u,p,d,m,h,g,f;r=[],g=e.get("headers");for(i in g)h=g[i],Array.isArray(h)?r.push(""+i+": "+h.join("\n    ")):r.push(""+i+": "+h);if(p=e.get("text"),a=e.get("html"),n=e.get("alternatives"),m=/((([A-Za-z]{3,9}:(?:\/\/)?)(?:[-;:&=\+\$,\w]+@)?[A-Za-z0-9.-]+|(?:www.|[-;:&=\+\$,\w]+@)[A-Za-z0-9.-]+)((?:\/[\+~%\/.\w-_]*)?\??(?:[-\+=&;%@.\w_]*)#?(?:[\w]*))?)/gim,null==p&&null==a&&(p=(null!=n?n.length:void 0)>0?t("calendar unknown format"):""),null!=p&&null==a&&this.state.messageDisplayHTML)try{a=markdown.toHTML(p.replace(/(^>.*$)([^>]+)/gm,"$1\n$2")),a="<div class='textOnly'>"+a+"</div>"}catch(v){o=v,a="<div class='textOnly'>"+p+"</div>"}return null==a||null!=p||this.state.messageDisplayHTML||(p=toMarkdown(a)),c=e.get("mailboxIDs"),d=null!=(f=this.props.accounts[this.props.selectedAccountID])?f.trashMailbox:void 0,null!=p&&(u=p.replace(m,'<a href="$1" target="_blank">$1</a>'),u=u.replace(/^>>>>>[^>]?.*$/gim,'<span class="quote5">$&</span>'),u=u.replace(/^>>>>[^>]?.*$/gim,'<span class="quote4">$&</span>'),u=u.replace(/^>>>[^>]?.*$/gim,'<span class="quote3">$&</span>'),u=u.replace(/^>>[^>]?.*$/gim,'<span class="quote2">$&</span>'),u=u.replace(/^>[^>]?.*$/gim,'<span class="quote1">$&</span>')),s=this.props.message.get("flags").slice(),{attachments:e.get("attachments"),fullHeaders:r,text:p,rich:u,html:a,isDraft:s.indexOf(l.DRAFT)>-1,isDeleted:null!=c[d]}},componentWillMount:function(){return this._markRead(this.props.message,this.props.active)},componentWillReceiveProps:function(e){var t;return t={},e.message.get("id")!==this.props.message.get("id")&&(this._markRead(e.message,e.active),t.messageDisplayHTML=e.settings.get("messageDisplayHTML"),t.messageDisplayImages=e.settings.get("messageDisplayImages")),this.setState(t)},_markRead:function(e,t){var n,o,s;return o=e.get("id"),this.state.currentMessageID!==o&&(s={currentMessageID:o,prepared:this._prepareMessage(e)},this.setState(s),n=e.get("flags").slice(),t&&-1===n.indexOf(l.SEEN))?setTimeout(function(){return a.mark({messageID:o},l.SEEN)},1):void 0},prepareHTML:function(e){var t,n,o,s,r,a,i,l,c,u,d,m;if(a=!0,i=new DOMParser,e='<html><head>\n    <link rel="stylesheet" href="./fonts/fonts.css" />\n    <link rel="stylesheet" href="./mail_stylesheet.css" />\n    <style>body { visibility: hidden; }</style>\n</head><body>'+e+"</body></html>",t=i.parseFromString(e,"text/html"),s=[],t||(t=document.implementation.createHTMLDocument(""),t.documentElement.innerHTML=e),t||(console.error("Unable to parse HTML content of message"),a=!1),t&&!this.state.messageDisplayImages)for(s=t.querySelectorAll("IMG[src]"),s=Array.prototype.filter.call(s,function(e){return p.test(e.getAttribute("src"))}),l=0,u=s.length;u>l;l++)o=s[l],o.dataset.src=o.getAttribute("src"),o.removeAttribute("src");for(m=t.querySelectorAll("a[href]"),c=0,d=m.length;d>c;c++)r=m[c],r.target="_blank",n=r.getAttribute("href"),""===n||p.test(n)||r.setAttribute("href","http://"+n);return null!=t?this._htmlContent=t.documentElement.innerHTML:this._htmlContent=e,{messageDisplayHTML:a,images:s}},isUnread:function(){return-1===this.props.message.get("flags").indexOf(l.SEEN)},onHeaderClicked:function(){var e;return e=this.props.message.get("id"),this.isUnread()&&!this.props.active&&a.mark({messageID:e},l.SEEN),this.props.toggleActive(e)},render:function(){var e,t,n,o,s,r,a,l;return o=this.props.message,r=this.state.prepared,this.state.messageDisplayHTML&&null!=r.html?(a=this.prepareHTML(r.html),s=a.messageDisplayHTML,t=a.images,n=t.length>0&&!this.state.messageDisplayImages):(s=!1,n=!1),e=y({message:!0,active:this.props.active,isDraft:r.isDraft,isDeleted:r.isDeleted,isUnread:this.isUnread()}),v({className:e,key:this.props.key,"data-id":this.props.message.get("id")},S({onClick:this.onHeaderClicked},u({message:this.props.message,isDraft:this.state.prepared.isDraft,isDeleted:this.state.prepared.isDeleted,active:this.props.active,ref:"header"}),this.props.active?this.renderToolbox():void 0),this.props.active?_({className:"full-headers"},x(null,null!=r&&null!=(l=r.fullHeaders)?l.join("\n"):void 0)):void 0,this.props.active?i({ref:"messageContent",messageID:o.get("id"),messageDisplayHTML:s,html:this._htmlContent,text:r.text,rich:r.rich,imagesWarning:n,displayImages:this.displayImages,displayHTML:this.displayHTML}):void 0,this.props.active?E(null,c({message:this.props.message,ref:"footer"}),this.renderToolbox(!1)):void 0)},renderToolbox:function(e){return null==e&&(e=!0),h({full:e,message:this.props.message,mailboxes:this.props.mailboxes,selectedMailboxID:this.props.selectedMailboxID,inConversation:this.props.inConversation,onDelete:this.onDelete,onHeaders:this.onHeaders,onMove:this.onMove,onMark:this.onMark,onConversationDelete:this.onConversationDelete,onConversationMark:this.onConversationMark,onConversationMove:this.onConversationMove,ref:"toolbarMessage"})},onDelete:function(e){var n,o,s;return e.preventDefault(),e.stopPropagation(),s=this.props.settings.get("messageConfirmDelete"),o=this.props.message.get("id"),n=t("mail confirm delete",{subject:this.props.message.get("subject")}),s?r.displayModal({title:t("app confirm delete"),subtitle:n,closeLabel:t("app cancel"),actionLabel:t("app confirm"),action:function(){return a["delete"]({messageID:o}),r.hideModal()}}):a["delete"]({messageID:o})},onConversationDelete:function(){var e;return e=this.props.message.get("conversationID"),a["delete"]({conversationID:e})},onMark:function(e){var t;return t=this.props.message.get("id"),a.mark({messageID:t},e)},onConversationMark:function(e){var t;return t=this.props.message.get("conversationID"),a.mark({conversationID:t},e)},onMove:function(e){var t,n,o;return n=this.props.message.get("id"),t=this.props.selectedMailboxID,o=this.props.message.get("subject"),a.move({messageID:n},t,e)},onConversationMove:function(e){var t,n,o;return t=this.props.message.get("conversationID"),n=this.props.selectedMailboxID,o=this.props.message.get("subject"),a.move({conversationID:t},n,e)},onCopy:function(e){return r.alertWarning(t("app unimplemented"))},onHeaders:function(e){var t;return e.preventDefault(),t=this.props.message.get("id"),document.querySelector(".conversation [data-id='"+t+"']").classList.toggle("with-headers")},addAddress:function(e){return s.createContact(e)},displayImages:function(e){return e.preventDefault(),this.setState({messageDisplayImages:!0})},displayHTML:function(e){return null==e&&(e=!0),this.setState({messageDisplayHTML:e})}})}),require.register("components/message_footer",function(e,t,n){var o,s,r,a,i,l,c,u,p;p=React.DOM,a=p.div,c=p.span,u=p.ul,l=p.li,r=p.a,i=p.i,s=t("../utils/message_utils"),o=t("./attachement_preview"),n.exports=React.createClass({displayName:"MessageFooter",propTypes:{message:React.PropTypes.object.isRequired},render:function(){return a({className:"attachments"},this.renderAttachments())},renderAttachments:function(){var e,t,n,r;return e=(null!=(r=this.props.message.get("attachments"))?r.toJS():void 0)||[],e.length?(n=_.groupBy(e,function(e){return"image"===s.getAttachmentType(e.contentType)?"preview":"binary"}),u({className:null},function(){var e,s,r,a;if(n.preview){for(r=n.preview,a=[],e=0,s=r.length;s>e;e++)t=r[e],a.push(o({ref:"attachmentPreview",file:t,key:t.checksum,preview:!0,previewLink:!0}));return a}}(),function(){var e,s,r,a;if(n.binary){for(r=n.binary,a=[],e=0,s=r.length;s>e;e++)t=r[e],a.push(o({ref:"attachmentPreview",file:t,key:t.checksum,preview:!1,previewLink:!0}));return a}}())):void 0}})}),require.register("components/message_header",function(e,n,o){var s,r,a,i,l,c,u,p,d,m,h,g=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1},f=[].slice;h=React.DOM,
c=h.div,m=h.span,u=h.i,p=h.img,l=h.a,s=n("../constants/app_constants").MessageFlags,i=n("./popup_message_details"),a=n("./popup_message_attachments"),r=n("../mixins/participant_mixin"),d=n("../utils/message_utils"),o.exports=React.createClass({displayName:"MessageHeader",propTypes:{message:React.PropTypes.object.isRequired,isDraft:React.PropTypes.bool,isDeleted:React.PropTypes.bool},mixins:[r],shouldComponentUpdate:function(e,t){var n;return n=!_.isEqual(e,this.props)},render:function(){var e,n;return e=d.getAvatar(this.props.message),c({key:"message-header-"+this.props.message.get("id")},e?c({className:"sender-avatar"},p({className:"media-object",src:e})):void 0,c({className:"infos"},this.renderAddress("from"),this.props.active?this.renderAddress("to"):void 0,this.props.active?this.renderAddress("cc"):void 0,c({className:"metas indicators"},this.props.message.get("attachments").length?a({message:this.props.message}):void 0,this.props.active?(n=s.FLAGGED,g.call(this.props.message.get("flags"),n)>=0?u({className:"fa fa-star"}):void 0,this.props.isDraft?l({href:"#edit/"+this.props.message.get("id")},u({className:"fa fa-edit"}),m(null,t("edit draft"))):void 0,this.props.isDeleted?u({className:"fa fa-trash"}):void 0):void 0),c({className:"metas date"},d.formatDate(this.props.message.get("createdAt"))),i({message:this.props.message})))},renderAddress:function(e){var n;return n=this.props.message.get(e),n.length?c({className:"addresses "+e,key:"address-"+e},c.apply(null,[{className:"addresses-wrapper"},"from"!==e?m(null,t("mail "+e)):void 0].concat(f.call(this.formatUsers(n))))):void 0}})}),require.register("components/modal",function(e,n,o){var s;o.exports=s=React.createClass({displayName:"Modal",render:function(){var e;return e="",this.props.content||(e="no-content"),React.DOM.div({className:"modal fade in",role:"dialog",style:{display:"block"}},React.DOM.div({className:"modal-dialog"},React.DOM.div({className:"modal-content"},null!=this.props.title?React.DOM.div({className:"modal-header"},null!=this.props.closeLabel?React.DOM.button({type:"button",className:"close",onClick:this.props.closeModal},React.DOM.i({className:"fa fa-times"})):void 0,React.DOM.h4({className:"modal-title"},this.props.title)):void 0,React.DOM.div({className:"modal-body "+e},null!=this.props.subtitle?React.DOM.span(null,this.props.subtitle):void 0,null!=this.props.content?React.DOM.div({ref:"content"},this.props.content):void 0),React.DOM.div({className:"modal-footer"},this.props.allowCopy?React.DOM.button({type:"button",className:"btn btn-cozy modal-copy",onClick:this.copyContent},t("modal copy content")):void 0,null!=this.props.actionLabel&&this.props.action?React.DOM.button({type:"button",className:"btn btn-cozy modal-action",onClick:this.props.action},this.props.actionLabel):void 0,null!=this.props.closeLabel?React.DOM.button({type:"button",className:"btn btn-cozy-non-default modal-close",onClick:this.props.closeModal},this.props.closeLabel):void 0))))},copyContent:function(){var e,t,n;return t=window.getSelection(),t.rangeCount>0&&t.removeAllRanges(),e=document.createRange(),e.selectNode(null!=(n=this.refs.content)?n.getDOMNode():void 0),t.addRange(e),document.execCommand("copy")}})}),require.register("components/panel",function(e,n,o){var s,r,a,i,l,c,u,p,d,m,h,g,f,v,b,y,E,S,C,A=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};s=n("./account_config"),a=n("./compose"),l=n("./conversation"),p=n("./message-list"),v=n("./settings"),g=n("./search_result"),y=n("./basic_components").Spinner,h=n("../mixins/router_mixin"),E=n("../mixins/store_watch_mixin"),S=n("../mixins/tooltip_refresher_mixin"),r=n("../stores/account_store"),d=n("../stores/message_store"),f=n("../stores/search_store"),b=n("../stores/settings_store"),c=n("../actions/message_action_creator"),C=n("../constants/app_constants"),i=C.ComposeActions,u=C.MessageFilter,o.exports=m=React.createClass({displayName:"Panel",mixins:[E([r,d,b,f]),S,h],shouldComponentUpdate:function(e,t){var n;return n=!_.isEqual(t,this.state)||!_.isEqual(e,this.props)},render:function(){var e,t;return"account.mailbox.messages"===this.props.action?this.renderList():"search"===this.props.action?(t=encodeURIComponent(f.getCurrentSearch()),g({key:"search-"+t})):"account.config"===this.props.action||"account.new"===this.props.action?(e=this.props.accountID||"new",s({key:"account-config-"+e,tab:this.props.tab})):"message"===this.props.action||"conversation"===this.props.action?l({messageID:this.props.messageID,key:"conversation-"+this.props.messageID,ref:"conversation"}):"compose"===this.props.action||"edit"===this.props.action||"compose.reply"===this.props.action||"compose.reply-all"===this.props.action||"compose.forward"===this.props.action?this.renderCompose():"settings"===this.props.action?v({key:"settings",ref:"settings",settings:this.state.settings}):(console.error("Unknown action "+this.props.action),window.cozyMails.logInfo("Unknown action "+this.props.action),React.DOM.div(null,"Unknown component "+this.props.action))},renderList:function(){var e,n,o,s,a,i,l,m,h,g,f,v,b,y,_;return n=this.props.accountID,g=this.props.mailboxID,e=r.getByID(n),null==e?(setTimeout(function(e){return function(){return e.redirect({direction:"first",action:"default"})}}(this),1),React.DOM.div(null,"redirecting")):(h=e.get("mailboxes").get(g),f=d.getMessagesToDisplay(g,this.state.settings.get("displayConversation")),v=(null!=h?h.get("nbTotal"):void 0)||0,l=function(){switch(this.state.queryParams.filter){case u.FLAGGED:return t("no flagged message");case u.UNSEEN:return t("no unseen message");case u.ALL:return t("list empty");default:return t("no filter message")}}.call(this),this.state.settings.get("displayConversation")&&(s=this.state.currentConversationID,null==s&&f.length>0&&(s=f.first().get("conversationID")),a=d.getConversationsLength()),o=[null!=(b=this.state.selectedAccount)?b.get("trashMailbox"):void 0,null!=(y=this.state.selectedAccount)?y.get("draftMailbox"):void 0,null!=(_=this.state.selectedAccount)?_.get("junkMailbox"):void 0],i=A.call(o,g)>=0?!1:this.state.settings.get("displayConversation"),m=o[0]===g,p({key:"messageList-"+g,messages:f,accountID:n,mailboxID:g,messageID:this.state.currentMessageID,conversationID:s,login:null!=e?e.get("login"):void 0,accounts:this.state.accounts,mailboxes:this.state.mailboxes,settings:this.state.settings,fetching:this.state.fetching,refresh:this.state.refresh,isTrash:m,conversationLengths:a,emptyListMessage:l,ref:"messageList",displayConversations:i,queryParams:this.state.queryParams,canLoadMore:this.state.queryParams.hasNextPage,loadMoreMessage:function(){return c.fetchMoreOfCurrentQuery()}}))},renderCompose:function(){var e,t,n;if(n={layout:"full",action:null,inReplyTo:null,settings:this.state.settings,accounts:this.state.accounts,selectedAccountID:this.state.selectedAccount.get("id"),selectedAccountLogin:this.state.selectedAccount.get("login"),selectedMailboxID:this.props.selectedMailboxID,useIntents:this.props.useIntents,ref:"compose"},e=null,"compose"===this.props.action)t=null,e=a(n);else if("edit"===this.props.action)n.message=d.getByID(this.props.messageID),e=a(n);else if("compose.reply"===this.props.action)n.action=i.REPLY,e=this.getReplyComponent(n);else if("compose.reply-all"===this.props.action)n.action=i.REPLY_ALL,e=this.getReplyComponent(n);else{if("compose.forward"!==this.props.action)throw new Error("unknown compose type : "+this.prop.action);n.action=i.FORWARD,e=this.getReplyComponent(n)}return e},getReplyComponent:function(e){var t,n;return n=d.getByID(this.props.messageID),this.state.isLoadingReply&&null==n?t=y():(n=d.getByID(this.props.messageID),n.set("id",this.props.messageID),e.inReplyTo=n,t=a(e)),t},getStateFromStores:function(){return{accounts:r.getAll(),mailboxes:r.getAllMailboxes(),selectedAccount:r.getSelectedOrDefault(),favoriteMailboxes:r.getSelectedFavorites(),selectedMailboxes:r.getSelectedMailboxes(!0),allMailboxes:r.getAllMailboxes(),accountWaiting:r.isWaiting(),fetching:d.isFetching(),queryParams:d.getQueryParams(),currentMessageID:d.getCurrentID(),conversation:d.getCurrentConversation(),currentConversationID:d.getCurrentConversationID(),settings:b.get(),isLoadingReply:null==d.getByID(this.props.messageID),refresh:r.getMailboxRefresh(this.props.mailboxID)}}})}),require.register("components/participant",function(e,t,n){var o,s,r,a,i,l,c,u=[].slice;c=React.DOM,l=c.span,a=c.a,i=c.i,o=t("../utils/message_utils"),s=React.createClass({displayName:"Participant",render:function(){var e;return e=o.displayAddress(this.props.address),null==this.props.address?l(null):l.apply(null,[{className:"address-item","data-toggle":"tooltip",ref:"participant",title:this.props.address.address,key:this.props.key}].concat(u.call(o.highlightSearch(e))))},_initTooltip:function(){return this.props.tooltip&&null!=this.refs.participant?o.tooltip(this.refs.participant.getDOMNode(),this.props.address,this.props.onAdd):void 0},componentDidMount:function(){return this._initTooltip()},componentDidUpdate:function(){return this._initTooltip()}}),r=React.createClass({displayName:"Participants",render:function(){var e,t;return l({className:"address-list"},function(){var n,o,r,a;if(this.props.participants){for(r=this.props.participants,a=[],t=n=0,o=r.length;o>n;t=++n)e=r[t],a.push(l({key:t,className:null},s({key:t,address:e,onAdd:this.props.onAdd,tooltip:this.props.tooltip}),t<this.props.participants.length-1?l(null,", "):void 0));return a}}.call(this))}}),n.exports=r}),require.register("components/popup_message_attachments",function(e,t,n){var o,s,r,a,i,l;l=React.DOM,r=l.div,i=l.ul,a=l.i,s=t("../constants/app_constants").Tooltips,o=t("./attachement_preview"),n.exports=React.createClass({displayName:"MessageAttachmentsPopup",mixins:[OnClickOutside],getInitialState:function(){return{showAttachements:!1}},toggleAttachments:function(){return this.setState({showAttachements:!this.state.showAttachements})},handleClickOutside:function(){return this.setState({showAttachements:!1})},render:function(){var e,t,n;return e=(null!=(n=this.props.message.get("attachments"))?n.toJS():void 0)||[],r({className:"attachments","aria-expanded":this.state.showAttachements,onClick:function(e){return e.stopPropagation()}},a({className:"btn fa fa-paperclip",onClick:this.toggleAttachments,"aria-describedby":s.OPEN_ATTACHMENTS,"data-tooltip-direction":"left"}),r({className:"popup","aria-hidden":!this.state.showAttachements},i({className:null},function(){var n,s,r;for(r=[],n=0,s=e.length;s>n;n++)t=e[n],r.push(o({ref:"attachmentPreview",file:t,key:t.checksum,preview:!1}));return r}())))}})}),require.register("components/popup_message_details",function(e,n,o){var s,r,a,i,l,c,u,p,d=[].slice;p=React.DOM,r=p.div,i=p.table,l=p.tbody,u=p.tr,c=p.td,a=p.i,s=n("../mixins/participant_mixin"),o.exports=React.createClass({displayName:"PopupMessageDetails",mixins:[s,OnClickOutside],getInitialState:function(){return{showDetails:!1}},toggleDetails:function(){return this.setState({showDetails:!this.state.showDetails})},handleClickOutside:function(){return this.setState({showDetails:!1})},render:function(){var e,n,o,s,p,m,h,g;return o=this.props.message.get("from")[0],h=this.props.message.get("to"),e=this.props.message.get("cc"),p=null!=(g=this.props.message.get("reply-to"))?g[0]:void 0,m=function(e,n,o,s){var r,a;return null==o&&(o=!1),null==s&&(s=!1),a=[],o&&(r={className:"label"},s&&(r.rowSpan=s),a.push(c(r,t(o)))),a.push(c({key:"cell-"+e},n)),u.apply(null,[{key:"row-"+e}].concat(d.call(a)))},r({className:"metas details","aria-expanded":this.state.showDetails,onClick:function(e){return e.stopPropagation()}},a({className:"fa fa-caret-down",onClick:this.toggleDetails}),this.state.showDetails?r({className:"popup","aria-hidden":!this.state.showDetails},i(null,l(null,m("from",this.formatUsers(o),"headers from"),h.length?m("to",this.formatUsers(h[0]),"headers to",h.length):void 0,function(){var e,t,o,r;if(h.length){for(o=h.slice(1),r=[],s=e=0,t=o.length;t>e;s=++e)n=o[s],r.push(m("destTo"+s,this.formatUsers(n)));return r}}.call(this),e.length?m("cc",this.formatUsers(e[0]),"headers cc",e.length):void 0,function(){var t,o,r,a;if(e.length){for(r=e.slice(1),a=[],s=t=0,o=r.length;o>t;s=++t)n=r[s],a.push(m("destCc"+s,this.formatUsers(n)));return a}}.call(this),null!=p?m("reply",this.formatUsers(p),"headers reply-to"):void 0,m("created",this.props.message.get("createdAt"),"headers date")))):void 0)}})}),require.register("components/search_bar",function(e,n,o){var s,r,a,i,l,c,u,p,d,m,h,g,f;f=React.DOM,h=f.div,m=f.button,g=f.i,u=n("./search_input"),r=n("./account_picker"),c=n("../mixins/router_mixin"),l=n("../actions/layout_action_creator"),d=n("../mixins/store_watch_mixin"),a=n("../stores/account_store"),p=n("../stores/search_store"),s=n("../actions/account_action_creator"),o.exports=i=React.createClass({displayName:"GlobalSearchBar",mixins:[c,d([a,p])],render:function(){return h({className:"search-bar"},g({className:"fa fa-search"}),r({accounts:this.state.accounts,valueLink:{value:this.state.accountID||"all",requestChange:this.onAccountChanged}}),u({value:this.state.search||"",placeholder:t("filters search placeholder"),onSubmit:this.onSearchTriggered}))},onSearchTriggered:function(e){var t;return""!==e?this.redirect({direction:"first",action:"search",parameters:[this.state.accountID,e]}):(this.setState({search:""}),t=this.state.accountID,"all"===this.state.accountID&&(t=null),this.redirect({direction:"first",action:"account.mailbox.messages",parameters:[t]}))},onAccountChanged:function(e){var t,n;return t=null!=(n=a.getSelected())?n.get("id"):void 0,""!==this.state.search?this.redirect({direction:"first",action:"search",parameters:[e,this.state.search]}):"all"!==e&&e!==t?this.redirect({direction:"first",action:"account.mailbox.messages",parameters:[e]}):this.setState({accountID:e})},getStateFromStores:function(){var e,n,o,s;return n=a.getAll().map(function(e){return e.get("label")}).toOrderedMap().set("all",t("search all accounts")),e=(null!=(s=a.getSelected())?s.get("id"):void 0)||"all",o=p.getCurrentSearch(),{accounts:n,search:o,accountID:e}}})}),require.register("components/search_input",function(e,t,n){var o,s,r,a;a=React.DOM,s=a.div,r=a.input,o=a.button,n.exports=React.createClass({displayName:"SearchInput",getInitialState:function(){return{value:this.props.value}},componentWillReceiveProps:function(e){return this.setState({value:e.value})},onChange:function(e){return this.setState({value:e.target.value})},onKeyUp:function(e){return this.setState({value:e.target.value}),"Enter"===e.key&&(null!=e&&e.preventDefault(),null!=e&&e.stopPropagation(),this.props.onSubmit(e.target.value)),"Escape"===e.key?this.onResetClick():void 0},onCheckClick:function(e){return null!=e&&"function"==typeof e.preventDefault&&e.preventDefault(),null!=e&&"function"==typeof e.stopPropagation&&e.stopPropagation(),this.props.onSubmit(this.state.value)},onResetClick:function(e){return this.setState({value:""}),null!=e&&"function"==typeof e.preventDefault&&e.preventDefault(),null!=e&&"function"==typeof e.stopPropagation&&e.stopPropagation(),this.props.onSubmit("")},render:function(){return s({role:"search"},r({type:"text",placeholder:this.props.placeholder,value:this.state.value,onChange:this.onChange,onKeyUp:this.onKeyUp,name:"searchterm"}),0!==this.state.value.length?s({className:"btn-group"},o({className:"btn fa fa-check",onClick:this.onCheckClick}),o({className:"btn fa fa-close",onClick:this.onResetClick})):void 0)}})}),require.register("components/search_result",function(e,n,o){var s,r,a,i,l,c,u,p;a=n("./message-list"),r=n("../actions/message_action_creator"),u=n("../mixins/store_watch_mixin"),i=n("../stores/message_store"),s=n("../stores/account_store"),l=n("../stores/search_store"),c=n("../stores/settings_store"),p=React.DOM.div,o.exports=React.createClass({displayName:"searchResults",mixins:[u([s,l])],getStateFromStores:function(){var e,n,o;return n=l.getCurrentSearch(),e=l.getCurrentSearchAccountID(),"all"===e&&(e=null),o={currentSearchKey:l.getCurrentSearchKey(),currentSearchResults:l.getCurrentSearchResults(),conversationLengths:i.getConversationsLength(),settings:c.get(),accountID:e,currentMessageID:i.getCurrentID(),currentConversationID:i.getCurrentConversationID(),accounts:s.getAll(),mailboxes:s.getAllMailboxes(),displayConversations:!0,canLoadMore:l.hasMoreSearch(),emptyListMessage:t("list search empty",{query:n})}},render:function(){return a({noFilters:!0,messages:this.state.currentSearchResults,accountID:this.state.accountID,messageID:this.state.currentMessageID,conversationID:this.state.currentConversationID,accounts:this.state.accounts,mailboxes:this.state.mailboxes,settings:this.state.settings,conversationLengths:this.state.conversationLengths,emptyListMessage:this.state.emptyListMessage,displayConversations:this.state.displayConversations,queryParams:null,canLoadMore:this.state.canLoadMore,loadMoreMessage:function(){return r.fetchSearchResults()}})}})}),require.register("components/settings",function(e,n,o){var s,r,a,i,l,c,u,p,d,m,h,g,f,v,b,y,_,E,S,C,A={}.hasOwnProperty;C=React.DOM,d=C.div,g=C.h3,h=C.form,b=C.label,v=C.input,u=C.button,m=C.fieldset,y=C.legend,S=C.ul,_=C.li,c=C.a,E=C.span,f=C.i,p=React.addons.classSet,a=n("../actions/layout_action_creator"),l=n("../actions/settings_action_creator"),i=n("../utils/plugin_utils"),s=n("../utils/api_utils"),r=n("../constants/app_constants").Dispositions,o.exports=React.createClass({displayName:"Settings",render:function(){var e,n,o,s,a,i;return n="col-sm-5 col-sm-offset-1 control-label",e="col-sm-6",o=this.state.settings.layoutStyle||"vertical",s=this.state.settings.listStyle||"default",d({id:"settings"},g({className:null},t("settings title")),this.props.error?d({className:"error"},this.props.error):void 0,h({className:"form-horizontal"},d({className:"form-group"},b({htmlFor:"settings-layoutStyle",className:n},t("settings label layoutStyle")),d({className:e},d({className:"dropdown"},u({id:"settings-layoutStyle",className:"btn btn-default dropdown-toggle",type:"button","data-toggle":"dropdown"},t("settings label layoutStyle "+o)),S({className:"dropdown-menu",role:"menu"},_({role:"presentation","data-target":"layoutStyle","data-style":r.VERTICAL,onClick:this.handleChange},c({role:"menuitem"},t("settings label layoutStyle vertical"))),_({role:"presentation","data-target":"layoutStyle","data-style":r.HORIZONTAL,onClick:this.handleChange},c({role:"menuitem"},t("settings label layoutStyle horizontal"))),_({role:"presentation","data-target":"layoutStyle","data-style":r.THREE,onClick:this.handleChange},c({role:"menuitem"},t("settings label layoutStyle three"))))))),d({className:"form-group"},b({htmlFor:"settings-listStyle",className:n},t("settings label listStyle")),d({className:e},d({className:"dropdown"},u({id:"settings-listStyle",className:"btn btn-default dropdown-toggle",type:"button","data-toggle":"dropdown"},t("settings label listStyle "+s)),S({className:"dropdown-menu",role:"menu"},_({role:"presentation","data-target":"listStyle","data-style":"default",onClick:this.handleChange},c({role:"menuitem"},t("settings label listStyle default"))),_({role:"presentation","data-target":"listStyle","data-style":"compact",onClick:this.handleChange},c({role:"menuitem"},t("settings label listStyle compact")))))))),this._renderOption("displayConversation"),this._renderOption("composeInHTML"),this._renderOption("composeOnTop"),this._renderOption("messageDisplayHTML"),this._renderOption("messageDisplayImages"),this._renderOption("messageConfirmDelete"),this._renderOption("displayPreview"),this._renderOption("desktopNotifications"),this._renderOption("autosaveDraft"),m(null,y(null,t("settings plugins")),function(){var e,o;e=this.state.settings.plugins,o=[];for(i in e)A.call(e,i)&&(a=e[i],o.push(h({className:"form-horizontal",key:i},d({className:"form-group"},b({className:n,htmlFor:"settings-plugin-"+i},t("plugin name "+a.name,{_:a.name})),d({className:"col-sm-1"},null!=a.url?E({className:"clickable",onClick:this.pluginDel,"data-plugin":i,title:t("settings plugin del")},f({className:"fa fa-trash-o"})):v({id:"settings-plugin-"+i,checked:a.active,onChange:this.handleChange,"data-target":"plugin","data-plugin":i,type:"checkbox"})),window.plugins[i].onHelp?d({className:"col-sm-1 plugin-help"},E({className:"clickable",onClick:this.pluginHelp,"data-plugin":i,title:t("settings plugin help")},f({className:"fa fa-question-circle"}))):void 0))));return o}.call(this),h({className:"form-horizontal",key:i},d({className:"form-group"},d({className:"col-xs-4"},v({id:"newpluginName",name:"newpluginName",ref:"newpluginName",type:"text",className:"form-control",placeholder:t("settings plugin new name")})),d({className:"col-xs-6"},v({id:"newpluginUrl",name:"newpluginUrl",ref:"newpluginUrl",type:"text",className:"form-control",placeholder:t("settings plugin new url")})),E({className:"col-xs-1 clickable",onClick:this.pluginAdd,title:t("settings plugin add")},f({className:"fa fa-plus"}))))))},_renderOption:function(e){var n,o;return o="col-sm-5 col-sm-offset-1 control-label",n="col-sm-6",h({className:"form-horizontal"},d({className:"form-group"},b({htmlFor:"settings-"+e,className:o},t("settings label "+e)),d({className:n},v({id:"settings-"+e,checked:this.state.settings[e],onChange:this.handleChange,"data-target":e,type:"checkbox"}))))},handleChange:function(e){var t,n,o,s,r,c;switch(e.preventDefault(),r=e.currentTarget,r.dataset.target){case"autosaveDraft":case"composeInHTML":case"composeOnTop":case"desktopNotifications":case"displayConversation":case"displayPreview":case"messageConfirmDelete":case"messageDisplayHTML":case"messageDisplayImages":if(s=this.state.settings,s[r.dataset.target]=r.checked,this.setState({settings:s}),l.edit(s),null!=window.Notification&&s.desktopNotifications)return Notification.requestPermission(function(e){return Notification.permission!==e?Notification.permission=e:void 0});break;case"layoutStyle":return s=this.state.settings,s.layoutStyle=r.dataset.style,a.setDisposition(s.layoutStyle),this.setState({settings:s}),l.edit(s);case"listStyle":return s=this.state.settings,s.listStyle=r.dataset.style,this.setState({settings:s}),l.edit(s);case"plugin":t=r.dataset.plugin,s=this.state.settings,r.checked?i.activate(t):i.deactivate(t),c=s.plugins;for(o in c)A.call(c,o)&&(n=c[o],n.active=window.plugins[o].active);return this.setState({settings:s}),l.edit(s)}},pluginAdd:function(){var e,t;return e=this.refs.newpluginName.getDOMNode().value.trim(),t=this.refs.newpluginUrl.getDOMNode().value.trim(),i.loadJS(t,function(n){return function(){var o;return i.activate(e),o=n.state.settings,o.plugins[e]={name:e,active:!0,url:t},n.setState({settings:o}),l.edit(o)}}(this))},pluginDel:function(e){var t,n,o;return e.preventDefault(),o=e.currentTarget,t=o.dataset.plugin,n=this.state.settings,i.deactivate(t),delete n.plugins[t],this.setState({settings:n}),l.edit(n)},pluginHelp:function(e){var t,n;return e.preventDefault(),n=e.currentTarget,t=n.dataset.plugin,window.plugins[t].onHelp()},registerMailto:function(){var e;return e=window.location,window.navigator.registerProtocolHandler("mailto",""+e.origin+e.pathname+"#compose?mailto=%s","Cozy")},getInitialState:function(e){var t;return t=this.props.settings.toObject(),{settings:this.props.settings.toObject()}}})}),require.register("components/toast",function(e,n,o){var s,r,a,i,l,c,u,p,d,m,h,g,f,v,b,y,_,E,S,C;S=React.DOM,m=S.a,v=S.h4,y=S.pre,f=S.div,h=S.button,_=S.span,E=S.strong,b=S.i,u=n("../utils/socketio_utils"),a=n("../app_dispatcher"),p=n("../mixins/store_watch_mixin"),c=n("../stores/layout_store"),l=n("../actions/layout_action_creator"),C=n("../constants/app_constants"),s=C.ActionTypes,r=C.AlertLevel,i=React.addons.CSSTransitionGroup,g=React.addons.classSet,o.exports=d=React.createClass({displayName:"Toast",render:function(){var e,n,o,s,a;return s=this.props.toast.toJS(),o=null!=(a=s.errors)?a.length:void 0,n=g({toast:!0,"alert-dismissible":s.finished,"toast-error":s.level===r.ERROR}),f({className:n,role:"alert",key:this.props.key},s.message?f({className:"message"},s.message):void 0,s.finished||o?h({type:"button",className:"close",onClick:this.acknowledge},_({"aria-hidden":"true"},"×"),_({className:"sr-only"},t("app alert close"))):void 0,null!=s.actions?(e="btn btn-cancel btn-cozy-non-default btn-xs",f({className:"toast-actions"},s.actions.map(function(t,n){return h({className:e,type:"button",key:n,onClick:t.onClick},t.label)}))):void 0,o?(e="btn btn-cancel btn-cozy-non-default btn-xs",f({className:"toast-actions"},h({className:e,type:"button",key:"errors",onClick:this.onModalShowClicked},t("there were errors",{smart_count:s.errors.length})))):void 0)},onModalShowClicked:function(){var e;return e=JSON.stringify(this.props.toast.get("errors")[0]),l.displayModal({title:t("modal please contribute"),subtitle:t("modal please report"),closeLabel:t("app alert close"),content:y({style:{"max-height":"300px","word-wrap":"normal"}},e)})},acknowledge:function(){return a.handleViewAction({type:s.RECEIVE_TASK_DELETE,value:this.props.toast.get("id")})}})}),require.register("components/toast_container",function(e,t,n){var o,s,r,a,i,l,c,u;u=React.DOM.div,i=t("./toast"),a=t("../mixins/store_watch_mixin"),r=t("../stores/layout_store"),s=t("../actions/layout_action_creator"),o=React.addons.CSSTransitionGroup,c=React.addons.classSet,n.exports=l=React.createClass({displayName:"ToastContainer",mixins:[a([r])],getStateFromStores:function(){return{toasts:r.getToasts(),hidden:!r.isShown()}},shouldComponentUpdate:function(e,t){var n,o;return o=_.isEqual(t,this.state),n=_.isEqual(e,this.props),!(o&&n)},render:function(){var e,t;return t=this.state.toasts.map(function(e,t){return i({toast:e,key:t})}).toVector().toJS(),e=c({"toasts-container":!0,"action-hidden":this.state.hidden,"has-toasts":0!==t.length}),u({className:e},o({transitionName:"toast"},t))},toggleHidden:function(){return this.state.hidden?s.toastsShow():s.toastsHide()},_clearToasts:function(){return setTimeout(function(){var e;return e=document.querySelectorAll(".toast-enter"),Array.prototype.forEach.call(e,function(e){return e.classList.add("hidden")})},1e4)},closeAll:function(){return s.clearToasts()},componentDidMount:function(){return this._clearToasts()},componentDidUpdate:function(){return this._clearToasts()}})}),require.register("components/toolbar_conversation",function(e,t,n){var o,s,r,a,i,l,c,u,p,d,m;m=React.DOM,d=m.nav,p=m.div,c=m.button,l=m.a,i=t("../constants/app_constants").Tooltips,u=React.addons.classSet,s=t("../stores/layout_store"),o=t("../actions/layout_action_creator"),r=t("../mixins/router_mixin"),a=t("../mixins/store_watch_mixin"),n.exports=React.createClass({displayName:"ToolbarConversation",mixins:[r,a([s])],propTypes:{nextMessageID:React.PropTypes.string,nextConversationID:React.PropTypes.string,prevMessageID:React.PropTypes.string,prevConversationID:React.PropTypes.string,settings:React.PropTypes.object.isRequired},getStateFromStores:function(){return{fullscreen:s.isPreviewFullscreen()}},getUrlParams:function(e,t){var n,o,s;return this.props.settings.get(null!=t)?(n="conversation",o={messageID:e,conversationID:t}):(n="message",o={messageID:e}),s={direction:"second",action:n,parameters:o}},render:function(){return d({className:"toolbar toolbar-conversation btn-toolbar"},p({className:"btn-group"},this.renderNav("prev"),this.renderNav("next")),this.renderFullscreen())},renderNav:function(e){var t,n,o,s,r;if(null!=this.props[""+e+"MessageID"])return o=this.props[""+e+"MessageID"],n=this.props[""+e+"ConversationID"],"prev"===e?(s=i.PREVIOUS_CONVERSATION,t="left"):(s=i.NEXT_CONVERSATION,t="right"),r=this.getUrlParams(o,n),l({className:"btn btn-default fa fa-chevron-"+t,onClick:function(e){return function(){return e.redirect(r)}}(this),href:this.buildUrl(r),"aria-describedby":s,"data-tooltip-direction":"left"})},renderFullscreen:function(){return c({onClick:o.toggleFullscreen,className:u({clickable:!0,btn:!0,"btn-default":!0,fa:!0,fullscreen:!0,"fa-compress":this.state.fullscreen,"fa-expand":!this.state.fullscreen})})}})}),require.register("components/toolbar_message",function(e,t,n){var o,s,r,a,i,l,c,u,p,d,m,h,g,f,v,b,y=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};v=React.DOM,f=v.nav,g=v.div,d=v.button,c=v.a,b=t("../constants/app_constants"),r=b.MessageFlags,o=b.FlagsConstants,l=b.Tooltips,a=t("./toolbox_actions"),i=t("./toolbox_move"),s=t("../actions/layout_action_creator"),u=s.alertError,p=s.notify,h="btn-group btn-group-sm pull-right",m="btn btn-default fa",n.exports=React.createClass({displayName:"ToolbarMessage",propTypes:{message:React.PropTypes.object.isRequired,mailboxes:React.PropTypes.object.isRequired,selectedMailboxID:React.PropTypes.string.isRequired,onDelete:React.PropTypes.func.isRequired,onMove:React.PropTypes.func.isRequired,onHeaders:React.PropTypes.func.isRequired},render:function(){return f({className:"toolbar toolbar-message btn-toolbar",onClick:function(e){return e.stopPropagation()}},this.props.full?g({className:h},this.renderToolboxMove(),this.renderToolboxActions()):void 0,this.props.full?this.renderQuickActions():void 0,this.renderReply())},renderReply:function(){return g({className:h},c({className:""+m+" fa-mail-reply mail-reply",href:"#reply/"+this.props.message.get("id"),"aria-describedby":l.REPLY,"data-tooltip-direction":"top"}),c({className:""+m+" fa-mail-reply-all mail-reply-all",href:"#reply-all/"+this.props.message.get("id"),"aria-describedby":l.REPLY_ALL,"data-tooltip-direction":"top"}),c({className:""+m+" fa-mail-forward mail-forward",href:"#forward/"+this.props.message.get("id"),"aria-describedby":l.FORWARD,"data-tooltip-direction":"top"}))},renderQuickActions:function(){return g({className:h},d({className:""+m+" fa-trash",onClick:this.props.onDelete,"aria-describedby":l.REMOVE_MESSAGE,"data-tooltip-direction":"top"}))},renderToolboxActions:function(){var e,t,n,s,r;return e=this.props.message.get("flags")||[],s=o.FLAGGED,t=y.call(e,s)>=0,r=o.SEEN,n=y.call(e,r)>=0,a({ref:"toolboxActions",mailboxes:this.props.mailboxes,inConversation:this.props.inConversation,isSeen:n,isFlagged:t,messageID:this.props.message.get("id"),message:this.props.message,onMark:this.props.onMark,onHeaders:this.props.onHeaders,onConversationMark:this.props.onConversationMark,onConversationMove:this.props.onConversationMove,onConversationDelete:this.props.onConversationMove,direction:"right",displayConversations:!1})},renderToolboxMove:function(){return i({ref:"toolboxMove",mailboxes:this.props.mailboxes,onMove:this.props.onMove,direction:"right"})}})}),require.register("components/toolbar_messageslist",function(e,n,o){var s,r,a,i,l,c,u,p,d,m,h;h=React.DOM,u=h.aside,m=h.i,p=h.button,d=React.addons.classSet,r=n("./toolbar_messageslist_filters"),s=n("./toolbar_messageslist_actions"),l=n("./search_bar"),a=n("../actions/layout_action_creator"),i=n("../mixins/router_mixin"),o.exports=c=React.createClass({displayName:"ToolbarMessagesList",mixins:[i],propTypes:{settings:React.PropTypes.object.isRequired,accountID:React.PropTypes.string.isRequired,mailboxID:React.PropTypes.string.isRequired,mailboxes:React.PropTypes.object.isRequired,messages:React.PropTypes.object.isRequired,edited:React.PropTypes.bool.isRequired,selected:React.PropTypes.object.isRequired,allSelected:React.PropTypes.bool.isRequired,displayConversations:React.PropTypes.bool.isRequired,toggleEdited:React.PropTypes.func.isRequired,toggleAll:React.PropTypes.func.isRequired,afterAction:React.PropTypes.func},onFilterChange:function(e){var t,n,o,s,r,a,i,l;switch(a="-",r="date",n="-",t="-",o="-",i=e.type,s=a+r,i){case"from":case"dest":e.value&&(n=e.value,t=""+e.value+"￿");break;case"date":e.range&&(l=e.range,n=l[0],t=l[1]);break;case"flag":e.value&&(o=e.value)}return window.cozyMails.messageClose(),this.redirect({direction:"first",action:"account.mailbox.messages",parameters:[this.props.accountID,this.props.mailboxID,s,i,o,n,t]})},render:function(){
return u({role:"toolbar"},p({className:"drawer-toggle",onClick:a.drawerToggle,title:t("menu toggle")},m({className:"fa fa-navicon"})),p({role:"menuitem","aria-selected":this.props.edited,onClick:this.props.toggleAll},m({className:d({fa:!0,"fa-square-o":!this.props.edited,"fa-check-square-o":this.props.allSelected,"fa-minus-square-o":this.props.edited&&!this.props.allSelected})})),this.props.edited?s({settings:this.props.settings,mailboxID:this.props.mailboxID,mailboxes:this.props.mailboxes,messages:this.props.messages,selected:this.props.selected,displayConversations:this.props.displayConversations,afterAction:this.props.afterAction}):this.props.noFilters?void 0:r({accountID:this.props.accountID,mailboxID:this.props.mailboxID,queryParams:this.props.queryParams,onFilterChange:this.onFilterChange}),l())}})}),require.register("components/toolbar_messageslist_actions",function(e,n,o){var s,r,a,i,l,c,u,p,d,m;m=React.DOM,p=m.div,d=m.i,u=m.button,c=n("../constants/app_constants").Tooltips,i=n("./toolbox_actions"),l=n("./toolbox_move"),r=n("../actions/layout_action_creator"),a=n("../actions/message_action_creator"),o.exports=s=React.createClass({displayName:"ActionsToolbarMessagesList",propTypes:{settings:React.PropTypes.object.isRequired,mailboxID:React.PropTypes.string.isRequired,mailboxes:React.PropTypes.object.isRequired,messages:React.PropTypes.object.isRequired,selected:React.PropTypes.object.isRequired,displayConversations:React.PropTypes.bool.isRequired,afterAction:React.PropTypes.func},_hasSelection:function(){return Object.keys(this.props.selected).length>0},_getSelectedAndMode:function(e){var n,o,s;return s=Object.keys(this.props.selected),o=s.length,e=Boolean(e),null==e&&(e=this.props.displayConversations),0===s.length?(r.alertError(t("list mass no message")),!1):e?(n=s.map(function(e){return function(t){return e.props.messages.get(t).get("conversationID")}}(this)),{count:o,conversationIDs:n,applyToConversation:e}):{count:o,messageIDs:s,applyToConversation:e}},render:function(){return p({role:"group"},u({role:"menuitem",onClick:this.onDelete,"aria-disabled":this._hasSelection(),"aria-describedby":c.DELETE_SELECTION,"data-tooltip-direction":"bottom"},d({className:"fa fa-trash-o"})),this.props.displayConversations?void 0:l({ref:"listToolboxMove",mailboxes:this.props.mailboxes,onMove:this.onMove,direction:"left"}),i({ref:"listToolboxActions",direction:"left",mailboxes:this.props.mailboxes,inConversation:!0,displayConversations:this.props.displayConversations,onMark:this.onMark,onConversationDelete:this.onConversationDelete,onConversationMark:this.onConversationMark,onConversationMove:this.onConversationMove}))},onDelete:function(e){var n,o,s,i,l;if(l=this._getSelectedAndMode(e))return s=l.applyToConversation?t("list delete conv confirm",{smart_count:l.count}):t("list delete confirm",{smart_count:l.count}),n=function(e){return function(){return a["delete"](l,function(){var t;return l.count>0&&e.props.messages.count()>0?(t=e.props.messages.first().get("id"),a.setCurrent(t,!0)):void 0}),null!=e.props.afterAction?e.props.afterAction():void 0}}(this),i=!this.props.settings.get("messageConfirmDelete"),i?n():(o={title:t("app confirm delete"),subtitle:s,closeLabel:t("app cancel"),actionLabel:t("app confirm"),action:function(){return n(),r.hideModal()}},r.displayModal(o))},onMove:function(e,t){var n,o;if(o=this._getSelectedAndMode(t))return n=this.props.mailboxID,a.move(o,n,e,function(e){return function(){var t;return o.count>0&&e.props.messages.count()>0?(t=e.props.messages.first().get("id"),a.setCurrent(t,!0)):void 0}}(this)),null!=this.props.afterAction?this.props.afterAction():void 0},onMark:function(e,t){var n;if(n=this._getSelectedAndMode(t))return a.mark(n,e)},onConversationDelete:function(){return this.onDelete(!0)},onConversationMove:function(e){return this.onMove(e,!0)},onConversationMark:function(e){return this.onMark(e,!0)}})}),require.register("components/toolbar_messageslist_filters",function(e,n,o){var s,r,a,i,l,c,u,p,d,m,h,g,f,v;f=React.DOM,p=f.div,g=f.ul,m=f.li,h=f.span,d=f.i,u=f.button,v=n("../constants/app_constants"),i=v.MessageFilter,c=v.Tooltips,l=n("../mixins/router_mixin"),a=n("../actions/layout_action_creator"),s=n("./date_range_picker"),o.exports=r=React.createClass({displayName:"FiltersToolbarMessagesList",propTypes:{accountID:React.PropTypes.string.isRequired,mailboxID:React.PropTypes.string.isRequired},getInitialState:function(){return{expanded:!1}},shouldComponentUpdate:function(e,t){var n;return n=!_.isEqual(t,this.state)||!_.isEqual(e,this.props)},onDateFilter:function(e,t){var n;return n=e&&t?[e,t]:null,this.props.onFilterChange({type:"date",range:n})},toggleFilters:function(e){var t;return t="flag"===this.props.queryParams.type&&this.props.queryParams.filter===e,this.props.onFilterChange({type:"flag",value:t?"-":e})},render:function(){var e;return e="flag"===this.props.queryParams.type&&this.props.queryParams.filter,p({role:"group",className:"filters","aria-expanded":this.state.expanded},u({role:"presentation",onClick:function(e){return function(){return e.setState({expanded:!e.state.expanded})}}(this)},d({className:"fa fa-filter"})),u({role:"menuitem","aria-selected":e===i.UNSEEN,onClick:function(e){return function(){return e.toggleFilters(i.UNSEEN)}}(this),"aria-describedby":c.FILTER_ONLY_UNREAD,"data-tooltip-direction":"bottom"},d({className:"fa fa-eye"}),h({className:"btn-label"},t("filters unseen"))),u({role:"menuitem","aria-selected":e===i.FLAGGED,onClick:function(e){return function(){return e.toggleFilters(i.FLAGGED)}}(this),"aria-describedby":c.FILTER_ONLY_IMPORTANT,"data-tooltip-direction":"bottom"},d({className:"fa fa-star"}),h({className:"btn-label"},t("filters flagged"))),u({role:"menuitem","aria-selected":e===i.ATTACH,onClick:function(e){return function(){return e.toggleFilters(i.ATTACH)}}(this),"aria-describedby":c.FILTER_ONLY_WITH_ATTACHMENT,"data-tooltip-direction":"bottom"},d({className:"fa fa-paperclip"}),h({className:"btn-label"},t("filters attach"))),s({active:"date"===this.props.queryParams.type,onDateFilter:this.onDateFilter}))}})}),require.register("components/toolbar_messageslist_search",function(e,n,o){var s,r,a,i,l,c,u,p,d,m,h,g,f,v,b;v=React.DOM,d=v.div,g=v.i,p=v.button,f=v.input,h=v.form,s=n("./basic_components").Dropdown,b=n("../constants/app_constants"),a=b.MessageFilter,u=b.Tooltips,l=n("./search_input"),i=n("../mixins/router_mixin"),r=n("../actions/layout_action_creator"),m={from:t("list filter from"),dest:t("list filter dest")},o.exports=c=React.createClass({displayName:"SearchToolbarMessagesList",propTypes:{accountID:React.PropTypes.string.isRequired,mailboxID:React.PropTypes.string.isRequired},getInitialState:function(){return{type:"from",value:""}},prevent:function(e){return e.preventDefault()},onTypeChange:function(e){return this.setState({type:e,value:""})},onValueChange:function(e){return this.props.onFilterChange({type:this.state.type,value:e})},render:function(){return h({role:"group",className:"search",onSubmit:this.prevent},s({options:m,valueLink:{value:this.state.type,requestChange:this.onTypeChange}}),l({value:this.state.value,placeholder:t("filters search placeholder"),onSubmit:this.onValueChange}))}})}),require.register("components/toolbox_actions",function(e,n,o){var s,r,a,i,l,c,u,p,d,m,h,g,f,v=[].slice;g=React.DOM,p=g.div,h=g.ul,d=g.li,m=g.span,c=g.a,u=g.button,f=n("./basic_components"),a=f.MenuHeader,i=f.MenuItem,r=f.MenuDivider,s=n("../constants/app_constants").FlagsConstants,o.exports=l=React.createClass({displayName:"ToolboxActions",propTypes:{direction:React.PropTypes.string.isRequired,displayConversations:React.PropTypes.bool.isRequired,isFlagged:React.PropTypes.bool,isSeen:React.PropTypes.bool,mailboxes:React.PropTypes.object.isRequired,message:React.PropTypes.object,messageID:React.PropTypes.string,onConversationDelete:React.PropTypes.func.isRequired,onConversationMark:React.PropTypes.func.isRequired,onConversationMove:React.PropTypes.func.isRequired,onHeaders:React.PropTypes.func,onMark:React.PropTypes.func.isRequired},shouldComponentUpdate:function(e,t){return!_.isEqual(t,this.state)||!_.isEqual(e,this.props)},render:function(){var e;return e="right"===this.props.direction?"right":"left",p({className:"menu-action btn-group btn-group-sm"},u({className:"btn btn-default dropdown-toggle fa fa-cog",type:"button","data-toggle":"dropdown"}," ",m({className:"caret"})),h.apply(null,[{className:"dropdown-menu dropdown-menu-"+e,role:"menu"},this.props.displayConversations?void 0:this.renderMarkActions(),this.props.displayConversations?void 0:r()].concat(v.call(this.renderRawActions()),[this.props.inConversation?this.renderConversationActions():void 0],[this.props.inConversation?r({key:"divider"}):void 0],[this.props.inConversation?a({key:"header-move"},t("mail action conversation move")):void 0],[this.props.inConversation?this.renderMailboxes():void 0])))},renderMarkActions:function(){var e;return e=[a({key:"header-mark"},t("mail action mark")),null!=this.props.isSeen&&this.props.isSeen?void 0:i({key:"action-mark-seen",onClick:this.props.onMark,onClickValue:s.SEEN},t("mail mark read")),null==this.props.isSeen||this.props.isSeen?i({key:"action-mark-unseen",onClick:this.props.onMark,onClickValue:s.UNSEEN},t("mail mark unread")):void 0,null==this.props.isFlagged||this.props.isFlagged?i({key:"action-mark-noflag",onClick:this.props.onMark,onClickValue:s.NOFLAG},t("mail mark nofav")):void 0,null!=this.props.isFlagged&&this.props.isFlagged?void 0:i({key:"action-mark-flagged",onClick:this.props.onMark,onClickValue:s.FLAGGED},t("mail mark fav"))],e.filter(function(e){return Boolean(e)})},renderRawActions:function(){var e;return e=[this.props.displayConversations?void 0:a({key:"header-more"},t("mail action more")),null!=this.props.messageID?i({key:"action-headers",onClick:this.props.onHeaders},t("mail action headers")):void 0,null!=this.props.message?i({key:"action-raw",href:"raw/"+this.props.message.get("id"),target:"_blank"},t("mail action raw")):void 0],e.filter(function(e){return Boolean(e)})},renderConversationActions:function(){var e;return e=[i({key:"conv-delete",onClick:this.props.onConversationDelete},t("mail action conversation delete")),i({key:"conv-seen",onClick:this.props.onConversationMark,onClickValue:s.SEEN},t("mail action conversation seen")),i({key:"conv-unseen",onClick:this.props.onConversationMark,onClickValue:s.UNSEEN},t("mail action conversation unseen")),i({key:"conv-flagged",onClick:this.props.onConversationMark,onClickValue:s.FLAGGED},t("mail action conversation flagged")),i({key:"conv-noflag",onClick:this.props.onConversationMark,onClickValue:s.NOFLAG},t("mail action conversation noflag"))]},renderMailboxes:function(){return this.props.mailboxes.filter(function(e){return function(t,n){return n!==e.props.selectedMailboxID}}(this)).map(function(e){return function(t,n){return i({key:n,className:"pusher pusher-"+t.get("depth"),onClick:e.props.onConversationMove,onClickValue:n},t.get("label"))}}(this)).toJS()}})}),require.register("components/toolbox_move",function(e,n,o){var s,r,a,i,l,c,u,p,d,m,h,g,f;g=React.DOM,c=g.div,h=g.ul,p=g.li,m=g.span,u=g.i,d=g.p,i=g.a,l=g.button,f=n("./basic_components"),s=f.MenuHeader,r=f.MenuItem,o.exports=a=React.createClass({displayName:"ToolboxMove",shouldComponentUpdate:function(e,t){return!_.isEqual(t,this.state)||!_.isEqual(e,this.props)},render:function(){var e;return e="right"===this.props.direction?"right":"left",c({className:"menu-move btn-group btn-group-sm"},l({className:"btn btn-default dropdown-toggle fa fa-folder-open",type:"button","data-toggle":"dropdown"}," ",m({className:"caret"})),h({className:"dropdown-menu dropdown-menu-"+e,role:"menu"},s(null,t("mail action move")),this.renderMailboxes()))},renderMailboxes:function(){return this.props.mailboxes.filter(function(e){return function(t,n){return n!==e.props.selectedMailboxID}}(this)).map(function(e){return function(t,n){return r({key:n,className:"pusher pusher-"+t.get("depth"),onClick:e.props.onMove,onClickValue:n},t.get("label"))}}(this)).toJS()}})}),require.register("components/tooltips-manager",function(e,n,o){var s,r,a,i;s=n("../constants/app_constants").Tooltips,i=React.DOM,r=i.div,a=i.p,o.exports=React.createClass({displayName:"TooltipManager",shouldComponentUpdate:function(){return!1},render:function(){return r(null,this.getTooltip(s.REPLY,t("tooltip reply")),this.getTooltip(s.REPLY_ALL,t("tooltip reply all")),this.getTooltip(s.FORWARD,t("tooltip forward")),this.getTooltip(s.REMOVE_MESSAGE,t("tooltip remove message")),this.getTooltip(s.OPEN_ATTACHMENTS,t("tooltip open attachments")),this.getTooltip(s.OPEN_ATTACHMENT,t("tooltip open attachment")),this.getTooltip(s.DOWNLOAD_ATTACHMENT,t("tooltip download attachment")),this.getTooltip(s.PREVIOUS_CONVERSATION,t("tooltip previous conversation")),this.getTooltip(s.NEXT_CONVERSATION,t("tooltip next conversation")),this.getTooltip(s.FILTER_ONLY_UNREAD,t("tooltip filter only unread")),this.getTooltip(s.FILTER_ONLY_IMPORTANT,t("tooltip filter only important")),this.getTooltip(s.FILTER_ONLY_WITH_ATTACHMENT,t("tooltip filter only attachment")),this.getTooltip(s.ACCOUNT_PARAMETERS,t("tooltip account parameters")),this.getTooltip(s.DELETE_SELECTION,t("tooltip delete selection")),this.getTooltip(s.FILTER,t("tooltip filter")),this.getTooltip(s.QUICK_FILTER,t("tooltip display filters")),this.getTooltip(s.EXPUNGE_MAILBOX,t("tooltip expunge mailbox")),this.getTooltip(s.HELP_SHORTCUTS,t("tooltip help shortcuts")),this.getTooltip(s.ADD_CONTACT,t("tooltip add contact")),this.getTooltip(s.SHOW_CONTACT,t("tooltip show contact")))},getTooltip:function(e,t){return a({id:e,role:"tooltip","aria-hidden":"true"},t)}})}),require.register("constants/app_constants",function(e,t,n){n.exports={ActionTypes:{CHECK_ACCOUNT_REQUEST:"CHECK_ACCOUNT_REQUEST",CHECK_ACCOUNT_SUCCESS:"CHECK_ACCOUNT_SUCCESS",CHECK_ACCOUNT_FAILURE:"CHECK_ACCOUNT_FAILURE",ADD_ACCOUNT_REQUEST:"ADD_ACCOUNT_REQUEST",ADD_ACCOUNT_SUCCESS:"ADD_ACCOUNT_SUCCESS",ADD_ACCOUNT_FAILURE:"ADD_ACCOUNT_FAILURE",REMOVE_ACCOUNT_REQUEST:"REMOVE_ACCOUNT_REQUEST",REMOVE_ACCOUNT_SUCCESS:"REMOVE_ACCOUNT_SUCCESS",REMOVE_ACCOUNT_FAILURE:"REMOVE_ACCOUNT_FAILURE",EDIT_ACCOUNT_REQUEST:"EDIT_ACCOUNT_REQUEST",EDIT_ACCOUNT_SUCCESS:"EDIT_ACCOUNT_SUCCESS",EDIT_ACCOUNT_FAILURE:"EDIT_ACCOUNT_FAILURE",SELECT_ACCOUNT:"SELECT_ACCOUNT",NEW_ACCOUNT_SETTING:"NEW_ACCOUNT_SETTING",MAILBOX_ADD:"MAILBOX_ADD",MAILBOX_CREATE:"MAILBOX_CREATE",MAILBOX_UPDATE:"MAILBOX_UPDATE",MAILBOX_DELETE:"MAILBOX_DELETE",MAILBOX_EXPUNGE:"MAILBOX_EXPUNGE",RECEIVE_RAW_MESSAGE:"RECEIVE_RAW_MESSAGE",RECEIVE_RAW_MESSAGES:"RECEIVE_RAW_MESSAGES",RECEIVE_RAW_MESSAGE_REALTIME:"RECEIVE_RAW_MESSAGE_REALTIME",MESSAGE_SEND:"MESSAGE_SEND",MESSAGE_CURRENT:"MESSAGE_CURRENT",RECEIVE_MESSAGE_DELETE:"RECEIVE_MESSAGE_DELETE",RECEIVE_MAILBOX_UPDATE:"RECEIVE_MAILBOX_UPDATE",MESSAGE_TRASH_REQUEST:"MESSAGE_TRASH_REQUEST",MESSAGE_TRASH_SUCCESS:"MESSAGE_TRASH_SUCCESS",MESSAGE_TRASH_FAILURE:"MESSAGE_TRASH_FAILURE",MESSAGE_MOVE_REQUEST:"MESSAGE_MOVE_REQUEST",MESSAGE_MOVE_SUCCESS:"MESSAGE_MOVE_SUCCESS",MESSAGE_MOVE_FAILURE:"MESSAGE_MOVE_FAILURE",MESSAGE_FLAGS_REQUEST:"MESSAGE_FLAGS_REQUEST",MESSAGE_FLAGS_SUCCESS:"MESSAGE_FLAGS_SUCCESS",MESSAGE_FLAGS_FAILURE:"MESSAGE_FLAGS_FAILURE",MESSAGE_FETCH_REQUEST:"MESSAGE_FETCH_REQUEST",MESSAGE_FETCH_SUCCESS:"MESSAGE_FETCH_SUCCESS",MESSAGE_FETCH_FAILURE:"MESSAGE_FETCH_FAILURE",MESSAGE_UNDO_REQUEST:"MESSAGE_UNDO_REQUEST",MESSAGE_UNDO_SUCCESS:"MESSAGE_UNDO_SUCCESS",MESSAGE_UNDO_FAILURE:"MESSAGE_UNDO_FAILURE",MESSAGE_UNDO_TIMEOUT:"MESSAGE_UNDO_TIMEOUT",CONVERSATION_FETCH_REQUEST:"CONVERSATION_FETCH_REQUEST",CONVERSATION_FETCH_SUCCESS:"CONVERSATION_FETCH_SUCCESS",CONVERSATION_FETCH_FAILURE:"CONVERSATION_FETCH_FAILURE",MESSAGE_RECOVER_REQUEST:"MESSAGE_RECOVER_REQUEST",MESSAGE_RECOVER_SUCCESS:"MESSAGE_RECOVER_SUCCESS",MESSAGE_RECOVER_FAILURE:"MESSAGE_RECOVER_FAILURE",SEARCH_PARAMETER_CHANGED:"SEARCH_PARAMETER_CHANGED",SEARCH_REQUEST:"SEARCH_REQUEST",SEARCH_SUCCESS:"SEARCH_SUCCESS",SEARCH_FAILURE:"SEARCH_FAILURE",SET_CONTACT_QUERY:"SET_CONTACT_QUERY",RECEIVE_RAW_CONTACT_RESULTS:"RECEIVE_RAW_CONTACT_RESULTS",CLEAR_CONTACT_RESULTS:"CLEAR_CONTACT_RESULTS",CONTACT_LOCAL_SEARCH:"CONTACT_LOCAL_SEARCH",SET_DISPOSITION:"SET_DISPOSITION",TOGGLE_LIST_MODE:"TOGGLE_LIST_MODE",RESIZE_PREVIEW_PANE:"RESIZE_PREVIEW_PANE",MAXIMIZE_PREVIEW_PANE:"MAXIMIZE_PREVIEW_PANE",MINIMIZE_PREVIEW_PANE:"MINIMIZE_PREVIEW_PANE",DISPLAY_MODAL:"DISPLAY_MODAL",HIDE_MODAL:"HIDE_MODAL",REFRESH:"REFRESH",INTENT_AVAILABLE:"INTENT_AVAILABLE",SETTINGS_UPDATED:"SETTINGS_UPDATED",RECEIVE_TASK_UPDATE:"RECEIVE_TASK_UPDATE",RECEIVE_TASK_DELETE:"RECEIVE_TASK_DELETE",CLEAR_TOASTS:"CLEAR_TOASTS",RECEIVE_REFRESH_UPDATE:"RECEIVE_REFRESH_UPDATE",RECEIVE_REFRESH_STATUS:"RECEIVE_REFRESH_STATUS",RECEIVE_REFRESH_DELETE:"RECEIVE_REFRESH_DELETE",RECEIVE_REFRESH_NOTIF:"RECEIVE_REFRESH_NOTIF",REFRESH_REQUEST:"REFRESH_REQUEST",REFRESH_SUCCESS:"REFRESH_SUCCESS",REFRESH_FAILURE:"REFRESH_FAILURE",QUERY_PARAMETER_CHANGED:"QUERY_PARAMETER_CHANGED",TOASTS_SHOW:"TOASTS_SHOW",TOASTS_HIDE:"TOASTS_HIDE",DRAWER_SHOW:"DRAWER_SHOW",DRAWER_HIDE:"DRAWER_HIDE",DRAWER_TOGGLE:"DRAWER_TOGGLE"},PayloadSources:{VIEW_ACTION:"VIEW_ACTION",SERVER_ACTION:"SERVER_ACTION"},ComposeActions:{REPLY:"REPLY",REPLY_ALL:"REPLY_ALL",FORWARD:"FORWARD"},AlertLevel:{SUCCESS:"SUCCESS",INFO:"INFO",WARNING:"WARNING",ERROR:"ERROR"},MessageFlags:{FLAGGED:"\\Flagged",SEEN:"\\Seen",DRAFT:"\\Draft"},MessageFilter:{ALL:"all",ATTACH:"attach",FLAGGED:"flagged",UNSEEN:"unseen"},MailboxFlags:{DRAFT:"\\Drafts",SENT:"\\Sent",TRASH:"\\Trash",ALL:"\\All",SPAM:"\\Junk",FLAGGED:"\\Flagged"},FlagsConstants:{SEEN:"\\Seen",UNSEEN:"Unseen",FLAGGED:"\\Flagged",NOFLAG:"Noflag"},Dispositions:{COL:"column",ROW:"row"},SpecialBoxIcons:{inboxMailbox:"fa-inbox",draftMailbox:"fa-file-text-o",sentMailbox:"fa-send-o",trashMailbox:"fa-trash-o",junkMailbox:"fa-fire",allMailbox:"fa-archive"},Tooltips:{REPLY:"TOOLTIP_REPLY",REPLY_ALL:"TOOLTIP_REPLY_ALL",FORWARD:"TOOLTIP_FORWARD",REMOVE_MESSAGE:"TOOLTIP_REMOVE_MESSAGE",OPEN_ATTACHMENTS:"TOOLTIP_OPEN_ATTACHMENTS",OPEN_ATTACHMENT:"TOOLTIP_OPEN_ATTACHMENT",DOWNLOAD_ATTACHMENT:"TOOLTIP_DOWNLOAD_ATTACHMENT",PREVIOUS_CONVERSATION:"TOOLTIP_PREVIOUS_CONVERSATION",NEXT_CONVERSATION:"TOOLTIP_NEXT_CONVERSATION",FILTER_ONLY_UNREAD:"TOOLTIP_FILTER_ONLY_UNREAD",FILTER_ONLY_IMPORTANT:"TOOLTIP_FILTER_ONLY_IMPORTANT",FILTER_ONLY_WITH_ATTACHMENT:"TOOLTIP_FILTER_ONLY_WITH_ATTACHMENT",ACCOUNT_PARAMETERS:"TOOLTIP_ACCOUNT_PARAMETERS",DELETE_SELECTION:"TOOLTIP_DELETE_SELECTION",FILTER:"TOOLTIP_FILTER",QUICK_FILTER:"TOOLTIP_QUICK_FILTER",COMPOSE_IMAGE:"TOOLTIP_COMPOSE_IMAGE",COMPOSE_MOCK:"TOOLTIP_COMPOSE_MOCK",EXPUNGE_MAILBOX:"TOOLTIP_EXPUNGE_MAILBOX",ADD_CONTACT:"TOOLTIP_ADD_CONTACT",SHOW_CONTACT:"TOOLTIP_SHOW_CONTACT",HELP_SHORTCUTS:"TOOLTIP_HELP_SHORTCUT"}}}),require.register("initialize",function(e,t,n){var o,s,r,a;s=function(){var e;return e=0,window.start=function(){return null!=("undefined"!=typeof performance&&null!==performance?performance.now:void 0)&&(e=performance.now()),React.addons.Perf.start()},window.stop=function(){return null!=("undefined"!=typeof performance&&null!==performance?performance.now:void 0)&&console.log(performance.now()-e),React.addons.Perf.stop()},window.printWasted=function(){return stop(),React.addons.Perf.printWasted()},window.printInclusive=function(){return stop(),React.addons.Perf.printInclusive()},window.printExclusive=function(){return stop(),React.addons.Perf.printExclusive()}},a=function(){var e,t,n,o,s;return n=null!=(o=window.performance)?o.timing:void 0,t=Math.ceil(null!=(s=window.performance)?s.now():void 0),null!=n?(e="Response at "+(n.responseEnd-n.navigationStart)+"ms\nOnload at "+(n.loadEventStart-n.navigationStart)+"ms\nPage loaded in "+t+"ms",window.cozyMails.logInfo(e)):void 0},o=function(){var e;return e=t("./utils/intent_manager"),window.intentManager=new e,window.intentManager.send("nameSpace",{type:"ping",from:"mails"}).then(function(e){return LayoutActionCreator.intentAvailability(!0)},function(e){return LayoutActionCreator.intentAvailability(!1)})},r=function(){var e;return e=t("./utils/plugin_utils"),null==window.settings.plugins&&(window.settings.plugins={}),e.merge(window.settings.plugins),e.init()},window.onerror=function(e,t,n,o,s){var r,a,i;return console.error(e,t,n,o,s,null!=s?s.stack:void 0),a=(null!=s?s.toString():void 0)||e,a!==window.lastError?(r={data:{type:"error",error:{msg:e,name:null!=s?s.name:void 0,full:a,stack:null!=s?s.stack:void 0},url:t,line:n,col:o,href:window.location.href}},i=new XMLHttpRequest,i.open("POST","activity",!0),i.setRequestHeader("Content-Type","application/json;charset=UTF-8"),i.send(JSON.stringify(r)),window.lastError=a):void 0},window.onload=function(){var e,n,r,i,l,c,u,p,d,m,h,g,f,v,b;try{return window.__DEV__="localhost"===window.location.hostname,s(),window.cozyMails=t("./utils/api_utils"),null==window.settings&&(window.settings={}),v=window.locale||window.navigator.language||"en",window.cozyMails.setLocale(v),i=t("./actions/layout_action_creator/"),i.setDisposition(window.settings.layoutStyle),u=t("./utils/plugin_utils"),null==window.settings.plugins&&(window.settings.plugins={}),u.merge(window.settings.plugins),u.init(),window.cozyMails.setSetting("plugins",window.settings.plugins),o(),e=t("./stores/account_store"),r=t("./stores/contact_store"),l=t("./stores/layout_store"),c=t("./stores/message_store"),d=t("./stores/settings_store"),p=t("./router"),this.router=new p,window.router=this.router,n=t("./components/application"),m=n({router:this.router}),window.rootComponent=React.renderComponent(m,document.body),Backbone.history.start(),t("./utils/socketio_utils"),window.settings.desktopNotifications&&null!=window.Notification&&Notification.requestPermission(function(e){return Notification.permission!==e?Notification.permission=e:void 0}),a(),window.cozyMails.customEvent("APPLICATION_LOADED")}catch(y){if(g=y,console.error(g,null!=g?g.stack:void 0),f=g.toString(),f!==window.lastError)return h={data:{type:"error",error:{msg:g.message,name:null!=g?g.name:void 0,full:f,stack:null!=g?g.stack:void 0},file:null!=g?g.fileName:void 0,line:null!=g?g.lineNumber:void 0,col:null!=g?g.columnNumber:void 0,href:window.location.href}},b=new XMLHttpRequest,b.open("POST","activity",!0),b.setRequestHeader("Content-Type","application/json;charset=UTF-8"),b.send(JSON.stringify(h)),window.lastError=f}}}),require.register("libs/cached_transform",function(e,t,n){var o=[].slice;n.exports=function(){var e,t,n,s,r,a,i,l,c,u,p,d,m;if(l=arguments[0],r=arguments[1],t=4<=arguments.length?o.call(arguments,2,u=arguments.length-1):(u=2,[]),c=arguments[u++],null==l.__cachedTransforms&&(l.__cachedTransforms={}),n=l.__cachedTransforms[r],i=!0,n){for(m=n.args,s=p=0,d=m.length;d>p;s=++p)e=m[s],t[s]!==e&&(i=!1);if(i)return n.result}return a=c(),l.__cachedTransforms[r]={args:t,result:a},a}}),require.register("libs/flux/dispatcher/dispatcher",function(e,t,n){var o,s,r,a;s=t("../invariant"),r=1,a="ID_",n.exports=o=o=function(){function e(){this._callbacks={},this._isPending={},this._isHandled={},this._isDispatching=!1,this._pendingPayload=null}return e.prototype.register=function(e){var t;return t=a+r++,this._callbacks[t]=e,t},e.prototype.unregister=function(e){var t;return t="Dispatcher.unregister(...): `%s` does not map to a registered callback.",s(this._callbacks[e],t,e),delete this._callbacks[e]},e.prototype.waitFor=function(e){var t,n,o,r,a,i,l;for(s(this._isDispatching,"Dispatcher.waitFor(...): Must be invoked while dispatching."),o="Dispatcher.waitFor(...): Circular dependency detected while waiting for `%s`.",r="Dispatcher.waitFor(...): `%s` does not map to a registered callback.",l=[],n=a=0,i=e.length-1;i>=a;n=a+=1)t=e[n],this._isPending[t]?s(this._isHandled[t],o,t):(s(this._callbacks[t],r,t),l.push(this._invokeCallback(t)));return l},e.prototype.dispatch=function(e){var t,n,o;console.log("DIS",e.action.type,e.action.value),n="Dispatch.dispatch(...): Cannot dispatch in the middle of a dispatch.",s(!this._isDispatching,n),this._startDispatching(e);try{o=[];for(t in this._callbacks)this._isPending[t]||o.push(this._invokeCallback(t));return o}finally{this._stopDispatching()}},e.prototype.isDispatching=function(){return this._isDispatching},e.prototype._invokeCallback=function(e){return this._isPending[e]=!0,this._callbacks[e](this._pendingPayload),this._isHandled[e]=!0},e.prototype._startDispatching=function(e){var t;for(t in this._callbacks)this._isPending[t]=!1,this._isHandled[t]=!1;return this._pendingPayload=e,this._isDispatching=!0},e.prototype._stopDispatching=function(){return this._pendingPayload=null,this._isDispatching=!1},e}()}),require.register("libs/flux/invariant",function(e,t,n){"use strict";var o=function(e,t,n,o,s,r,a,i){if(__DEV__&&void 0===t)throw new Error("invariant requires an error message argument");if(!e){var l;if(void 0===t)l=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var c=[n,o,s,r,a,i],u=0;l=new Error("Invariant Violation: "+t.replace(/%s/g,function(){return c[u++]}))}throw l.framesToPop=1,l}};n.exports=o}),require.register("libs/flux/store/store",function(e,t,n){var o,s,r={}.hasOwnProperty,a=function(e,t){function n(){this.constructor=e}for(var o in t)r.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};o=t("../../../app_dispatcher"),n.exports=s=function(e){function t(){t.__super__.constructor.call(this),this.uniqID=r++,this.__bindHandlers(n.bind(this)),i.call(this)}var n,s,r,i;return a(t,e),t.prototype.uniqID=null,r=0,s={},n=function(e,t){return null==s[this.uniqID]&&(s[this.uniqID]={}),s[this.uniqID][e]=t},i=function(){return this.dispatchToken=o.register(function(e){return function(t){var n,o,r,a;return a=t.action,o=a.type,r=a.value,null!=(n=s[e.uniqID][o])?n.call(e,r):void 0}}(this))},t.prototype.__bindHandlers=function(e){var t;if(__DEV__)throw t="The store "+this.constructor.name+" must define a `__bindHandlers` method",new Error(t)},t}(EventEmitter)}),require.register("libs/panel_router",function(e,t,n){var o,s,r={}.hasOwnProperty,a=function(e,t){function n(){this.constructor=e}for(var o in t)r.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};o=t("../actions/layout_action_creator"),n.exports=s=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return a(t,e),t.prototype.patterns={},t.prototype.routes={},t.prototype.previous=null,t.prototype.current=null,t.prototype.cachedPatterns=[],t.prototype.initialize=function(e){var t,n,s;s=this.patterns;for(t in s)n=s[t],this.cachedPatterns.push({key:t,pattern:this._routeToRegExp(n.pattern)}),this.routes[n.pattern]=t,this.routes[""+n.pattern+"/*secondPanel"]=t;return this._bindRoutes(),this.on("route",function(e){return function(t,n){var s,r,a,i,l,c;return"default"===t?(e.current={firstPanel:null,secondPanel:null},l=e.buildUrl({direction:"first",fullWidth:!0,action:o.getDefaultRoute(),parameters:[null]}),e.navigate(l,{trigger:!0})):(c=e._processSubRouting(t,n),r=c[0],i=c[1],s=e.fluxActionFactory(r),a=e.fluxActionFactory(i),e.previous=e.current,e.current={firstPanel:r,secondPanel:i},null!=s&&s(r,"first"),null!=a&&a(i,"second"),e.trigger("fluxRoute",e.current))}}(this))},t.prototype.fluxActionFactory=function(e){var t,n;return t=null,n=this.patterns[null!=e?e.action:void 0],null!=n?(t=o[n.fluxAction],null==t&&console.warn("`"+n.fluxAction+"` method not found in layout actions."),t):void 0},t.prototype._processSubRouting=function(e,t){var n,o,s,r,a,i;return t.pop(),i=t.pop(),s=this.patterns[e].pattern.match(/:[\w]+/g)||[],s.length>t.length&&null!=i&&(t.push(i),i=null),o=this._arrayToNamedParameters(e,t),r=_.first(_.filter(this.cachedPatterns,function(e){return e.pattern.test(i)})),null!=r?(t=this._extractParameters(r.pattern,i),t.pop(),a=this._mergeDefaultParameter({action:r.key,parameters:this._arrayToNamedParameters(r.key,t)})):a=null,n=this._mergeDefaultParameter({action:e,parameters:o}),[n,a]},t.prototype._arrayToNamedParameters=function(e,t){var n,o,s,r,a,i,l;for(o={},r=this.patterns[e].pattern.match(/:[\w]+/g)||[],n=i=0,l=r.length;l>i;n=++i)s=r[n],a=s.substr(1),o[a]=t[n];return o},t.prototype._namedParametersToArray=function(e,t){var n,o,s,r,a,i,l;for(s=[],r=this.patterns[e].pattern.match(/:[\w]+/g)||[],n=i=0,l=r.length;l>i;n=++i)o=r[n],a=o.substr(1),s.push(t[o]);return s},t.prototype.buildUrl=function(e){var t,n,o,s,r,a;return null!=e.firstPanel||null!=e.secondPanel?(t=e.firstPanel||this.current.firstPanel,s=e.secondPanel||this.current.secondPanel):null!=e.direction?"first"===e.direction?(t=e,s=this.current.secondPanel):"second"===e.direction?(t=this.current.firstPanel,s=e):console.warn("`direction` should be `first`, `second`."):console.warn("`direction` parameter is mandatory when using short call."),o=null!=e.firstPanel||"first"===e.direction,o&&e.fullWidth&&(null!=e.secondPanel&&"second"===e.direction&&console.warn("You shouldn't use the fullWidth option with a second panel"),s=null),n=this._getURLFromRoute(t),r=this._getURLFromRoute(s),a="#"+n,null!=r&&r.length>0&&(a=""+a+"/"+r),a},t.prototype.buildClosePanelUrl=function(e){var t;return t="first"===e||"full"===e?_.clone(this.current.secondPanel):_.clone(this.current.firstPanel),null!=t?(t.direction="first",t.fullWidth=!0,this.buildUrl(t)):"#"},t.prototype._getURLFromRoute=function(e){var t,n,o,s,r,a,i,l,c,u;if(e=_.clone(e),null!=(null!=e?e.parameters:void 0)&&(e.parameters=_.clone(e.parameters)),null!=e){if(l=this.patterns[e.action].pattern,null==e.parameters||e.parameters instanceof Array||e.parameters instanceof Object||(e.parameters=[e.parameters]),null!=e.parameters&&e.parameters instanceof Array&&(t=e.action,a=e.parameters,e.parameters=this._arrayToNamedParameters(t,a)),e=this._mergeDefaultParameter(e),i=l.match(/:[\w]+/gi)||[],n=l,e.parameters)for(c=0,u=i.length;u>c;c++)s=i[c],o=s.substr(1),r=e.parameters[o],n=n.replace(s,r);return n}return""},t.prototype._mergeDefaultParameter=function(e){var t,n,o,s;if(e=_.clone(e),s=_.clone(e.parameters||{}),n=this._getDefaultParameters(e.action,e.parameters),null!=n)for(o in n)t=n[o],null==s[o]&&(s[o]=t);return e.parameters=s,e},t}(Backbone.Router)}),require.register("libs/prop_types",function(e,t,n){var o,s,r,a;o=e,a=React.PropTypes;for(s in a)r=a[s],o[s]=r;o.valueLink=function(e){return React.PropTypes.shape({value:e,requestChange:React.PropTypes.func.isRequired})},o.immutableMapStringTo=function(e){return function(t,n,s,r){var a,i,l,c;if(a=o.instanceOf(Immutable.Map).isRequired.apply(this,arguments))return a;c=t[n].values();for(l in c)if(i=c[l],a=e(c,i,s,r))return a;return null}},o.Mailbox=function(){return React.PropTypes.shape({id:o.string,label:o.string,depth:o.number,weight:o.number,attribs:o.arrayOf(o.string)})},o.Account=function(){return React.PropTypes.shape({label:o.string,name:o.string,login:o.string,password:o.string,imapServer:o.string,imapPort:o.string,smtpServer:o.string,smtpPort:o.string,smtpMethod:o.string,draftMailbox:o.string,sentMailbox:o.string,trashMailbox:o.string})}}),require.register("locales/en",function(e,t,n){n.exports={"app loading":"Loading…","app back":"Back","app cancel":"Cancel","app confirm":"Confirm","app menu":"Menu","app search":"Search…","app alert close":"Close","app unimplemented":"Not implemented yet","app error":"Argh, I'm unable to perform this action, please try again","app confirm delete":"Confirm delete",compose:"Compose new email","compose default":"Hello, how are you doing today?","compose from":"From","compose to":"To","compose to help":"Recipients list","compose cc":"Cc","compose cc help":"Copy list","compose bcc":"Bcc","compose bcc help":"Hidden copy list","compose subject":"Subject","compose content":"Content","compose subject help":"Subject","compose reply prefix":"Re: ","compose reply separator":"\n\nOn %{date}, %{sender} wrote \n","compose forward prefix":"Fwd: ",
"compose forward separator":"\n\nOn %{date}, %{sender} wrote \n","compose action draft":"Save draft","compose action send":"Send","compose action delete":"Delete draft","compose action sending":"Sending","compose toggle cc":"Cc","compose toggle bcc":"Bcc","compose error no dest":"You can not send a message to nobody","compose error no subject":"Please set a subject","compose confirm keep draft":"Message not sent, keep the draft?","compose confirm draft keep":"Keep draft","compose confirm draft delete":"Delete draft","compose wrong email format":"The given email is unproperly formatted: %{address}.","compose forward header":"Forwarded message","compose forward subject":"Subject:","compose forward date":"Date:","compose forward from":"From:","compose forward to":"To:","menu show":"Show menu","menu compose":"Compose","menu account new":"New Mailbox","menu settings":"Parameters","menu mailbox total":"%{smart_count} message|||| %{smart_count} messages","menu mailbox unread":", %{smart_count} unread message ||||, %{smart_count} unread messages ","menu mailbox new":" and %{smart_count} new message|||| and %{smart_count} new messages ","menu favorites on":"Less","menu favorites off":"More","menu toggle":"Toggle Menu","menu refresh label":"Refresh","menu refreshing":"Refreshing...","list empty":"No email in this box.","no flagged message":"No Important email in this box.","no unseen message":"All emails have been read in this box","no attach message":"No message with attachments","no filter message":"No email for this filter.","list fetching":"Loading…","list search empty":'No result found for the query "%{query}".',"list count":"%{smart_count} message in this box |||| %{smart_count} messages in this box","list search count":"%{smart_count} result found. |||| %{smart_count} results found.","list filter":"Filter","list filter all":"All","list filter unseen":"Unseen","list filter flagged":"Important","list filter attach":"Attachments","list filter from":"Sender is","list filter date":"Date in","list filter date placeholder":"DD/MM/YYYY","list filter dest":"Recipient is","list filter subject":"Subject starts with…","list sort":"Sort","list sort date":"Date","list sort subject":"Subject","list option compact":"Compact","list next page":"More messages","list end":"This is the end of the road","list mass no message":"No message selected","list delete confirm":"Do you really want to delete this message ? ||||\nDo you really want to delete %{smart_count} messages?","list delete conv confirm":"Do you really want to delete this conversation ? ||||\nDo you really want to delete %{smart_count} conversation?","mail to":"To: ","mail cc":"Cc: ","headers from":"From","headers to":"To","headers cc":"Cc","headers reply-to":"Reply to","headers date":"Date","headers subject":"Subject","load more messages":"Load %{smart_count} more message |||| load %{smart_count} more messages","length bytes":"bytes","length kbytes":"Kb","length mbytes":"Mb","mail action reply":"Reply","mail action reply all":"Reply all","mail action forward":"Forward","mail action delete":"Delete","mail action mark":"Mark as","mail action copy":"Copy","mail action move":"Move","mail action more":"More","mail action headers":"Headers","mail action raw":"Raw message","mail mark spam":"Spam","mail mark nospam":"No spam","mail mark fav":"Important","mail mark nofav":"Not important","mail mark read":"Read","mail mark unread":"Unread","mail confirm delete title":"Delete message","mail confirm delete":"Do you really want to delete message “%{subject}”?","mail confirm delete nosubject":"Do you really want to delete this message?","mail confirm delete cancel":"Cancel","mail confirm delete delete":"Delete","mail action conversation delete":"Delete conversation","mail action conversation move":"Move conversation","mail action conversation seen":"Mark conversation as read","mail action conversation unseen":"Mark conversation as unread","mail action conversation flagged":"Mark conversation as important","mail action conversation noflag":"Mark conversation as normal","mail conversation length":"%{smart_count} message dans cette conversation. ||||\n%{smart_count} messages dans cette conversation.","account new":"New account","account edit":"Edit account","account add":"Add","account save":"Save","account saving":"Saving","account check":"Check connection","account accountType short":"IMAP","account accountType":"Account type","account imapPort short":"993","account imapPort":"Port","account imapSSL":"Use SSL","account imapServer short":"imap.provider.tld","account imapServer":"IMAP server","account imapTLS":"Use TLS","account imapLogin short":"IMAP user","account imapLogin":"IMAP user (if different from email address)","account label short":"A short mailbox name","account label":"Account label","account login short":"Your email address","account login":"Email address","account name short":"Your name, as it will be displayed","account name":"Your name","account oauth":"This account uses Google OAuth","account password":"Password","account receiving server":"Receiving server","account sending server":"Sending server","account smtpLogin short":"SMTP user","account smtpLogin":"SMTP user (if different from email address)","account smtpMethod":"Authentification method","account smtpMethod NONE":"None","account smtpMethod PLAIN":"Plain","account smtpMethod LOGIN":"Login","account smtpMethod CRAM-MD5":"Cram-MD5","account smtpPassword short":"SMTP password","account smtpPassword":"SMTP password (if different from IMAP password)","account smtpPort short":"465","account smtpPort":"Port","account smtpSSL":"Use SSL","account smtpServer short":"smtp.provider.tld","account smtpServer":"SMTP server","account smtpTLS":"Use STARTTLS","account remove":"Remove this account","account removed":"Account removed","account remove confirm":"Do you really want to remove account “%{label}” ?","account draft mailbox":"Draft box","account sent mailbox":"Sent box","account trash mailbox":"Trash","account mailboxes":"Folders","account special mailboxes":"Special mailboxes","account newmailbox label":"New Folder","account newmailbox placeholder":"Name","account newmailbox parent":"Parent:","account confirm delbox":"Do you really want to delete all messages in this box?","account tab account":"Account","account tab mailboxes":"Folders","account errors":"Some data are missing or invalid","account type":"Account type","account updated":"Account updated","account checked":"Parameters ok","account creation ok":"Yeah! The account has been successfully created. Now select the mailboxes you want to see in the menu","account refreshed":"Account refreshed","account refresh error":"Error refreshing accounts, check parameters","account identifiers":"Identification","account actions":"Actions","account danger zone":"Danger Zone","account no special mailboxes":"Please choose a specific folder for your Drafts, Sent and Deleted emails.","account imap hide advanced":"Hide advanced parameters","account imap show advanced":"Show advanced parameters","account smtp hide advanced":"Hide advanced parameters","account smtp show advanced":"Show advanced parameters","account tab signature":"Signature","account signature short":"Type here the text that will be added to the bottom of all your emails.","account signature":"Email Signature","account signature save":"Save","mailbox create ok":"Folder created","mailbox create ko":"Error creating folder","mailbox update ok":"Folder updated","mailbox update ko":"Error updating folder","mailbox delete ok":"Folder deleted","mailbox delete ko":"Error deleting folder","mailbox expunge ok":"Folder expunged","mailbox expunge ko":"Error expunging folder","mailbox title edit":"Rename folder","mailbox title delete":"Delete folder","mailbox title edit save":"Save","mailbox title edit cancel":"Cancel","mailbox title add":"Add new folder","mailbox title add cancel":"Cancel","mailbox title favorite":"Folder is displayed","mailbox title not favorite":"Folder not displayed","mailbox title total":"Total","mailbox title unread":"Unread","mailbox title new":"New","config error auth":"Wrong connection parameters","config error imapPort":"Wrong IMAP parameters","config error imapServer":"Wrong IMAP server","config error imapTLS":"Wrong IMAP TLS","config error smtpPort":"Wrong SMTP Port","config error smtpServer":"Wrong SMTP Server","config error nomailboxes":"No folder in this account, please create one","action undo":"Undo","action undo ok":"Action cancelled","action undo ko":"Unable to undo action","message action sent ok":"Message sent","message action sent ko":"Error sending message: ","message action draft ok":"Message saved","message action draft ko":"Error saving message: ","message delete ok":"Message “%{subject}” deleted","message delete ko":"Error deleting message: ","message move ok":"Message “%{subject}” moved","message move ko":"Error moving message “%{subject}”: ","message mark ok":"Message marked","message flag ko":"Error marking message","message flag ok":"Message marked","message mark ko":"Error marking message: ","draft delete ok":"Draft “%{subject}” deleted","draft delete ko":"Error deleting draft: ","draft move ok":"Draft “%{subject}” moved","draft move ko":"Error moving draft “%{subject}”: ","draft mark ok":"Draft marked","draft mark ko":"Error marking message: ","conversation move ok":"Conversation “%{subject}” moved","conversation move ko":"Error moving conversation “%{subject}”","conversation delete ok":"Conversation “%{subject}” deleted","conversation delete ko":"Error deleting conversation","conversation seen ok":"Conversation marked as read","conversation seen ko":"Error","conversation unseen ok":"Conversation marked as unread","conversation unseen ko":"Error","undo last action":"Undo last action","conversation flagged ko":"Error","conversation noflag ko":"Error","conversations move ok":"%{smart_count} conversation moved||||\n%{smart_count} conversations moved","conversations move ko":"Error moving %{smart_count} conversation||||\nError moving %{smart_count} conversations","conversations delete ok":"%{smart_count} conversation deleted||||\n%{smart_count} conversations deleted","conversations delete ko":"Error deleting %{smart_count} conversation ||||\nError deleting %{smart_count} conversations","conversations seen ok":"%{smart_count} conversation moved||||\n%{smart_count} conversations moved","conversations seen ko":"Error marking %{smart_count} as read||||\nError marking %{smart_count} as read","conversations unseen ok":"%{smart_count} conversation marked as unread||||\n%{smart_count} conversations marked as unread","conversations unseen ko":"Error marking %{smart_count} conversations as unread||||\nError marking %{smart_count} conversations as unread","conversations flagged ko":"Error marking %{smart_count} conversation as flagged||||\nError marking %{smart_count} conversations as flagged","conversations noflag ko":"%{smart_count} conversation unflagged||||\n%{smart_count} conversations unflagged","message images warning":"Display of images inside message has been blocked","message images display":"Display images","message html display":"Display HTML","message delete no trash":"Please select a Trash folder","message delete already":"Message already in trash folder","message move already":"Message already in this folder","undo ok":"Undone","undo ko":"Error undoing some action","undo unavailable":"Undo not available","message preview title":"View attachments","settings title":"Settings","settings button save":"Save","settings plugins":"Add ons","settings plugins":"Modules complémentaires","settings plugin add":"Add","settings plugin del":"Delete","settings plugin help":"Help","settings plugin new name":"Plugin Name","settings plugin new url":"Plugin URL","settings label autosaveDraft":"Save draft message while composing","settings label composeInHTML":"Rich message editor","settings label composeOnTop":"Reply on top of message","settings label desktopNotifications":"Notifications","settings label displayConversation":"Display conversations","settings label displayPreview":"Display message preview","settings label messageDisplayHTML":"Display message in HTML","settings label messageDisplayImages":"Display images inside messages","settings label messageConfirmDelete":"Confirm before deleting a message","settings label layoutStyle":"Display Layout","settings label layoutStyle horizontal":"Horizontal","settings label layoutStyle vertical":"Vertical","settings label layoutStyle three":"Three cols","settings label listStyle":"Message list style","settings label listStyle default":"Normal","settings label listStyle compact":"Compact","settings lang":"Language","settings lang en":"English","settings lang fr":"Français","settings lang de":"Deutsch","settings save error":"Unable to save settings, please try again","picker drop here":"Drop files here or Choose local files","mailbox pick one":"Pick one","mailbox pick null":"No box for this","task account-fetch":"Refreshing %{account}","task box-fetch":"Refreshing %{box}","task apply-diff-fetch":"Fetching mails from %{box} of %{account}","task apply-diff-remove":"Deleting mails from %{box} of %{account}","task recover-uidvalidity":"Analysing","there were errors":"%{smart_count} error. |||| %{smart_count} errors.","modal please report":"Please transmit this information to cozy.","modal please contribute":"Please contribute","modal copy content":"Copy information into clipboard","validate must not be empty":"This field is required","toast hide":"Hide alerts","toast show":"Display alerts","toast close all":"Close all alerts","notif new title":"CozyEmail","notif new":"%{smart_count} message not read in account %{account}||||\n%{smart_count} messages not read in account %{account}","notif complete":"Importation of account %{account} complete.","contact form":"Select contacts","contact form placeholder":"contact name","contact button label":"Add to addressbook","contact create success":"%{contact} has been added to your contacts","contact create error":"Error adding to your contacts : {error}","message contact creation title":"Add a contact","message contact creation":"Do you want to create a contact for %{contact}?","gmail security tile":"About Gmail security","gmail security body":"Gmail considers connection using username and password not safe.\nPlease click on the following link, make sure\nyou are connected with your %{login} account and enable access for\nless secure apps.","gmail security link":"Enable access for less secure apps.","plugin name Gallery":"Attachment gallery","plugin name medium-editor":"Medium editor","plugin name MiniSlate":"MiniSlate editor","plugin name Sample JS":"Sample","plugin name Keyboard shortcuts":"Keyboard shortcuts","plugin name VCard":"Contacts VCards","plugin modal close":"Close","calendar unknown format":"This message contains an invite to an event in a currently unknown format.","tooltip reply":"Answer","tooltip reply all":"Answer to all","tooltip forward":"Forward","tooltip remove message":"Remove","tooltip open attachments":"Open attachment list","tooltip open attachment":"Open attachment","tooltip download attachment":"Download the attachment","tooltip previous conversation":"Go to previous conversation","tooltip next conversation":"Go to next conversation","tooltip filter only unread":"Show only unread messages","tooltip filter only important":"Show only important messages","tooltip filter only attachment":"Show only messages with attachment","tooltip account parameters":"Account parameters","tooltip delete selection":"Delete all selected messages","tooltip filter":"Filter","tooltip display filters":"Display filters","tooltip expunge mailbox":"Expunge mailbox","tooltip add contact":"Add to your contacts","tooltip show contact":"Show contact","tooltip help shortcuts":"Show list of available shortcuts","filters unseen":"unread","filters flagged":"starred","filters attach":"attachments","filters search placeholder":"Search...","search all accounts":"All accounts","daterangepicker placeholder":"by date","daterangepicker presets yesterday":"yesterday","daterangepicker presets last week":"last week","daterangepicker presets last month":"last month","daterangepicker clear":"clear"}}),require.register("mixins/participant_mixin",function(e,t,n){var o,s,r,a,i,l;l=React.DOM,i=l.span,r=l.a,a=l.i,s=t("../stores/contact_store"),o=t("../components/contact_label"),n.exports={formatUsers:function(e){var t,n,s,r;if(null!=e){if(_.isArray(e)){for(t=[],s=0,r=e.length;r>s;s++)n=e[s],t.push(o({contact:n,tooltip:!0})),n!==_.last(e)&&t.push(", ");return t}return o({contact:e,tooltip:!0})}}}}),require.register("mixins/router_mixin",function(e,t,n){var o;o=window.router,n.exports={buildUrl:function(e){return o.buildUrl.call(o,e)},buildClosePanelUrl:function(e){return o.buildClosePanelUrl.call(o,e)},redirect:function(e){var t;return t="string"==typeof e?e:this.buildUrl(e),o.navigate(t,!0)}}}),require.register("mixins/should_update_mixin",function(e,t,n){var o,s={}.hasOwnProperty;o=function(e,t,n){var o,r;if(e===t)return!0;for(o in e)if(s.call(e,o)&&(r=e[o],t[o]!==r))return n&&console.log("DIFF ON "+o),!1;for(o in t)if(s.call(t,o)&&null!=t[o]&&null==e[o])return n&&console.log("LOST "+o),!1;return!0},n.exports={ImmutableEquality:{shouldComponentUpdate:function(e,t){return o(this.props,e)&&o(this.state,t)}},UnderscoreEqualitySlow:{shouldComponentUpdate:function(e,t){var n,o;return o=_.isEqual(t,this.state),n=_.isEqual(e,this.props),!(o&&n)}},Logging:{shouldComponentUpdate:function(e,t){return!o(e,this.props,!0)||!o(t,this.state,!0)}}}}),require.register("mixins/store_watch_mixin",function(e,t,n){var o;n.exports=o=function(e){return{componentDidMount:function(){return e.forEach(function(e){return function(t){return t.on("change",e._setStateFromStores)}}(this))},componentWillUnmount:function(){return e.forEach(function(e){return function(t){return t.removeListener("change",e._setStateFromStores)}}(this))},getInitialState:function(){return this.getStateFromStores()},_setStateFromStores:function(){return this.isMounted()?this.setState(this.getStateFromStores()):void 0}}}}),require.register("mixins/tooltip_refresher_mixin",function(e,t,n){var o;n.exports=o={componentDidMount:function(){return AriaTips.bind()},componentDidUpdate:function(){}}}),require.register("router",function(e,t,n){var o,s,r,a,i={}.hasOwnProperty,l=function(e,t){function n(){this.constructor=e}for(var o in t)i.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};r=t("./libs/panel_router"),o=t("./stores/account_store"),s=t("./stores/message_store"),n.exports=a=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return l(t,e),t.prototype.patterns={"account.config":{pattern:"account/:accountID/config/:tab",fluxAction:"showConfigAccount"},"account.new":{pattern:"account/new",fluxAction:"showCreateAccount"},"account.mailbox.messages":{pattern:"account/:accountID/mailbox/:mailboxID/sort/:sort/:type/:flag/before/:before/after/:after",fluxAction:"showMessageList"},search:{pattern:"account/:accountID/search/:search",fluxAction:"showSearchResult"},message:{pattern:"message/:messageID",fluxAction:"showMessage"},conversation:{pattern:"conversation/:conversationID/:messageID/",fluxAction:"showConversation"},compose:{pattern:"compose",fluxAction:"showComposeNewMessage"},"compose.reply":{pattern:"reply/:messageID",fluxAction:"showComposeMessage"},"compose.reply-all":{pattern:"reply-all/:messageID",fluxAction:"showComposeMessage"},"compose.forward":{pattern:"forward/:messageID",fluxAction:"showComposeMessage"},edit:{pattern:"edit/:messageID",fluxAction:"showComposeMessage"},"default":{pattern:"",fluxAction:""}},t.prototype.routes={"":"default"},t.prototype._getDefaultParameters=function(e,t){var n,s,r,a,i,l,c;switch(e){case"account.mailbox.messages":s=null!=(l=o.getDefault())?l.get("id"):void 0,i=null!=t.accountID?o.getDefaultMailbox(t.accountID):o.getDefaultMailbox(s),r=null!=i?i.get("id"):void 0,a={},a.accountID=s,a.mailboxID=r,a.pageAfter="-",a.sort="-date",a.after="-",a.before="-",a.type="nofilter",a.flag="-";break;case"account.config":n=null!=(c=o.getDefault())?c.get("id"):void 0,a={accountID:n,tab:"account"};break;case"search":a={accountID:"all",search:"-"};break;default:a=null}return a},t}(r)}),require.register("stores/account_store",function(e,n,o){var s,r,a,i,l,c,u,p={}.hasOwnProperty,d=function(e,t){function n(){this.constructor=e}for(var o in t)p.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},m=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};c=n("../libs/flux/store/store"),a=n("../constants/app_constants").ActionTypes,r=n("../utils/translators/account_translator"),u=n("../libs/cached_transform"),l=["id","accountID","label","tree","weight"],i=["lastSync","nbTotal","nbUnread","nbRecent"],s=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}var o,s,c,p,h,g,f,v,b,y,_,E,S,C,A,D,T,x;return d(n,e),c=Immutable.Map(),s=Immutable.Sequence(window.accounts).sort(function(e,t){return e.label>t.label?1:e.label<t.label?-1:0}).mapKeys(function(e,t){return t.id}).map(function(e){return c.set(e.id,e.totalUnread),r.toImmutable(e)}).toOrderedMap(),y=Immutable.Map(),A=null,D=null,E=!1,_=!1,T=Immutable.Map(),v={},S=null,f=null,C=function(){var e,t,n;return(e=null!=A?A.get("id"):void 0)&&(A=s.get(e),t=null!=D?D.get("id"):void 0)?D=null!=A&&null!=(n=A.get("mailboxes"))?n.get(t):void 0:void 0},g=function(){return T=Immutable.Map()},p=function(e,t){return T=T.set(e,t)},h=function(e){var t;return(null!=(t=e.mailboxes)?t.length:void 0)>0?void 0:x({name:"AccountConfigError",field:"nomailboxes",causeFields:["nomailboxes"]})},x=function(e){var n,o,s,r,a,i;if("AccountConfigError"===e.name){for(n={message:t("config error "+e.field),originalError:e.originalError,originalErrorStack:e.originalErrorStack},o={},i=e.causeFields,r=0,a=i.length;a>r;r++)s=i[r],o[s]=n;return T=Immutable.Map(o)}return T=Immutable.Map({unknown:e})},o=function(e,t,n){var o,r,a,c,u;if(o=s.get(e),!o)return!0;c=o.get("mailboxes"),a=c.get(t)||Immutable.Map(),u=y.get(t)||Immutable.Map(),a.get("weight")&&(n.weight=a.get("weight"));for(r in l)a.get(r)!==n[r]&&(a=a.set(r,n[r]));for(r in i)u.get(r)!==n[r]&&(u=u.set(r,n[r]));return u!==y.get(t)&&y.set(t,u),a!==c.get(t)&&(c=c.set(t,a),o=o.set("mailboxes",c),s=s.set(e,o)),C()},b=function(e,t){var n,o;return n=e.get("weight"),o=t.get("weight"),o>n?1:n>o?-1:e.get("label"<t.get("label"))?1:e.get("label">t.get("label"))?-1:0},n.prototype._applyMailboxDiff=function(e,t){var n,o,s,r,a,i;for(n in t)s=t[n],s.nbTotal+s.nbUnread&&(o=y.get(n)||Immutable.Map(),y.set(n,o.merge({nbTotal:o.get("nbTotal")+s.nbTotal,nbUnread:o.get("nbUnread")+s.nbUnread})));return r=(null!=(i=t[e])?i.nbUnread:void 0)||0,r&&(a=c.get(e)+r,c=c.set(e,a)),clearTimeout(f),f=setTimeout(function(e){return function(){return e.emit("change")}}(this),1)},n.prototype._setCurrentAccount=function(e){return A=e},n.prototype._setCurrentMailbox=function(e){return D=e},n.prototype._onAccountUpdated=function(e){var t;return t=r.toImmutable(e),s=s.set(t.get("id"),t),this._setCurrentAccount(t)},n.prototype.__bindHandlers=function(e){return e(a.ADD_ACCOUNT_REQUEST,function(e){var t;return t=e.inputValues,E=!0,this.emit("change")}),e(a.ADD_ACCOUNT_SUCCESS,function(e){var t;return t=e.account,E=!1,h(t),this._onAccountUpdated(t),this.emit("change")}),e(a.ADD_ACCOUNT_FAILURE,function(e){var t;return t=e.error,E=!1,x(t),this.emit("change")}),e(a.CHECK_ACCOUNT_REQUEST,function(){return _=!0,this.emit("change")}),e(a.CHECK_ACCOUNT_SUCCESS,function(){return _=!1,this.emit("change")}),e(a.CHECK_ACCOUNT_FAILURE,function(e){var t;return t=e.error,_=!1,x(t),this.emit("change")}),e(a.SELECT_ACCOUNT,function(e){var t,n;return null!=e.accountID?this._setCurrentAccount(s.get(e.accountID)||null):this._setCurrentAccount(null),null!=e.mailboxID?(t=(null!=A&&null!=(n=A.get("mailboxes"))?n.get(e.mailboxID):void 0)||null,this._setCurrentMailbox(t)):(g(),this._setCurrentMailbox(null)),this.emit("change")}),e(a.EDIT_ACCOUNT_REQUEST,function(e){var t;return t=e.inputValues,E=!0,this.emit("change")}),e(a.EDIT_ACCOUNT_SUCCESS,function(e){var t;return t=e.rawAccount,E=!1,g(),h(t),this._onAccountUpdated(t),this.emit("change")}),e(a.EDIT_ACCOUNT_FAILURE,function(e){var t;return t=e.error,E=!1,x(t),this.emit("change")}),e(a.MAILBOX_CREATE,function(e){return this._onAccountUpdated(e),this.emit("change")}),e(a.MAILBOX_UPDATE,function(e){return this._onAccountUpdated(e),this.emit("change")}),e(a.MAILBOX_DELETE,function(e){return this._onAccountUpdated(e),this.emit("change")}),e(a.REMOVE_ACCOUNT,function(e){return s=s["delete"](e),this._setCurrentAccount(this.getDefault()),this.emit("change")}),e(a.RECEIVE_MAILBOX_UPDATE,function(e){return o(e.accountID,e.id,e),this.emit("change")}),e(a.RECEIVE_REFRESH_NOTIF,function(e){return c.set(e.accountID,e.totalUnread),this.emit("change")}),e(a.REFRESH_REQUEST,function(e){var t;return t=e.mailboxID,null==v[t]&&(v[t]=0),v[t]++,this.emit("change")}),e(a.REFRESH_FAILURE,function(e){var t,n;return n=e.mailboxID,t=e.error,v[n]--,S=t,this.emit("change")}),e(a.REFRESH_SUCCESS,function(e){var t,n;return t=e.mailboxID,n=e.updated,v[t]--,null!=n&&o(n.accountID,n.id,n),this.emit("change")})},n.prototype.getAll=function(){return s},n.prototype.getAllMailboxes=function(){return u(n,"all-mailboxes",s,function(){return s.flatMap(function(e){return e.get("mailboxes")})})},n.prototype.getMailboxCounters=function(){return y},n.prototype.getByID=function(e){return s.get(e)},n.prototype.getByLabel=function(e){return s.find(function(t){return t.get("label")===e})},n.prototype.getDefault=function(){return s.first()||null},n.prototype.getDefaultMailbox=function(e){var t,n,o,r,a;return(t=s.get(e)||this.getDefault())?(a=t.get("mailboxes"),r=a.filter(function(e){return"inbox"===e.get("label").toLowerCase()}),0!==r.count()?r.first():(o=t.get("favorites"),n=null!=o?o[0]:void 0,n?a.get(n):a.first())):null},n.prototype.hasConversationEnabled=function(e){return e!==(null!=A?A.get("trashMailbox"):void 0)&&e!==(null!=A?A.get("draftMailbox"):void 0)&&e!==(null!=A?A.get("junkMailbox"):void 0)},n.prototype.getSelected=function(){return A},n.prototype.getSelectedOrDefault=function(){return this.getSelected()||this.getDefault()},n.prototype.getSelectedMailboxes=function(e){var t;return null==A?Immutable.OrderedMap.empty():(t=A.get("mailboxes"),e&&(t=t.sort(b)),t)},n.prototype.selectedIsDifferentThan=function(e,t){var n;return n=(null!=A?A.get("id"):void 0)!==e||(null!=D?D.get("id"):void 0)!==t},n.prototype.getSelectedMailbox=function(e){var t;return t=this.getSelectedMailboxes(),null!=e?t.get(e):null!=D?D:t.first()},n.prototype.getSelectedFavorites=function(e){var t,n,o;return n=this.getSelectedMailboxes(),t=null!=A?A.get("favorites"):void 0,o=null!=t?n.filter(function(e,n){return m.call(t,n)>=0}).toOrderedMap():n.toOrderedMap(),e&&(o=o.sort(b)),o},n.prototype.getErrors=function(){return T},n.prototype.getRawErrors=function(){return T.get("unknown")},n.prototype.getAlertErrorMessage=function(){var e;return e=T.first(),"AccountConfigError"===e.name?t("config error "+e.field):e.message||e.name||e},n.prototype.getRefreshLastError=function(){var e;return e=S,"AccountConfigError"===e.name?t("config error "+e.field):e.message||e.name||e},n.prototype.isWaiting=function(){return E},n.prototype.isChecking=function(){return _},n.prototype.isMailboxRefreshing=function(e){return v[e]>0},n.prototype.getMailboxRefresh=function(e){return v[e]>0?.9:0},n.prototype.getMailbox=function(e,t){var n;n=null;for(n in e.get("mailboxIds"))m.call(t.favorites,n)>=0&&(n=n);return null==n&&Object.keys(e.get("mailboxIds")).length>=0?Object.keys(e.get("mailboxIds"))[0]:n},n.prototype.makeEmptyAccount=function(){var e;return e={},e.label="",e.login="",e.password="",e.imapServer="",e.imapLogin="",e.smtpServer="",e.label="",e.id=null,e.smtpPort=465,e.smtpSSL=!0,e.smtpTLS=!1,e.smtpMethod="PLAIN",e.imapPort=993,e.imapSSL=!0,e.imapTLS=!1,e.accountType="IMAP",e.favoriteMailboxes=null,Immutable.Map(e)},n}(c),o.exports=new s}),require.register("stores/contact_store",function(e,t,n){var o,s,r,a={}.hasOwnProperty,i=function(e,t){function n(){this.constructor=e}for(var o in t)a.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};r=t("../libs/flux/store/store"),o=t("../constants/app_constants").ActionTypes,s=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}var n,s,r,a;return i(t,e),r="",n=Immutable.OrderedMap.empty(),a=Immutable.OrderedMap.empty(),s=function(e){var t;return a=Immutable.OrderedMap.empty(),null!=e?(Array.isArray(e)||(e=[e]),t=function(t){return e.forEach(function(e){var n,o;return n=[],e.datapoints.forEach(function(t){return"email"===t.name&&n.push(t.value),"avatar"===t.name?e.avatar=t.value:void 0}),delete e.docType,(null!=(o=e._attachments)?o.picture:void 0)&&(e.avatar="contacts/"+e.id+"/picture.jpg"),n.forEach(function(n){var o;return e.address=n,o=Immutable.Map(e),t.set(n,o)})})},a=a.withMutations(t),n=n.withMutations(t)):void 0},s(window.contacts),t.prototype.__bindHandlers=function(e){return e(o.RECEIVE_RAW_CONTACT_RESULTS,function(e){return function(t){return s(t),e.emit("change")}}(this)),e(o.CONTACT_LOCAL_SEARCH,function(e){return function(t){var o;return t=t.toLowerCase(),o=new RegExp(t,"i"),a=n.filter(function(e){var t,n;return n=e.toObject(),t="",["address","fn"].forEach(function(e){return"string"==typeof n[e]?t+=n[e]:void 0}),o.test(t)}).toOrderedMap(),e.emit("change")}}(this))},t.prototype.getResults=function(){return a},t.prototype.getQuery=function(){return r},t.prototype.getByAddress=function(e){return n.get(e)},t.prototype.getAvatar=function(e){var t;return null!=(t=n.get(e))?t.get("avatar"):void 0},t.prototype.isExist=function(e){return null!=this.getByAddress(e)},t}(r),n.exports=new s}),require.register("stores/layout_store",function(e,n,o){var s,r,a,i,l,c,u,p,d,m,h={}.hasOwnProperty,g=function(e,t){function n(){this.constructor=e}for(var o in t)h.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};p=n("../libs/flux/store/store"),m=n("../constants/app_constants"),r=m.ActionTypes,i=m.Dispositions,a=n("../app_dispatcher"),s=n("./account_store"),u=null,d=function(){return null==u&&(u=n("../actions/message_action_creator")),u},l=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}var o,l,c,u,p,m,h,f,v;return g(n,e),o=i.COL,h=60,m=!1,v=Immutable.OrderedMap(),f=!0,c=!1,u=!1,l=window.innerWidth>1280,p=null,n.prototype.__bindHandlers=function(e){var n,i;return e(r.SET_DISPOSITION,function(e){return o=e,this.emit("change")}),e(r.TOGGLE_LIST_MODE,function(){return u=!u,this.emit("change")}),e(r.RESIZE_PREVIEW_PANE,function(e){return e?(h+=e,20>h&&(h=20),h>80&&(h=80)):h=50,this.emit("change")}),e(r.MINIMIZE_PREVIEW_PANE,function(){return m=!1,this.emit("change")}),e(r.MAXIMIZE_PREVIEW_PANE,function(){return m=!0,this.emit("change")}),e(r.DISPLAY_MODAL,function(e){return p=e,this.emit("change")}),e(r.HIDE_MODAL,function(e){return p=null,this.emit("change")}),e(r.REFRESH,function(){return this.emit("change")}),e(r.CLEAR_TOASTS,function(){return v=Immutable.OrderedMap(),this.emit("change")}),e(r.RECEIVE_TASK_UPDATE,function(e){return function(t){return e._showNotification(t)}}(this)),e(r.RECEIVE_TASK_DELETE,function(e){return this._removeNotification(e)}),e(r.TOASTS_SHOW,function(){return f=!0,this.emit("change")}),e(r.TOASTS_HIDE,function(){return f=!1,this.emit("change")}),e(r.INTENT_AVAILABLE,function(e){return c=e,this.emit("change")}),e(r.DRAWER_SHOW,function(){return l!==!0?(l=!0,this.emit("change")):void 0}),e(r.DRAWER_HIDE,function(){return l!==!1?(l=!1,this.emit("change")):void 0}),e(r.DRAWER_TOGGLE,function(){return l=!l,this.emit("change");
}),n=function(e,n,o,s){var r,a,i;if(a=null!=e?e.subject:void 0,e.messageID&&e.isDraft)i="draft";else if(e.messageID)i="message";else if(e.conversationID)i="conversation";else if(e.conversationIDs)i="conversations",r=e.conversationIDs.length;else{if(!e.messageIDs)throw new Error("Wrong Usage : unrecognized target");i="messages",r=e.messageIDs.length}return t(""+i+" "+o,{error:s,subject:a||"",smart_count:r})},i=function(e){return{label:t("action undo"),onClick:function(){return d().undo(e)}}},e(r.MESSAGE_TRASH_SUCCESS,function(e){var t,o,s;return o=e.target,t=e.ref,s=e.updated,this._showNotification({message:n(o,t,"delete ok"),actions:[i(t)],autoclose:!0})}),e(r.MESSAGE_TRASH_FAILURE,function(e){var t,o,s;return s=e.target,o=e.ref,t=e.error,this._showNotification({message:n(s,o,"delete ko",t),errors:[t],autoclose:!0})}),e(r.MESSAGE_MOVE_SUCCESS,function(e){var t,o,s;return o=e.target,t=e.ref,s=e.updated,o.silent?void 0:this._showNotification({message:n(o,t,"move ok"),actions:[i(t)],autoclose:!0})}),e(r.MESSAGE_MOVE_FAILURE,function(e){var t,o,s;return s=e.target,o=e.ref,t=e.error,this._showNotification({message:n(s,o,"move ko",t),errors:[t],autoclose:!0})}),e(r.MESSAGE_FLAGS_FAILURE,function(e){var t,o,s;return s=e.target,o=e.ref,t=e.error,this._showNotification({message:n(s,o,"flag ko",t),errors:[t],autoclose:!0})}),e(r.MESSAGE_RECOVER_FAILURE,function(e){var t,n,o;return o=e.target,n=e.ref,t=e.error,this._showNotification({message:"lost server connection",errors:[t],autoclose:!0})}),e(r.MESSAGE_FETCH_FAILURE,function(e){var t;return t=e.error,this._showNotification({message:"message fetch failure",errors:[t],autoclose:!0})}),e(r.ADD_ACCOUNT_FAILURE,function(e){var t;return t=e.error,a.waitFor([s.dispatchToken]),this._showNotification({message:s.getAlertErrorMessage(),errors:s.getRawErrors(),autoclose:!0})}),e(r.ADD_ACCOUNT_SUCCESS,function(){return this._showNotification({message:t("account creation ok"),autoclose:!0})}),e(r.EDIT_ACCOUNT_FAILURE,function(e){var t;return t=e.error,a.waitFor([s.dispatchToken]),this._showNotification({message:s.getAlertErrorMessage(),errors:s.getRawErrors(),autoclose:!0})}),e(r.EDIT_ACCOUNT_SUCCESS,function(){return this._showNotification({message:t("account updated"),autoclose:!0})}),e(r.CHECK_ACCOUNT_FAILURE,function(e){var t;return t=e.error,a.waitFor([s.dispatchToken]),this._showNotification({message:s.getAlertErrorMessage(),errors:s.getRawErrors(),autoclose:!0})}),e(r.CHECK_ACCOUNT_SUCCESS,function(){return this._showNotification({message:t("account checked"),autoclose:!0})}),e(r.REFRESH_FAILURE,function(e){var t;return t=e.error,a.waitFor([s.dispatchToken]),this._showNotification({message:s.getRefreshLastError(),errors:[t],autoclose:!0})})},n.prototype._removeNotification=function(e){return v=v.remove(e),this.emit("change")},n.prototype._showNotification=function(e){var t;return t=e.id||+Date.now(),null==e.finished&&(e.finished=!0),v=v.set(t,Immutable.Map(e)),e.autoclose&&setTimeout(this._removeNotification.bind(this,t),5e3),this.emit("change")},n.prototype.getDisposition=function(){return o},n.prototype.getListModeCompact=function(){return u},n.prototype.getPreviewSize=function(){return h},n.prototype.isPreviewFullscreen=function(){return m},n.prototype.getModal=function(){return p},n.prototype.getToasts=function(){return v},n.prototype.isShown=function(){return f},n.prototype.intentAvailable=function(){return c},n.prototype.isDrawerExpanded=function(){return l},n}(p),o.exports=c=new l}),require.register("stores/message_store",function(e,t,n){var o,s,r,a,i,l,c,u,p,d,m,h,g,f,v,b={}.hasOwnProperty,y=function(e,t){function n(){this.constructor=e}for(var o in t)b.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},E=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};d=t("../libs/flux/store/store"),a=t("./contact_store"),r=t("../app_dispatcher"),o=t("./account_store"),p=t("../utils/socketio_utils"),f=t("../constants/app_constants"),s=f.ActionTypes,c=f.MessageFlags,l=f.MessageFilter,i=f.FlagsConstants,v=t("../utils/misc"),h=v.reverseDateSort,m=v.getSortFunction,u=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}var n,a,i,u,d,f,v,b,S,C,A,D,T,x,R,M,I,w,N,k,L,O,P,U,F,q,H,V,G,j,W,B,z,Q;return y(t,e),F=Immutable.OrderedMap(),W="date",B=1,I="-",w="nofilter",M="-",R="-",x=0,G=0,H=null,V=!1,T=Immutable.Sequence(),S=Immutable.Map(),C=null,D=null,A=null,O={},L={},Q={},b=function(e){return O[e.ref]=e,e.messages.forEach(function(t){var n,o;return n=t.get("id"),o=null!=L[n]?L[n]:L[n]=[],o.push(e)}),C=null},j=function(e){var t;return t=O[e],delete O[e],t.messages.forEach(function(e){var n,o;return n=e.get("id"),o=L[n],L[n]=_.without(o,t)}),C=null,t},z=function(e,t){var n,o,s,r,a,i,l,c,p,d;switch(t.type){case"trash":p=t.trashBoxID,u(e)?e=null:(i={},i[p]=-1,e=e.set("mailboxIDs",i));break;case"move":a=e.get("mailboxIDs"),s=t.from,c=t.to,i={};for(r in a)d=a[r],i[r]=d;delete i[s],null==i[c]&&(i[c]=-1),e=e.set("mailboxIDs",i);break;case"flag":o=e.get("flags"),n=t.flag,l=t.op,"batchAddFlag"===l&&E.call(o,n)<0?e=e.set("flags",o.concat([n])):"batchRemoveFlag"===l&&E.call(o,n)>=0&&(e=e.set("flags",_.without(o,n)))}return e},q=function(){return F.map(function(e){var t,n,o,s,r;for(t=e.get("id"),r=L[t]||[],o=0,s=r.length;s>o;o++)n=r[o],e=z(e,n);return e}).filter(function(e){return null!==e})},N=function(e){var t,n,o,s,r;return null!=e.inReplyTo?null:(s=e.messageIDs||[e.messageID],o=g.getCurrentID()||"not-null",t=e.conversationIDs||[e.conversationID],n=g.getCurrentConversationID()||"not-null",(E.call(s,o)>=0||E.call(t,n)>=0)&&(r=g.getNextOrPrevious(!0),null!=r)?setTimeout(function(){return window.cozyMails.messageSetCurrent(r)},1):void 0)},k=function(e){if(e.messageID)return[F.get(e.messageID)];if(e.messageIDs)return e.messageIDs.map(function(e){return F.get(e)});if(e.conversationID)return F.filter(function(t){return t.get("conversationID")===e.conversationID}).toArray();if(e.conversationIDs)return F.filter(function(t){var n;return n=t.get("conversationID"),E.call(e.conversationIDs,n)>=0}).toArray();throw new Error("Wrong Usage : unrecognized target AS.getMixed")},u=function(e,t){var n,o;return n=e.get("mailboxIDs"),n[t]||(o=c.DRAFT,E.call(e.get("flags"),o)>=0)},i=function(e){return function(t){return e in t.get("mailboxIDs")}},f=function(e){return function(t){return!(e in t.get("mailboxIDs"))}},d=function(e){return function(t){return e!==t.get("accountID")}},a=function(){var e,t;return e=[],t=function(t){var n;return n=t.get("conversationID"),n&&E.call(e,n)>=0?!1:(e.push(n),!0)}},n=function(e,t){var n,o,s,r,a,i,l,u,p,d,m,h,g;return e?(s=!1,h=c.SEEN,m=E.call(e.get("flags"),h)>=0,g=c.SEEN,a=E.call(t.get("flags"),g)>=0,n=t.get("accountID"),l=Object.keys(e.get("mailboxIDs")),i=Object.keys(t.get("mailboxIDs")),u={},o=_.difference(i,l),o.forEach(function(e){return s=!0,u[e]={nbTotal:1,nbUnread:a?0:1}}),p=_.difference(l,i),p.forEach(function(e){return s=!0,u[e]={nbTotal:-1,nbUnread:m?-1:0}}),d=_.intersection(l,i),r=m&&!a?1:!m&&a?-1:0,0!==r&&(s=!0),u[n]={nbUnread:r},d.forEach(function(e){return u[e]={nbTotal:0,nbUnread:r}}),s?u:!1):{}},v=function(e){var t,s,r,a;return r=F.get(e.id),a=null!=r?r.get("updated"):void 0,null!=e.updated&&null!=a&&a>e.updated||e._deleted||(null==e.attachments&&(e.attachments=[]),null==e.date&&(e.date=(new Date).toISOString()),null==e.createdAt&&(e.createdAt=e.date),null==e.flags&&(e.flags=[]),e.hasAttachments=e.attachments.length>0,e.attachments=e.attachments.map(function(e){return Immutable.Map(e)}),e.attachments=Immutable.Vector.from(e.attachments),delete e.docType,e.updated=Date.now(),s=Immutable.Map(e),s.prettyPrint=function(){return""+e.id+' "'+e.from[0].name+'" "'+e.subject+'"'},F=F.set(e.id,s),e.id===D&&(A=e.conversationID),null!=e.accountID&&(t=n(r,s),t&&o._applyMailboxDiff(e.accountID,t))),C=null},t.prototype.__bindHandlers=function(e){return e(s.RECEIVE_RAW_MESSAGE,function(e){return v(e),this.emit("change")}),e(s.RECEIVE_RAW_MESSAGE_REALTIME,function(e){return v(e),this.emit("change")}),e(s.RECEIVE_RAW_MESSAGES,function(e){var t,n,o;for(n=0,o=e.length;o>n;n++)t=e[n],null!=t&&v(t);return this.emit("change")}),e(s.REMOVE_ACCOUNT,function(e){return r.waitFor([o.dispatchToken]),F=F.filter(d(e)).toOrderedMap(),this.emit("change")}),e(s.MESSAGE_TRASH_REQUEST,function(e){var t,n,s,r,a,i,l,c,u,p,d;for(i=e.target,a=e.ref,r=k(i),i.subject=null!=(p=r[0])?p.get("subject"):void 0,i.accountID=r[0].get("accountID"),t=o.getByID(null!=(d=r[0])?d.get("accountID"):void 0),l=null!=t&&"function"==typeof t.get?t.get("trashMailbox"):void 0,b({type:"trash",trashBoxID:l,messages:r,ref:a}),N(i),c=0,u=r.length;u>c;c++)s=r[c],n=s.get("conversationID"),S=S.update(n,function(e){return e-1});return this.emit("change")}),e(s.MESSAGE_TRASH_SUCCESS,function(e){var t,n,o,s,r,a;for(o=e.target,s=e.updated,n=e.ref,Q[n]=j(n),r=0,a=s.length;a>r;r++)t=s[r],t._deleted?F=F.remove(t.id):v(t);return this.emit("change")}),e(s.MESSAGE_TRASH_FAILURE,function(e){var t,n,o,s,r,a,i;for(r=e.target,s=e.ref,j(s),o=k(r),a=0,i=o.length;i>a;a++)n=o[a],t=n.get("conversationID"),S=S.update(t,function(e){return e+1});return this.emit("change")}),e(s.MESSAGE_FLAGS_REQUEST,function(e){var t,n,o,s,r,a;return r=e.target,o=e.op,t=e.flag,s=e.ref,n=k(r),r.subject=null!=(a=n[0])?a.get("subject"):void 0,r.accountID=n[0].get("accountID"),b({type:"flag",op:o,flag:t,messages:n,ref:s}),this.emit("change")}),e(s.MESSAGE_FLAGS_SUCCESS,function(e){var t,n,o,s,r,a;for(o=e.target,s=e.updated,n=e.ref,j(n),r=0,a=s.length;a>r;r++)t=s[r],v(t);return this.emit("change")}),e(s.MESSAGE_FLAGS_FAILURE,function(e){var t,n;return n=e.target,t=e.ref,j(t),this.emit("change")}),e(s.MESSAGE_MOVE_REQUEST,function(e){var t,n,o,s,r,a;return s=e.target,t=e.from,r=e.to,o=e.ref,n=k(s),s.subject=null!=(a=n[0])?a.get("subject"):void 0,s.accountID=n[0].get("accountID"),b({type:"move",from:t,to:r,messages:n,ref:o}),N(s),this.emit("change")}),e(s.MESSAGE_MOVE_SUCCESS,function(e){var t,n,o,s,r,a;for(o=e.target,s=e.updated,n=e.ref,Q[n]=j(n),r=0,a=s.length;a>r;r++)t=s[r],v(t);return this.emit("change")}),e(s.MESSAGE_MOVE_FAILURE,function(e){var t,n;return n=e.target,t=e.ref,j(t),this.emit("change")}),e(s.MESSAGE_UNDO_TIMEOUT,function(e){var t;return t=e.ref,delete Q[t]}),e(s.MESSAGE_FETCH_REQUEST,function(e){var t;return t=e.mailboxID,x++,this.emit("change")}),e(s.MESSAGE_FETCH_FAILURE,function(){return x--,this.emit("change")}),e(s.MESSAGE_FETCH_SUCCESS,function(e){var t,n,o,s,r,a,i,l,c,u,d,m,h;if(t=e.fetchResult,x--,null!=(null!=(u=t.links)?u.next:void 0)?H=decodeURIComponent(t.links.next):null!=t.links&&(V=!0),o=t.conversationLengths){for(d=t.messages,r=0,i=d.length;i>r;r++)s=d[r],null==o[c=s.conversationID]&&(o[c]=0);S=S.merge(o)}for(m=t.messages,a=0,l=m.length;l>a;a++)s=m[a],null!=s&&v(s);return n=null!=(h=F.last())?h.get("date"):void 0,n&&p.changeRealtimeScope(t.mailboxID,n),this.emit("change")}),e(s.CONVERSATION_FETCH_SUCCESS,function(e){var t,n,o,s;for(n=e.updated,o=0,s=n.length;s>o;o++)t=n[o],v(t);return this.emit("change")}),e(s.MESSAGE_SEND,function(e){return v(e),this.emit("change")}),e(s.QUERY_PARAMETER_CHANGED,function(e){var t,n,o,s,r;return r=e.type,o=e.flag,s=e.sort,n=e.before,t=e.after,(r!==I||w!==o||M!==n||R!==t||B+W!==s)&&(G++,B=s.substr(0,1),W=s.substr(1),I=r,w=o,M=n,R=t,V=!1,H=null,("from"===I||"dest"===I||"from"===r||"dest"===r)&&(F=F.clear(),C=null)),this.emit("change")}),e(s.MESSAGE_CURRENT,function(e){return this.setCurrentID(e.messageID,e.conv),this.emit("change")}),e(s.SELECT_ACCOUNT,function(e){return this.setCurrentID(null),B="+",W="date",I="nofilter",w="-",M="-",R="-",V=!1,H=null}),e(s.RECEIVE_MESSAGE_DELETE,function(e){return F=F.remove(e),C=null,this.emit("change")}),e(s.MAILBOX_EXPUNGE,function(e){return F=F.filter(f(e)),C=null,this.emit("change")}),e(s.SEARCH_SUCCESS,function(e){var t,n,o,s,r;for(n=e.searchResults,r=n.rows,o=0,s=r.length;s>o;o++)t=r[o],null!=t&&v(t);return this.emit("change")})},t.prototype.getByID=function(e){return F.get(e)||null},t.prototype.getMessageHash=function(e){var t,n,s,r,a,i;return i=e.get("id"),n=e.get("accountID"),a=o.getSelectedMailbox().get("id"),null==a&&(a=o.getMailbox(e,t)),t=o.getSelected().get("id"),s=e.get("conversationID"),r="#account/"+n+"/",r+="mailbox/"+a+"/",r+="conversation/"+s+"/"+i+"/"},a=function(){var e,t;return e=[],t=function(t){var n;return n=t.get("conversationID"),n&&E.call(e,n)>=0?!1:(e.push(n),!0)}},P=function(e){var t,n;switch(w){case l.FLAGGED:return t=c.FLAGGED,E.call(e.get("flags"),t)>=0;case l.ATTACH:return e.get("attachments").length>0;case l.UNSEEN:return n=c.SEEN,E.call(e.get("flags"),n)<0;default:return!0}},U=function(e){var t;return M<(t=e.get(I))&&R>t},t.prototype.getMessagesToDisplay=function(e,t){var n,o;return n=[],o=q(),o=o.filter(i(e)),"flag"===I&&(o=o.filter(P)),"date"===I&&(o=o.filter(U)),t&&(o=o.filter(a())),o=o.sort(m(W,B)),T=o.toOrderedMap()},t.prototype.getCurrentID=function(){return D},t.prototype.setCurrentID=function(e,t){var n,o;return null!=t&&(n=null!=(o=this.getByID(e))?o.get("conversationID"):void 0),D=e,A=n,C=null},t.prototype.getCurrentConversationID=function(){return A},t.prototype.getPreviousMessage=function(e){var t,n,o,s,r;return null!=e&&e?null==C?null:(o=C.findIndex(function(e){return D===e.get("id")}),0>o?null:o===C.length-1?(s=Object.keys(T.toJS()),o=s.indexOf(C.last().get("id")),1>o?null:(n=T.get(s[o-1]),t=null!=n?n.get("conversationID"):void 0,null==t?null:r=F.filter(function(e){return e.get("conversationID")===t}).sort(h).first())):C.get(o+1)):(s=Object.keys(T.toJS()),o=s.indexOf(D),-1===o?null:T.get(s[o-1]))},t.prototype.getNextMessage=function(e){var t,n;return null!=e&&e?null==C?null:(t=C.findIndex(function(e){return D===e.get("id")}),0>t?null:0===t?(n=Object.keys(T.toJS()),t=n.indexOf(C.last().get("id")),-1===t||t===n.length-1?null:T.get(n[t+1])):C.get(t-1)):D?(n=Object.keys(T.toJS()),t=n.indexOf(D),-1===t||t===n.length-1?null:T.get(n[t+1])):null!=T?T.first():void 0},t.prototype.getNextOrPrevious=function(e){return this.getNextMessage(e)||this.getPreviousMessage(e)},t.prototype.getCurrentConversation=function(){var e;return e=this.getCurrentConversationID(),e?this.getConversation(e):null},t.prototype.getConversation=function(e){return C?C:C=q().filter(function(t){return t.get("conversationID")===e}).sort(h).toVector()},t.prototype.getMixed=function(e){return k(e)},t.prototype.getConversationsLength=function(){return S},t.prototype.isFetching=function(){return x>0},t.prototype.isUndoable=function(e){return null!=Q[e]},t.prototype.getUndoableRequest=function(e){return Q[e]},t.prototype.getQueryParams=function(){return{sort:""+B+W,type:I,filter:w,before:M,after:R,hasNextPage:!V}},t.prototype.getNextUrl=function(){var e,t,n;return V?null:H?H:(e=o.getSelectedMailbox().get("id"),t="from"===I||"dest"===I?encodeURIComponent("+"+I):encodeURIComponent(""+B+W),n="mailbox/"+e+"/?sort="+t,"flag"===I&&"-"!==w&&(n+="&flag="+w),"-"!==M&&(n+="&before="+encodeURIComponent(M)),"-"!==R&&(n+="&after="+encodeURIComponent(R)),n)},t}(d),n.exports=g=new u}),require.register("stores/refreshes_store",function(e,n,o){var s,r,a,i,l={}.hasOwnProperty,c=function(e,t){function n(){this.constructor=e}for(var o in t)l.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};a=n("../libs/flux/store/store"),s=n("../constants/app_constants").ActionTypes,i=function(e){return Immutable.Sequence(e).mapKeys(function(e,t){return t.objectID}).map(function(e){return Immutable.fromJS(e)}).toOrderedMap()},r=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}var o;return c(n,e),o=i(window.refreshes||[]),n.prototype.__bindHandlers=function(e){return e(s.RECEIVE_REFRESH_STATUS,function(e){return o=i(e)}),e(s.RECEIVE_REFRESH_UPDATE,function(e){var t;return e=Immutable.Map(e),t=e.get("objectID"),o=o.set(t,e).toOrderedMap(),this.emit("change")}),e(s.RECEIVE_REFRESH_DELETE,function(e){return o=o.filter(function(t){return t.get("id")!==e}).toOrderedMap(),this.emit("change")}),e(s.RECEIVE_REFRESH_NOTIF,function(e){return window.cozyMails.notify(t("notif new title"),{body:e.message})})},n.prototype.getRefreshing=function(){return o},n}(a),o.exports=new r}),require.register("stores/search_store",function(e,t,n){var o,s,r,a,i,l,c={}.hasOwnProperty,u=function(e,t){function n(){this.constructor=e}for(var o in t)c.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};i=t("../libs/flux/store/store"),s=t("./message_store"),o=t("../constants/app_constants").ActionTypes,r=10,a=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}var n,a,i,l,c,p,d,m;return u(t,e),m=0,a="",p=0,c=!1,i="all",d=Immutable.Set().clear(),l=Immutable.Map(),n=function(){return a="",d=d.clear(),l=Immutable.Map(),p=0,c=!1},n(),t.prototype.__bindHandlers=function(e){return e(o.QUERY_PARAMETER_CHANGED,function(){return n(),this.emit("change")}),e(o.SEARCH_PARAMETER_CHANGED,function(e){var t,o;return o=e.search,t=e.accountID,(o!==a||t!==i)&&n(),a=o,i=t,this.emit("change")}),e(o.SEARCH_REQUEST,function(e){return m++,p++,this.emit("change")}),e(o.SEARCH_FAILURE,function(e){var t;return t=e.error,m--,p--,d=d.clear(),this.emit("change")}),e(o.SEARCH_SUCCESS,function(e){var t,n,o;return o=e.searchResults,m--,t=o.accounts,n=o.rows.map(function(e){return e._id}),c=n.length===r,d=d.union(n),l=l.merge(t),this.emit("change")})},t.prototype.getCurrentSearch=function(){return a},t.prototype.getCurrentSearchKey=function(){return encodeURIComponent(a)},t.prototype.getCurrentSearchAccountID=function(){return i},t.prototype.getCurrentSearchResults=function(){return d.mapEntries(function(e){var t;return t=e[0],[t,s.getByID(t)]}).filter(function(e){return null!==e}).toOrderedMap()},t.prototype.hasMoreSearch=function(){return c},t.prototype.getNextSearchUrl=function(){var e;return e="search?search="+this.getCurrentSearchKey(),e+="&pageSize="+r,p&&(e+="&page="+p),"all"!==i&&(e+="&accountID="+i),e},t}(i),n.exports=l=new a}),require.register("stores/settings_store",function(e,t,n){var o,s,r,a={}.hasOwnProperty,i=function(e,t){function n(){this.constructor=e}for(var o in t)a.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};r=t("../libs/flux/store/store"),o=t("../constants/app_constants").ActionTypes,s=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}var n;return i(t,e),n=Immutable.Map(window.settings),t.prototype.__bindHandlers=function(e){return e(o.SETTINGS_UPDATED,function(e){return n=Immutable.Map(e),this.emit("change")})},t.prototype.get=function(e){return null==e&&(e=null),null!=e?n.get(e):n},t}(r),n.exports=new s}),require.register("utils/activity_utils",function(e,t,n){var o,s;s=t("../utils/xhr_utils"),o=function(e){var t;return t={},s.activityCreate(e,function(e,n){return e?t.onerror.call(e):t.onsuccess.call(n)}),t},n.exports=o}),require.register("utils/api_utils",function(e,n,o){var s,r,a,i,l,c,u=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1},p={}.hasOwnProperty;s=n("../stores/account_store"),i=n("../stores/message_store"),l=n("../stores/settings_store"),r=n("../actions/layout_action_creator"),a=n("../actions/message_action_creator"),c=function(){var e,t,n;return e=["account.mailbox.messages","account.mailbox.messages.filter","account.mailbox.messages.date"],t=null!=(n=router.current.firstPanel)?n.action:void 0,u.call(e,t)>=0},o.exports={debugLogs:[],getCurrentAccount:function(){var e;return null!=(e=s.getSelected())?e.toJS():void 0},getCurrentMailbox:function(){var e;return null!=(e=s.getSelectedMailbox())?e.toJS():void 0},getCurrentMessage:function(){var e,t;return t=i.getCurrentID(),e=i.getByID(t),null!=e?e.toJS():void 0},getMessage:function(e){var t;return t=i.getByID(e),null!=t?t.toJS():void 0},getCurrentConversation:function(){var e,t;return e=i.getCurrentConversationID(),null!=e&&null!=(t=i.getConversation(e))?t.toJS():void 0},getCurrentActions:function(){var e;return e=[],Object.keys(router.current).forEach(function(t){return null!=router.current[t]?e.push(router.current[t].action):void 0}),e},messageNew:function(){return router.navigate("compose/",{trigger:!0})},setLocale:function(e){var t,o,s;window.moment.locale(e),o={};try{o=n("../locales/"+e)}catch(r){t=r,console.log(t),o=n("../locales/en")}return s=new Polyglot,s.extend(o),window.t=s.t.bind(s)},getAccountByLabel:function(e){return s.getByLabel(e)},getSetting:function(e){return l.get().toJS()[e]},setSetting:function(e,t){var o,s,r,a,i;if(s=n("../app_dispatcher"),o=n("../constants/app_constants").ActionTypes,a=l.get().toJS(),"object"==typeof e)for(r in e)p.call(e,r)&&(i=e[r],a[r]=i);else a[e]=t;return s.handleViewAction({type:o.SETTINGS_UPDATED,value:a})},messageNavigate:function(e,t){var n,o;if(c()&&(n=t&&l.get("displayConversation")&&l.get("displayPreview"),o="prev"===e?i.getPreviousMessage(n):i.getNextMessage(n),null!=o))return this.messageSetCurrent(o)},messageSetCurrent:function(e){return a.setCurrent(e.get("id"),!0),l.get("displayPreview")?this.messageDisplay(e):void 0},messageDisplay:function(e,t){var n,o,s,r,a;return null==e&&(e=i.getByID(i.getCurrentID())),null==e||t===!1&&null==window.router.current.secondPanel?void 0:(o=e.get("conversationID"),l.get("displayConversation")&&null!=o?(n="conversation",s={messageID:e.get("id"),conversationID:o}):(n="message",s={messageID:e.get("id")}),a={direction:"second",action:n,parameters:s},r=window.router.buildUrl(a),window.router.navigate(r,{trigger:!0}))},messageClose:function(){var e,t;return t=window.location.href,e=t.replace(/\/message\/[^\/]*\//gi,""),e=e.replace(/\/conversation\/[^\/]*\/[^\/]*\//gi,""),window.location.href=e},messageDeleteCurrent:function(){var e,n,o,s,u,p;if(c()&&(s=i.getCurrentID(),null!=s))return p=l.get(),o=p.get("displayConversation"),e=p.get("messageConfirmDelete"),e&&(n=o?t("list delete conv confirm",{smart_count:1}):t("list delete confirm",{smart_count:1})),e?(u={title:t("app confirm delete"),subtitle:n,closeLabel:t("app cancel"),actionLabel:t("app confirm"),action:function(){return a["delete"]({messageID:s}),r.hideModal()}},r.displayModal(u)):a["delete"]({messageID:s})},messageUndo:function(){return a.undo()},customEvent:function(e,t){var n;return n=new CustomEvent(e,{detail:t}),window.dispatchEvent(n)},simulateUpdate:function(){var e;return e=n("../app_dispatcher"),window.setInterval(function(){var t,n,o;return t={accountID:null!=(n=s.getDefault())?n.get("id"):void 0,id:null!=(o=s.getDefaultMailbox())?o.get("id"):void 0,label:"INBOX",path:"INBOX",tree:["INBOX"],delimiter:".",uidvalidity:Date.now(),attribs:[],docType:"Mailbox",lastSync:(new Date).toISOString(),nbTotal:467,nbUnread:0,nbRecent:5,weight:1e3,depth:0},e.handleServerAction({type:"RECEIVE_MAILBOX_UPDATE",value:t})},5e3)},notify:function(e,t){return null!=window.Notification&&l.get("desktopNotifications")?new Notification(e,t):(null==t&&(t={body:e}),window.setTimeout(function(){return r.notify(""+e+" - "+t.body)},0))},log:function(e){var t;return t=e.stack.split("\n")[0].split("@")[1].split(/:\d/)[0].split("/").slice(0,-2).join("/"),window.onerror(e.name,t,e.lineNumber,e.colNumber,e)},dump:function(){var e;return(e=function(t){var n,o,s,r,a,i;o={children:{},state:{},props:{}},r=t.state;for(n in r)s=r[n],"object"==typeof s?o.state[n]=_.clone(s):o.state[n]=s;a=t.props;for(n in a)s=a[n],"object"==typeof s?o.props[n]=_.clone(s):o.props[n]=s;i=t.refs;for(n in i)s=i[n],o.children[n]=e(t.refs[n]);return o})(window.rootComponent)},logInfo:function(e){var t,n;return t={data:{type:"debug",message:e}},n=new XMLHttpRequest,n.open("POST","activity",!0),n.setRequestHeader("Content-Type","application/json;charset=UTF-8"),n.send(JSON.stringify(t)),console.log(e)},logAction:function(e,t){var n,o,s;return"development"===window.app_env?(n=function(e){var t,n,o;return t=_.clone(e),n=function(e){var t;return null!=e?(t=_.clone(e),delete t.headers,delete t.html,delete t.text,delete t.attachments,t):void 0},Array.isArray(t.value)?t.value=t.value.map(n):(t.value=n(t.value),Array.isArray(null!=(o=t.value)?o.messages:void 0)&&(t.value.messages=t.value.messages.map(n))),t},o=(new Error).stack||"",o=o.split("\n").filter(function(e){return/app.js/.test(e.split("@"))}).map(function(e){return e.split("@")[0]}),s={date:(new Date).toISOString(),stack:o.splice(2)},null!=e&&(s.action=n(e)),null!=t&&(s.message=t),window.cozyMails.debugLogs.unshift(s),window.cozyMails.debugLogs=window.cozyMails.debugLogs.slice(0,100)):void 0},displayLogs:function(){var e;return e={title:t("modal please contribute"),subtitle:t("modal please report"),allowCopy:!0,closeLabel:t("app alert close"),content:React.DOM.pre({style:{"max-height":"300px","word-wrap":"normal"}},JSON.stringify(window.cozyMails.debugLogs,null,4))},r.displayModal(e)},clearLogs:function(){return window.cozyMails.debugLogs=[]}}}),require.register("utils/colorhash",function(e,t,n){var o,s;s=function(e,t,n){return 0>n&&(n+=1),n>1&&(n-=1),1/6>n?e+6*(t-e)*n:.5>n?t:2/3>n?e+(t-e)*(2/3-n)*6:e},o=function(e,t,n){var o,r,a,i,l,c;return 0===t?c=a=o=n:(l=.5>n?n*(1+t):n+t-n*t,i=2*n-l,c=s(i,l,e+1/3),a=s(i,l,e),o=s(i,l,e-1/3)),r=(1<<24)+(255*c<<16)+(255*a<<8)+parseInt(255*o),"#"+r.toString(16).slice(1)},n.exports=function(e){var t,n,s,r,a,i,l,c;for(s=0,r=l=0,c=e.length-1;c>=0?c>=l:l>=c;r=c>=0?++l:--l)s=e.charCodeAt(r)+(s<<5)-s;return n=s%100/100,i=s%1e3/1e3,a=.5+.2*(s%2)/2,t=o(n,i,a)}}),require.register("utils/discovery_to_fields",function(e,t,n){var o;n.exports=o=function(e){var t,n,o,s;for(t={},o=0,s=e.length;s>o;o++)n=e[o],"imap"===n.type&&null==t.imapServer&&(t.imapServer=n.hostname,t.imapPort=n.port,"SSL"===n.socketType?(t.imapSSL=!0,t.imapTLS=!1):"STARTTLS"===n.socketType?(t.imapSSL=!1,t.imapTLS=!0):"plain"===n.socketType&&(t.imapSSL=!1,t.imapTLS=!1)),"smtp"===n.type&&null==t.smtpServer&&(t.smtpServer=n.hostname,t.smtpPort=n.port,"SSL"===n.socketType?(t.smtpSSL=!0,t.smtpTLS=!1):"STARTTLS"===n.socketType?(t.smtpSSL=!1,t.smtpTLS=!0):"plain"===n.socketType&&(t.smtpSSL=!1,t.smtpTLS=!1));if(null==t.imapServer&&(t.imapServer="",t.imapPort="993"),null==t.smtpServer&&(t.smtpServer="",t.smtpPort="465"),!t.imapSSL)switch(t.imapPort){case"993":t.imapSSL=!0,t.imapTLS=!1;break;default:t.imapSSL=!1,t.imapTLS=!1}if(!t.smtpSSL)switch(t.smtpPort){case"465":t.smtpSSL=!0,t.smtpTLS=!1;break;case"587":t.smtpSSL=!1,t.smtpTLS=!0;break;default:t.smtpSSL=!1,t.smtpTLS=!1}return t.isGmail="imap.googlemail.com"===t.imapServer,t}}),require.register("utils/dom_utils",function(e,t,n){var o;n.exports=o={isVisible:function(e){var t,n,o;return n=e.getBoundingClientRect(),t=window.innerHeight||document.documentElement.clientHeight,o=window.innerWidth||document.documentElement.clientWidth,0===t||0===o?!1:n.bottom<=t+0&&n.top>=0}}}),require.register("utils/file_utils",function(e,t,n){var o;n.exports=o={dataURItoBlob:function(e){var t,n,o,s,r;for(t=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):window.unescape(e.split(",")[1]),o={mime:e.split(",")[0].split(":")[1].split(";")[0],blob:new Uint8Array(t.length)},n=s=0,r=t.length;r>=0?r>=s:s>=r;n=r>=0?++s:--s)o.blob[n]=t.charCodeAt(n);return o},fileToDataURI:function(e,t){var n;return n=new FileReader,n.readAsDataURL(e),n.onload=function(){return t(n.result)}}}}),require.register("utils/intent_manager",function(e,t,n){var o,s;s=3e3,n.exports=o=function(){function e(){this.talker=new Talker(window.parent,"*")}return e.prototype.send=function(e,t,n){return this.talker.timeout=n?n:s,this.talker.send("nameSpace",t)},e}()}),require.register("utils/message_utils",function(e,n,o){var s,r,a,i,l,c,u;u=React.DOM.span,r=n("../constants/app_constants").ComposeActions,a=n("../stores/contact_store"),c=n("../stores/search_store"),l="margin-left: 0.8ex; padding-left: 1ex; border-left: 3px solid #34A6FF;",s="<style>\npre {background: transparent; border: 0}\n</style>",o.exports=i={displayAddress:function(e,t){return null==t&&(t=!1),t?null!=e.name&&""!==e.name?'"'+e.name+'" <'+e.address+">":""+e.address:null!=e.name&&""!==e.name?e.name:e.address.split("@")[0]},displayAddresses:function(e,t){var n,o,s,r;if(null==t&&(t=!1),null==e)return"";for(o=[],s=0,r=e.length;r>s&&(n=e[s],null!=n);s++)o.push(i.displayAddress(n,t));return o.join(", ")},highlightSearch:function(e){var t,n;return t=new RegExp(c.getCurrentSearch(),"gi"),n=e.match(t),n?e.split(t).reduce(function(e,t,o){return t.length&&e.push(t),n[o]&&e.push(u({className:"hlt-search"},n[o])),e},[]):[e]},parseAddress:function(e){var t,n,o;return e=e.trim(),t=(o=e.match(/"{0,1}(.*)"{0,1} <(.*)>/))?{name:o[1],address:o[2]}:{address:e.replace(/^\s*/,"")},n=/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/,t.isValid=t.address.match(n),t},getReplyToAddress:function(e){var t,n;return n=e.get("replyTo"),t=e.get("from"),null!=n&&0!==n.length?n:t},addSignature:function(e,t){var n;return e.text+="\n\n-- \n"+t,n=t.replace(/\n/g,"<br>"),e.html+='<p><br></p><p id="signature">-- \n<br>'+n+"</p>\n<p><br></p>"},makeReplyMessage:function(e,t,n,o,s){var a,i,l,c,u,p,d,m,h;if(u={composeInHTML:o,attachments:Immutable.Vector.empty()},t){if(u.accountID=t.get("accountID"),u.conversationID=t.get("conversationID"),a=this.formatReplyDate(t.get("createdAt")),m=this.displayAddresses(t.get("from")),h=t.get("text"),l=t.get("html"),null==h&&(h=""),null!=h&&null==l&&o)try{l=markdown.toHTML(h)}catch(g){i=g,console.error("Error converting message to Markdown: "+i),l="<div class='text'>"+h+"</div>"}null==l||null!=h||o||(h=toMarkdown(l)),u.inReplyTo=[t.get("id")],u.references=t.get("references")||[],u.references=u.references.concat(u.inReplyTo)}switch(c=null!=s&&s.length>0?!0:!1,d={message:u,inReplyTo:t,dateHuman:a,sender:m,text:h,html:l,signature:s,isSignature:c},n){case r.REPLY:this.setMessageAsReply(d);break;case r.REPLY_ALL:this.setMessageAsReplyAll(d);break;case r.FORWARD:this.setMessageAsForward(d);break;case null:this.setMessageAsDefault(d)}return p=function(t){return t.address!==e},u.to=u.to.filter(p),u.cc=u.cc.filter(p),u},setMessageAsReply:function(e){var n,o,r,a,i,c,u,p,d,m;return i=e.message,r=e.inReplyTo,n=e.dateHuman,u=e.sender,m=e.text,o=e.html,d=e.signature,a=e.isSignature,c={date:n,sender:u},p=t("compose reply separator",c),i.to=this.getReplyToAddress(r),i.cc=[],i.bcc=[],i.subject=this.getReplySubject(r),i.text=p+this.generateReplyText(m)+"\n",i.html=""+s+"\n<p><br></p>",a&&this.addSignature(i,d),i.html+="<p>"+p+'<span class="originalToggle"> … </span></p>\n<blockquote style="'+l+'">'+o+"</blockquote>"},setMessageAsReplyAll:function(e){var n,o,r,a,i,c,u,p,d,m,h;return i=e.message,r=e.inReplyTo,n=e.dateHuman,u=e.sender,m=e.text,o=e.html,d=e.signature,a=e.isSignature,c={date:n,sender:u},p=t("compose reply separator",c),i.to=this.getReplyToAddress(r),h=i.to.map(function(e){return e.address}),i.cc=[].concat(r.get("from"),r.get("to"),r.get("cc")).filter(function(e){return null!=e&&-1===h.indexOf(e.address)}),i.bcc=[],i.subject=this.getReplySubject(r),i.text=p+this.generateReplyText(m)+"\n",i.html=""+s+"\n<p><br></p>",a&&this.addSignature(i,d),i.html+="<p>"+p+'<span class="originalToggle"> … </span></p>\n<blockquote style="'+l+'">'+o+"</blockquote>\n<p><br></p>"},setMessageAsForward:function(e){var n,o,r,a,i,l,c,u,p,d,m,h,g,f,v,b;return u=e.message,l=e.inReplyTo,o=e.dateHuman,p=e.sender,v=e.text,a=e.html,f=e.signature,c=e.isSignature,n=l.get("to").map(function(e){return e.address}).join(", "),m=this.getReplyToAddress(l),h="",d=m.length>0?(h=m[0].name,d=m[0].address):void 0,r=h.length>0?""+h+" &lt;"+d+"&gt;":d,g="\n----- "+t("compose forward header")+" ------\n"+t("compose forward subject")+" "+l.get("subject")+"\n"+t("compose forward date")+" "+o+"\n"+t("compose forward from")+" "+r+"\n"+t("compose forward to")+" "+n+"\n",b=g.replace("&lt;","<").replace("&gt;",">"),b=b.replace("<pre>","").replace("</pre>",""),i=g.replace(/(\n)+/g,"<br>"),this.setMessageAsDefault(e),u.subject=""+t("compose forward prefix")+l.get("subject"),
u.text=b+v,u.html=""+s,c&&this.addSignature(u,f),u.html+="\n<p>"+i+"</p><p><br></p>"+a,u.attachments=l.get("attachments"),u},setMessageAsDefault:function(e){var t,n,o,r,a,i,l,c;return a=e.message,o=e.inReplyTo,t=e.dateHuman,i=e.sender,c=e.text,n=e.html,l=e.signature,r=e.isSignature,a.to=[],a.cc=[],a.bcc=[],a.subject="",a.text="",a.html=""+s+"\n<p><br></p>",r&&this.addSignature(a,l),a},generateReplyText:function(e){var t;return e=e.split("\n"),t=[],e.forEach(function(e){return t.push("> "+e)}),t.join("\n")},getAttachmentType:function(e){var t;if(!e)return null;switch(t=e.split("/"),t[0]){case"audio":case"image":case"text":case"video":return t[0];case"application":switch(t[1]){case"vnd.ms-excel":case"vnd.oasis.opendocument.spreadsheet":case"vnd.openxmlformats-officedocument.spreadsheetml.sheet":return"spreadsheet";case"msword":case"vnd.ms-word":case"vnd.oasis.opendocument.text":case"vnd.openxmlformats-officedocument.wordprocessingml.document":return"word";case"vns.ms-powerpoint":case"vnd.oasis.opendocument.presentation":case"vnd.openxmlformats-officedocument.presentationml.presentation":return"presentation";case"pdf":return t[1];case"gzip":case"zip":return"archive"}}},formatReplyDate:function(e){return null==e&&(e=moment()),e=moment(e),e.format("lll")},formatDate:function(e,t){var n,o;return null==e?null:(o=moment(),e=moment(e),n=e.isBefore(o,"year")?"DD/MM/YYYY":e.isBefore(o,"day")?null!=t&&t?"L":"MMM DD":"HH:mm",e.format(n))},getAvatar:function(e){return null!=e.get("from")[0]?a.getAvatar(e.get("from")[0].address):null},getPreview:function(e){var t,n;return n=e.get("text"),null==n&&(t=e.get("html"),n=null!=t?toMarkdown(t)(pr("")):""),n.substr(0,1024)},cleanReplyText:function(e){var t,n;try{t=e.replace(/<(style>)[^\1]*\1/gim,""),t=toMarkdown(t)}catch(o){null!=e&&(t=e.replace(/<(style>)[^\1]*\1/gim,""),t=e.replace(/<[^>]*>/gi,""))}return n=document.createElement("div"),n.innerHTML=t,t=n.textContent,t=t.replace(/>[ \t]+/gi,"> "),t=t.replace(/(> \n)+/g,"> \n")},wrapReplyHtml:function(e){return e=e.replace(/<p>/g,'<p style="margin: 0">'),'<style type="text/css">\nblockquote {\n    margin: 0.8ex;\n    padding-left: 1ex;\n    border-left: 3px solid #34A6FF;\n}\np {margin: 0;}\npre {background: transparent; border: 0}\n</style>\n'+e},getReplySubject:function(e){var n,o;return o=e.get("subject")||"",n=t("compose reply prefix"),0!==o.indexOf(n)&&(o=""+n+o),o},tooltip:function(e,n,o,s){var r,i,l,c;return null==s&&(s={}),c=null,i=function(e){return e.preventDefault(),e.stopPropagation(),o(n)},r=function(r){var c,u,p,d,m,h,g,f,v;if(!e.dataset.tooltip)return e.dataset.tooltip=!0,d=a.getByAddress(n.address),p=null!=d?d.get("avatar"):void 0,c="",m="",null!=d?(m=null!=p?"<img class='avatar' src="+p+">":"<div class='no-avatar'>?</div>",m='<div class="tooltip-avatar">\n  <a href="/#apps/contacts/contact/'+d.get("id")+'" target="blank">\n    '+m+"\n  </a>\n</div>"):null!=o&&(c='<p class="tooltip-toolbar">\n  <button class="btn btn-cozy btn-add" type="button">\n  '+t("contact button label")+"\n  </button>\n</p>"),f='<div class="tooltip" role="tooltip">\n    <div class="tooltip-arrow"></div>\n    <div class="tooltip-content">\n        '+m+"\n        <div>\n        "+n.name+"\n        "+(n.name?"<br>":"")+"\n        &lt;"+n.address+"&gt;\n        </div>\n        "+c+"\n    </div>\n</div>'",s={title:n.address,template:f,trigger:"manual",placement:"auto top",container:s.container||e.parentNode},jQuery(e).tooltip(s).tooltip("show"),v=jQuery(e).data("bs.tooltip").tip()[0],parseInt(v.style.left,10)<0&&(v.style.left=0),g=v.getBoundingClientRect(),h=document.createElement("div"),h.classList.add("tooltip-mask"),h.style.top=g.top-8+"px",h.style.left=g.left-8+"px",h.style.height=g.height+32+"px",h.style.width=g.width+16+"px",document.body.appendChild(h),h.addEventListener("mouseout",function(e){var t,n;return g.left<(t=e.pageX)&&t<g.right&&g.top<(n=e.pageY)&&n<g.bottom?void 0:(h.parentNode.removeChild(h),l())}),null!=o&&(u=v.querySelector(".btn-add"),null!=u)?u.addEventListener("click",i):void 0},l=function(){var t;return t=e.querySelector(".btn-add"),null!=t&&t.removeEventListener("click",i),delete e.dataset.tooltip,jQuery(e).tooltip("destroy")},e.addEventListener("mouseover",function(){return c=setTimeout(function(){return r()},s.delay||1e3)}),e.addEventListener("mouseout",function(){return clearTimeout(c)}),s.showOnClick?e.addEventListener("click",function(e){return e.stopPropagation(),r()}):void 0}}}),require.register("utils/misc",function(e,t,n){e.getSortFunction=function(e,t){var n;return n=function(n,o){var s,r;return s=n.get(e),r=o.get(e),s>r?-1*t:r>s?1*t:0}},e.reverseDateSort=e.getSortFunction("date",-1)}),require.register("utils/plugin_utils",function(e,n,o){var s,r={}.hasOwnProperty;s={modal:function(e){var n;return n=document.createElement("div"),n.classList.add("modal"),n.classList.add("fade"),n.innerHTML='<div class="modal-dialog">\n    <div class="modal-content">\n        <div class="modal-header">\n            <button type="button" class="close" data-dismiss="modal"\n                    aria-label="Close">\n                <span aria-hidden="true">&times;</span>\n            </button>\n            <h4 class="modal-title"></h4>\n        </div>\n        <div class="modal-body"> </div>\n        <div class="modal-footer">\n            <button type="button" class="btn btn-default"\n                    data-dismiss="modal">'+t("plugin modal close")+"\n            </button>\n        </div>\n    </div>\n</div>",null!=e.title&&(n.querySelector(".modal-title").innerHTML=e.title),null!=e.body&&("string"==typeof e.body?n.querySelector(".modal-body").innerHTML=e.body:n.querySelector(".modal-body").appendChild(e.body)),"small"===e.size&&n.querySelector(".modal-dialog").classList.add("modal-sm"),"large"===e.size&&n.querySelector(".modal-dialog").classList.add("modal-lg"),e.show!==!1&&(document.body.appendChild(n),window.jQuery(n).modal("show")),n}},o.exports={init:function(){var e,t,n;return null==window.plugins&&(window.plugins={}),window.plugins.helpers=s,Object.keys(window.plugins).forEach(function(e){return function(t){var n,o;return o=window.plugins[t],null!=o.url?(n=function(){return e.activate(t)},e.loadJS(o.url,n)):o.active?e.activate(t):void 0}}(this)),"undefined"!=typeof MutationObserver&&null!==MutationObserver?(e={attributes:!1,childList:!0,characterData:!1,subtree:!0},n=function(e){var t,n,o,s,a,i;for(n=function(e,t){var n,o,s,a,i;if(e.nodeType===Node.ELEMENT_NODE){a=window.plugins,i=[];for(s in a)r.call(a,s)&&(o=a[s],o.active?("add"===t&&(n=o.onAdd),"delete"===t&&(n=o.onDelete),null!=n&&n.condition.bind(o)(e)?i.push(n.action.bind(o)(e)):i.push(void 0)):i.push(void 0));return i}},t=function(e){var t,o,s,r,a,i,l;for(o=Array.prototype.slice.call(e.addedNodes),s=0,a=o.length;a>s;s++)t=o[s],n(t,"add");for(o=Array.prototype.slice.call(e.removedNodes),l=[],r=0,i=o.length;i>r;r++)t=o[r],l.push(n(t,"del"));return l},i=[],s=0,a=e.length;a>s;s++)o=e[s],i.push(t(o));return i},t=new MutationObserver(n),t.observe(document,e)):setInterval(function(){var e,t,n,o;n=window.plugins,o=[];for(t in n)r.call(n,t)&&(e=n[t],e.active?(null!=e.onAdd&&e.onAdd.condition.bind(e)(document.body)&&e.onAdd.action.bind(e)(document.body),null!=e.onDelete&&e.onDelete.condition.bind(e)(document.body)?o.push(e.onDelete.action.bind(e)(document.body)):o.push(void 0)):o.push(void 0));return o},200)},activate:function(e){var t,n,o,s,a,i,l,c,u;try{if(s=window.plugins[e],l=s.type,s.active=!0,null!=s.listeners){c=s.listeners;for(n in c)r.call(c,n)&&(o=c[n],window.addEventListener(n,o.bind(s)))}if(s.onActivate&&s.onActivate(),null!=l){u=window.plugins;for(i in u)r.call(u,i)&&(a=u[i],i!==e&&a.type===l&&a.active&&this.deactivate(i))}return n=new CustomEvent("plugin",{detail:{action:"activate",name:e}}),window.dispatchEvent(n)}catch(p){return t=p,console.log("Unable to activate plugin "+e+": "+t)}},deactivate:function(e){var t,n,o,s,a;try{if(s=window.plugins[e],s.active=!1,null!=s.listeners){a=s.listeners;for(n in a)r.call(a,n)&&(o=a[n],window.removeEventListener(n,o))}return s.onDeactivate&&s.onDeactivate(),n=new CustomEvent("plugin",{detail:{action:"deactivate",name:e}}),window.dispatchEvent(n)}catch(i){return t=i,console.log("Unable to deactivate plugin "+e+": "+t)}},merge:function(e){var t,n,o,s,a;for(o in e)r.call(e,o)&&(n=e[o],t=window.plugins[o],null!=t?t.active=n.active:null!=n.url?window.plugins[o]=n:delete e[o]);s=window.plugins,a=[];for(o in s)r.call(s,o)&&(n=s[o],null==e[o]?a.push(e[o]={name:n.name,active:n.active}):a.push(void 0));return a},loadJS:function(e,t){var n;return n=document.createElement("script"),n.type="text/javascript",n.async=!0,n.src=e,null!=t&&n.addEventListener("load",t),document.body.appendChild(n)},load:function(e){var t,n,o;if(!/:\/\//.test(e))try{throw new Error}catch(s){n=s,t=n.stack.split("\n")[0].split("@")[1].split(/:\d/)[0].split("/").slice(0,-2).join("/"),e=t+"/"+e+"/"}return o=new XMLHttpRequest,o.open("GET",e,!0),o.onload=function(){var e,t;return t=new DOMParser,e=t.parseFromString(o.response,"text/html"),e&&(Array.prototype.forEach.call(e.querySelectorAll("style"),function(e){var t;return t=document.createElement("style"),document.body.appendChild(t),Array.prototype.forEach.call(e.sheet.cssRules,function(e,n){return t.sheet.insertRule(e.cssText,n)})}),Array.prototype.forEach.call(e.querySelectorAll("script"),function(e){var t;return t=document.createElement("script"),t.textContent=e.textContent,document.body.appendChild(t)})),o.send()}}}}),require.register("utils/socketio_utils",function(e,t,n){var o,s,r,a,i,l,c,u;s=t("../app_dispatcher"),o=t("../constants/app_constants").ActionTypes,u=window.location.origin,a=""+window.location.pathname+"socket.io",c=io.connect(u,{path:a,reconnectionDelayMax:6e4,reconectionDelay:2e3,reconnectionAttempts:3}),r=function(e){return function(t){return s.handleServerAction({type:e,value:t})}},i={},l=function(){return c.emit("change_scope",i)},c.on("message.create",r(o.RECEIVE_RAW_MESSAGE_REALTIME)),c.on("message.update",r(o.RECEIVE_RAW_MESSAGE)),c.on("message.delete",r(o.RECEIVE_MESSAGE_DELETE)),c.on("mailbox.update",r(o.RECEIVE_MAILBOX_UPDATE)),c.on("connect",function(){return l()}),c.on("reconnect",function(){return l()}),c.on("refresh.notify",r(o.RECEIVE_REFRESH_NOTIF)),e.changeRealtimeScope=function(e,t){return i={mailboxID:e,before:t},l()}}),require.register("utils/translators/account_translator",function(e,t,n){var o,s,r=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};s=t("../../constants/app_constants").MailboxFlags,n.exports=o={toImmutable:function(e){var t,n,o,a;return t={},o=900,a=400,null==e.mailboxes&&(e.mailboxes=[]),(null==e.draftMailbox||null==e.sentMailbox||null==e.trashMailbox)&&e.mailboxes.forEach(function(t){var n,o,a;return null==e.draftMailbox&&(n=s.DRAFT,r.call(t.attribs,n)>=0)&&(e.draftMailbox=t.id),null==e.sentMailbox&&(o=s.SENT,r.call(t.attribs,o)>=0)&&(e.sentMailbox=t.id),null==e.trashMailbox&&(a=s.TRASH,r.call(t.attribs,a)>=0)?e.trashMailbox=t.id:void 0}),(null==e.draftMailbox||null==e.sentMailbox||null==e.trashMailbox)&&e.mailboxes.forEach(function(t){return null==e.draftMailbox&&/draft/i.test(t.label)&&(e.draftMailbox=t.id),null==e.sentMailbox&&/sent/i.test(t.label)&&(e.sentMailbox=t.id),null==e.trashMailbox&&/trash/i.test(t.label)?e.trashMailbox=t.id:void 0}),n=Immutable.Sequence(e.mailboxes).mapKeys(function(e,t){return t.id}).map(function(e){var n;return e.depth=e.tree.length-1,0===e.depth?(n=e.label.toLowerCase(),"inbox"===n?e.weight=1e3:e.attribs.length>0||/draft/.test(n)||/sent/.test(n)||/trash/.test(n)?(e.weight=o,o-=5):(e.weight=a,a-=5),t[e.depth]=e.weight):(e.weight=t[e.depth-1]-.1,t[e.depth]=e.weight),Immutable.Map(e)}).toOrderedMap(),delete e.totalUnread,e.mailboxes=n,Immutable.Map(e)}}}),require.register("utils/xhr_utils",function(e,t,n){var o,s,r,a,i=[].slice;a=superagent,o=t("./translators/account_translator"),s=t("../stores/settings_store"),r=function(){var e,t,n,o,s,r;return o=arguments[0],e=arguments[1],t=3<=arguments.length?i.call(arguments,2):[],o.ok?e(null,o.body):(n=(null!=(s=o.body)?s.error:void 0)===!0?o.body:(null!=(r=o.body)?r.error:void 0)?o.body.error:o.body?o.body:new Error("error in "+t[0]),console.log.apply(console,["Error in"].concat(i.call(t),[n])),e(n))},n.exports={changeSettings:function(e,t){return a.put("settings").set("Accept","application/json").send(e).end(function(n){return r(n,t,"changeSettings",e)})},fetchMessage:function(e,t){return a.get("message/"+e).set("Accept","application/json").end(function(n){return r(n,t,"fetchMessage",e)})},fetchConversation:function(e,t){return a.get("messages/batchFetch?conversationID="+e).set("Accept","application/json").end(function(n){return n.ok&&(n.body.conversationLengths={},n.body.conversationLengths[e]=n.body.length),r(n,t,"fetchConversation",e)})},fetchMessagesByFolder:function(e,t){return a.get(e).set("Accept","application/json").end(function(n){return r(n,t,"fetchMessagesByFolder",e)})},mailboxCreate:function(e,t){return a.post("mailbox").send(e).set("Accept","application/json").end(function(n){return r(n,t,"mailboxCreate",e)})},mailboxUpdate:function(e,t){return a.put("mailbox/"+e.mailboxID).send(e).set("Accept","application/json").end(function(n){return r(n,t,"mailboxUpdate",e)})},mailboxDelete:function(e,t){return a.del("mailbox/"+e.mailboxID).set("Accept","application/json").end(function(n){return r(n,t,"mailboxDelete",e)})},mailboxExpunge:function(e,t){return a.del("mailbox/"+e.mailboxID+"/expunge").set("Accept","application/json").end(function(n){return r(n,t,"mailboxExpunge",e)})},messageSend:function(e,t){var n,o,s,i;i=a.post("message").set("Accept","application/json"),o={},e.attachments=e.attachments.map(function(e){return o[e.get("generatedFileName")]=e.get("rawFileObject"),e.remove("rawFileObject")}).toJS(),i.field("body",JSON.stringify(e));for(s in o)n=o[s],null!=n&&i.attach(s,n);return i.end(function(n){return r(n,t,"messageSend",e)})},batchFetch:function(e,t){var n;return n=_.extend({},e),a.put("messages/batchFetch").send(e).end(function(e){return r(e,t,"batchFetch")})},batchAddFlag:function(e,t,n){var o;return o=_.extend({flag:t},e),a.put("messages/batchAddFlag").send(o).end(function(e){return r(e,n,"batchAddFlag")})},batchRemoveFlag:function(e,t,n){var o;return o=_.extend({flag:t},e),a.put("messages/batchRemoveFlag").send(o).end(function(e){return r(e,n,"batchRemoveFlag")})},batchDelete:function(e,t){var n;return n=_.extend({},e),a.put("messages/batchTrash").send(e).end(function(e){return r(e,t,"batchDelete")})},batchMove:function(e,t,n,o){var s;return s=_.extend({from:t,to:n},e),a.put("messages/batchMove").send(s).end(function(e){return r(e,o,"batchMove")})},createAccount:function(e,t){return a.post("account").send(e).set("Accept","application/json").end(function(n){return r(n,t,"createAccount",e)})},editAccount:function(e,t){var n;return n=e.toJS(),a.put("account/"+n.id).send(n).set("Accept","application/json").end(function(n){return r(n,t,"editAccount",e)})},checkAccount:function(e,t){return a.put("accountUtil/check").send(e).set("Accept","application/json").end(function(e){return r(e,t,"checkAccount")})},removeAccount:function(e,t){return a.del("account/"+e).set("Accept","application/json").end(function(e){return r(e,t,"removeAccount")})},accountDiscover:function(e,t){return a.get("provider/"+e).set("Accept","application/json").end(function(e){return r(e,t,"accountDiscover")})},search:function(e,t){return a.get(e).set("Accept","application/json").end(function(e){return r(e,t,"search")})},refresh:function(e,t){var n;return n=e?"refresh?all=true":"refresh",a.get(n).end(function(e){return r(e,t,"refresh")})},refreshMailbox:function(e,t){return a.get("refresh/"+e).end(function(e){return r(e,t,"refreshMailbox")})},activityCreate:function(e,t){return a.post("activity").send(e).set("Accept","application/json").end(function(n){return r(n,t,"activityCreate",e)})}}});